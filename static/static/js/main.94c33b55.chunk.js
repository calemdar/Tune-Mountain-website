(this["webpackJsonptune-mountain-client"]=this["webpackJsonptune-mountain-client"]||[]).push([[0],{207:function(e,t,n){},219:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAQAAABpN6lAAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QAAKqNIzIAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAAHdElNRQfkAgYVAzrpZhRiAAACH0lEQVR42u2dOU7DYBgFX5yC0LMVHIfAKUBwC8RFAFGwiDIsB4jSQEBCwBWIWJQAUY5gU1gI0WHH/obijWvrzT9ylPKXctZ0oZFSZRU+E/W0qaamoakt9TSp1CvVSOda/Rlp6bTSgd9PX4ulj7+k2xrNTjSTz9R5/EyZ7tUqdfxZPdZsdpx//PWOZMq0XSrAToBZW7oMmBmoUfj4DT0HmJ019K6F0r/Rv7Ost8JvvAR4jRLNBcyoROT5GK9ESchQ8ZUgr5iZf4wD0AI0DkAL0DgALUDjALQAjQPQAjQOQAvQOAAtQOMAtACNA9ACNA5AC9A4AC1A4wC0AI0D0AI0DkAL0DgALUDjALQAjQPQAjQOQAvQOAAtQOMAtACNA9ACNA5AC9A4AC1A4wC0AI0D0AI0DkAL0DgALUDjALQAjQPQAjQOQAvQOAAtQOMAtACNA9ACNA5AC9A4AC1A4wC0AI0D0AI0DkAL0DgALUDjALQAjQPQAjQOQAvQOAAtQOMAtACNA9ACNA5AC9A4AC1A4wC0AI0D0AI0DkAL0DgALUDjALQAjQPQAjQOQAvQOAAtQOMAtABNojRkp/hKkFeiz5Chj8JvBHklugmYGRS+c1Z61VOA2XWivYCZ3VJvHQSY7UvSSc2XG9+Vvnr7oWazw3xoptYEV1Nc7Lyofo1mR9+Xr0tSWx0NlVY6MFZX61P+0Ta1oa7GlXqlGqqjlXzgC6j1AcnsGbLmAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIwLTAyLTA2VDIxOjAzOjU4KzAwOjAwh3nvzwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMC0wMi0wNlQyMTowMzo1OCswMDowMPYkV3MAAAAZdEVYdFNvZnR3YXJlAHd3dy5pbmtzY2FwZS5vcmeb7jwaAAAAAElFTkSuQmCC"},220:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAQAAABpN6lAAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QAAKqNIzIAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAAHdElNRQfkAgYVAyFjA92OAAAERElEQVR42uWdT4hWVRjGfzVZmA4zpQsZ3UQGgqCFLSKiVFQU+kctLOkPLpJ0kYsINxFBGLUIdDkuJ3QxLhRBrURF0bTZiKHTJv+MWKNCTo7lODZ+b4u7iDK95/u+e8/z3nuesz13eJ/fvBfu893LeyBUnaxjPxcZ51cG+IqlTAq+tgZaxgXsP+sCH9GtLiyOlnLzDvvZusp6OtTlla0ert3FfraOM1ddYrnqu6d9wxjjQ+5Xl1mWpjGeC8AwvucJdanlaF2QfcMY5T3uU5dbvLYGAzCMb5ipLrhoDTYFwPiNN9QlF6vrTQIwjH6mq8suSh00WgBgXOJldenFqKsl+9naQqe6/PbV3QYA4zyL1Aa0AIwGvTysNqEEYBiDPK22oQVg/MUXPKi2ogRgGCeZrzajBWCMsaF60blIAIZxlNlqS1oAxihrqhSZigdgVCoylQPAGOFttTUtAMPoZ5ranhaAcYmX1Aa1AAyjz3dkKh+AcY6FaptaAK4jUxwAhnGaBWqzWgBZZHL3vjEmAMMYYI7ashZAFpkcvWWKD8AwjviJTBoAxjXWqK1rARjGXnrU9rUAjBHeShuAIY9MegDGsDIyeQBgGH1MTRuAcY4X0gZgNNjMQykDMIxTsSOTNwDRI5M/AIbxQ7zI5BNAxMjkFYBhHOHxtAFEiUy+ARjGnnIjk38AxhVeSxuAYfTzaNoAjGFebMWgo1/f2tQMdtFbfGSqTgdk6yzPN2ewPh2Q6TEO8EmRrqrWAdnaG34r1K0DMi1nH10pA4Bn2Bn2ZWJdAcBCPgvZlve9Vjcjaict6zbPMpC3qb4dAB1szN9UZwCwhHlpA4A3UweQ+1xYdwDJ3wJT894k1B0AWNoARrmVNoCTeRvqDuBw6gC2pQ1gD4MpA5jg4/xNdQbwOSfa/yPV/EnMMHbzQIjBunbAIVYykS6AHazgj7Ct9QMwwQZeZyx0e9B9UiGd4V2ONnNBnTrA2ML85uzXqQOGWM3B5i+rSwds56lW7OerCs8Bl3mlPLL+AWwvd2aRbwC/p/2R1LfMKtu+XwB/sj7OGAafACLOLvQHIPIoFm8AfuTJeOa9AZCMY/ID4Geei23eD4AGvUxR2PcB4DyLNeZ9AOjnEZ19NYBSY45/ACXHHN8AIsQczwCixByvAG7Eijk+Abgb0R4TwE2PEyfjAYgeczwBcDx1NgYAUczxAUAYczwAkMYcPQBxzNECuMyramtKAC5ijgqAm5ijAfCdn5gTH4CzmBMbgLuYExPALT71F3PiAXAac+IAcBxzYgA44znmhKmrZfMNNjFZXX77avWorSH/MSdUrR22VoGYE6qfmjQvHYBZhpo7cLFCMSdU4UduXmWVutgyFHroauViTri+zjV/nferF3PC1cPoPe0fjDHXT6u7H709zDt1/t//oyUM/c+D7geqcccKdbKWfVxknF84xpcsqmrA/bf+BrbynChoRDjLAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIwLTAyLTA2VDIxOjAzOjMzKzAwOjAwQxGysgAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMC0wMi0wNlQyMTowMzozMyswMDowMDJMCg4AAAAZdEVYdFNvZnR3YXJlAHd3dy5pbmtzY2FwZS5vcmeb7jwaAAAAAElFTkSuQmCC"},225:function(e,t,n){e.exports=n(580)},530:function(e,t,n){},531:function(e,t,n){},532:function(e,t,n){},533:function(e,t,n){},534:function(e,t,n){},535:function(e,t,n){},536:function(e,t,n){},537:function(e,t,n){},575:function(e,t,n){},579:function(e,t,n){},580:function(e,t,n){"use strict";n.r(t);var a=n(1),o=n.n(a),r=n(8),i=n(9),s=n(15),c=n(10),u=n(16),l=n(218),h=n.n(l),d=n(33),p=n.n(d),f=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o={source:"SpotifyService",state:e,body:t,message:n};a?a.next(o):console.log(o)},A=function(){var e=new URLSearchParams(window.location.search);return{accessToken:e.get("accessToken"),refreshToken:e.get("refreshToken")}},m=function(){function e(t){var n=this;Object(r.a)(this,e);var a=new p.a.BehaviorSubject(!1),o=new p.a.BehaviorSubject(!1),i=new p.a.BehaviorSubject(!1),s=new p.a.ReplaySubject;a.combineLatest(o,i,(function(e,t,n){return e&&t&&n})).filter((function(e){return e})).subscribe((function(){f("LOGGED_IN",null,"User has logged in.",s),function(){if(!n.player){var e=window.Spotify.Player;n.player=new e({name:"tune mountain",getOAuthToken:function(e){return e(n.accessToken)},volume:.5}),n.player.connect(),n.player.addListener("ready",(function(e){var t=e.device_id;f("PLAYER_READY","Spotify player ready to stream songs on ".concat(t),s)})),n.player.addListener("player_state_changed",(function(e){return f("PLAYER_STATE_CHANGED",e,"Spotify player state changed!",s)}))}}()})),function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=A(),a=null,o=null;if(n.accessToken&&n.refreshToken)a=n.accessToken,o=n.refreshToken,f("ACCESS_TOKEN_ACQUIRED",{accessToken:a,refreshToken:o},"Using tokens from query returned from server!",t),localStorage.setItem("spotify-refresh-token",n.refreshToken);else{f("LOADING_TOKEN_FROM_LOCAL_STORAGE",null,"Spotify tokens not found in query. Looking in local storage...",t);var r=localStorage.getItem("spotify-refresh-token");r?(f("REFRESHING_TOKEN",null,"Spotify refresh token found in localStorage. Fetching new accessToken from server...",t),e(r).then((function(e){f("ACCESS_TOKEN_ACQUIRED",{accessToken:e.accessToken,refreshToken:r},"Spotify access token fetched.",t)}))):f("NO_ACCESS_TOKEN",null,"No tokens found or refreshed. User must log in.",t)}}(this.getNewAccessToken,s),s.filter((function(e){return"ACCESS_TOKEN_ACQUIRED"===e.state})).subscribe((function(e){var t=e.body,a=t.accessToken,o=t.refreshToken;n.accessToken=a,n.refreshToken=o,a&&o?i.next(!0):i.next(!1)})),this.name=t,this.player=null,this.spotifyStateNotifier=s,h()(["https://sdk.scdn.co/spotify-player.js"]).then((function(){a.next(!0)})),window.onSpotifyWebPlaybackSDKReady=function(){return o.next(!0)},this.spotifyStateNotifier=s,this.pause=this.pause.bind(this),this.resume=this.resume.bind(this),this.toggle=this.toggle.bind(this)}return Object(i.a)(e,[{key:"activate",value:function(){return this.player?this.player.connect():null}},{key:"deactivate",value:function(){this.player&&this.player.disconnect()}},{key:"getNewAccessToken",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=e||this.refreshToken;return fetch("".concat("","/spotify-service/refresh-token/").concat(t)).then((function(e){return e.json()})).catch((function(e){console.error(e)}))}},{key:"pause",value:function(){return this.player?this.player.pause():null}},{key:"toggle",value:function(){return this.player?this.player.togglePlay():null}},{key:"resume",value:function(){return this.player?this.player.resume():null}},{key:"play",value:function(e){var t="spotify:track:".concat(e);if(!this.player)throw new Error("Player not initialized.");var n=function(e){var t=e.spotifyURI,n=e.playerInstance._options,a=n.getOAuthToken,o=n.id;a((function(e){var n={method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}};t&&(n.body=JSON.stringify({uris:[t]})),fetch("https://api.spotify.com/v1/me/player/play?device_id=".concat(o),n).then((function(){return console.log("Success: Playing uri: ".concat(t))}))}))};n({playerInstance:this.player,spotifyURI:t})}},{key:"login",value:function(){console.log("Redirecting to Spotify for authorization..."),window.location="".concat("","/spotify-service/login")}},{key:"search",value:function(){for(var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n="q=",a=0;a<(arguments.length<=1?0:arguments.length-1);a++)n+=a+1<1||arguments.length<=a+1?void 0:arguments[a+1],n+=a+1===(arguments.length<=1?0:arguments.length-1)?"":"&20";var o="type=track",r="limit=8",i="https://api.spotify.com/v1/search?".concat(n,"&").concat(o,"&").concat(r),s={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(this.accessToken)}};fetch(i,s).then((function(e){return e.json()})).then((function(n){f("TRACKS_FETCHED",n,"Choose any of these songs...",e.spotifyStateNotifier),t&&t(n)})).catch((function(e){throw new Error(e)}))}},{key:"getAudioAnalysisAndFeatures",value:function(e,t){var n=this,a="https://api.spotify.com/v1/audio-analysis/".concat(e),o="https://api.spotify.com/v1/audio-features/".concat(e),r={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(this.accessToken)}},i=null,s=null;fetch(a,r).then((function(e){return e.json()})).then((function(e){return i=e,fetch(o,r)})).then((function(e){return e.json()})).then((function(e){s=e,t&&t({features:s,analysis:i}),f("METADATA_FECHED",{audioFeatures:s,audioAnalysis:i},"Metadata available.",n.spotifyStateNotifier)})).catch((function(e){return console.error(e)}))}},{key:"getUserInfo",value:function(){var e=this;return new Promise((function(t,n){var a={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(e.accessToken)}};return fetch("https://api.spotify.com/v1/me",a).then((function(e){return e.json()})).then((function(e){return t({spotifyID:e.id,displayName:e.display_name,imageUrl:e.images[0].url})})).catch((function(e){return n(e)}))}))}},{key:"stateNotifier",get:function(){return this.spotifyStateNotifier}},{key:"playerState",get:function(){return this.player?this.player.getCurrentState():null}}]),e}(),g=n(82),y=n(18),v=n(35),S=n(36),b=n.n(S),E=(n(530),Object.freeze({SMALL:"SMALL",LARGE:"LARGE",RETURN:"RETURN",ENTER:"ENTER"})),k=Object.freeze({SMALL:"hud-button-small",LARGE:"hud-button-large",RETURN:"hud-button-return",ENTER:"hud-button-enter"}),C=Object.freeze({SMALL:{borderBottom:"solid 4px",borderLeft:"solid 4px",marginTop:"1.5vw",height:"5vw"},RETURN:{width:"7.8vh",height:"7vh",borderBottom:"solid 4px",borderLeft:"solid 4px"},ENTER:{height:"3vw",borderBottom:"solid 4px",borderLeft:"solid 4px"}}),O=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(s.a)(this,Object(c.a)(t).call(this,e))).state={isHovering:!1},n.btnRef=o.a.createRef(),n}return Object(u.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.type,a=t.text,r=t.onClick,i=t.style,s=t.children,c=t.className,u=this.state.isHovering,l=Boolean(E[n])?k[n]:k.SMALL;return o.a.createElement("div",{onMouseEnter:function(){return e.setState({isHovering:!0})},onMouseLeave:function(){return e.setState({isHovering:!1})},className:"button-wrapper ".concat(c),style:i},o.a.createElement("button",{ref:this.btnRef,style:u?C[n]:null,className:"".concat(l," hud-button"),onClick:function(t){e.btnRef.current.blur(),t.buttonType=l,r(t)}},a||s))}}]),t}(a.Component);O.defaultProps={type:E.SMALL,text:"Button Text Not Set",onClick:function(){return console.error("Click handler not set for this button.")},onHover:function(){return console.error("Hover handler not set for this button.")},onHoverEnd:function(){return console.error("End Hover handler not set for this button.")},children:null,className:"",isHovering:!1};var T=O,j=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:26;if(e.length<=t)return e;var n=e.substring(0,t);return"".concat(n,"...")},w=(n(207),function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(s.a)(this,Object(c.a)(t).call(this,e))).state={value:""},n.lastSubmittedValue=null,n.autoSearchTimer=null,n.handleChange=n.handleChange.bind(Object(y.a)(n)),n.handleSubmit=n.handleSubmit.bind(Object(y.a)(n)),n}return Object(u.a)(t,e),Object(i.a)(t,[{key:"handleChange",value:function(e){this.autoSearchTimer&&clearTimeout(this.autoSearchTimer),this.autoSearchTimer=setTimeout(this.handleSubmit,this.props.submissionTimeoutDelay),this.setState({value:e.target.value})}},{key:"handleSubmit",value:function(){""!==this.state.value&&this.state.value!==this.lastSubmittedValue&&(this.props.searchSongsWithQuery(function(e){var t=e.trim().match(/[A-Za-z0-1 ]/g),n=[],a="";return t.forEach((function(e,o){" "===e?(a.length>0&&n.push(a),a=""):(a+=e,o+1===t.length&&n.push(a))})),n}(this.state.value)),this.lastSubmittedValue=this.state.value)}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"search-bar-container",onKeyUp:function(t){13===t.keyCode&&e.handleSubmit()}},o.a.createElement("input",{className:"text-box",placeholder:this.props.placeholder,type:"text",value:this.state.value,onChange:this.handleChange}),o.a.createElement(T,{type:E.ENTER,text:"Search",onClick:this.handleSubmit}))}}]),t}(a.Component));w.defaultProps={searchSongsWithQuery:function(e){throw new Error("Unable to search song with query ".concat(e,". No handler passed."))},placeholder:"Type the name of a song...",submissionTimeoutDelay:2e3};var N=w,q=(n(531),Object.freeze({small:"song-container-small",large:"song-container-large",mini:"song-container-mini"})),R=function(e){var t=e.name,n=e.id,a=e.imgURL,r=e.artist,i=e.duration,s=e.handleClick,c=e.size;return o.a.createElement("div",{className:"".concat(q[c]," song-container"),onClick:function(){return s({name:t,id:n,imgURL:a,artist:r,duration:i})}},o.a.createElement("img",{className:"song-image",src:a,alt:"Album cover for song ".concat(t," by artist ").concat(r)}),o.a.createElement("div",{className:"song-data-container"},o.a.createElement("h1",{className:"song-name"},j(t)),o.a.createElement("h2",{className:"song-artist"},j(function(e){var t="";return e.forEach((function(n,a){t+=n,t+=a+1===e.length?"":", "})),t}(r)))))};R.defaultProps={name:"No Song Name Assigned",id:"No ID Passed",imgURL:"No image URL passed",artist:"No Artist",duration:-1,handleClick:function(){console.log("Song clicked!")},size:"small"};var I=R,L=function(e){function t(e){var n;if(Object(r.a)(this,t),n=Object(s.a)(this,Object(c.a)(t).call(this,e)),!e.spotifyService)throw new Error("HUDSearchMenu requires a reference to an instance of SpotifyService!");return n.spotifyService=e.spotifyService,n.state={songList:[],hasSearched:!1},n.filterReceivedJSON=n.filterReceivedJSON.bind(Object(y.a)(n)),n}return Object(u.a)(t,e),Object(i.a)(t,[{key:"filterReceivedJSON",value:function(e){var t=b.a.get(e,"tracks.items");if(!t)throw new Error("No items found in search response!");var n=t.map((function(e){return function(e,t,n,a,o){return{name:t,artist:n,img:a,id:e,duration:o}}(e.id,e.name,b.a.get(e,"artists").map((function(e){return e.name})),b.a.get(e,"album.images")[0].url,b.a.get(e,"duration_ms"))}));this.setState({songList:n})}},{key:"renderSongList",value:function(){var e=this,t=this.state,n=t.songList,a=t.hasSearched;return 0===n.length&&a?o.a.createElement("h3",{className:"message"},"No songs found. Try something else."):n.map((function(t){return o.a.createElement(I,{name:t.name,artist:t.artist,imgURL:t.img,duration:t.duration,id:t.id,key:t.id,handleClick:function(){return e.props.selectSong(t)}})}))}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"hud-song-search-outer-container"},o.a.createElement("div",{className:"hud-song-search-inner-container"},o.a.createElement(N,{searchSongsWithQuery:function(t){return e.spotifyService.search(e.filterReceivedJSON,t)}}),o.a.createElement("div",{className:"song-list-container"},this.renderSongList()),o.a.createElement(T,{text:"<",type:E.RETURN,onClick:this.props.onReturn})))}}]),t}(a.Component);L.defaultProps={spotifyService:null,selectSong:function(e){console.error("Couldn't select song. No handler passed",e)},onReturn:function(){console.error("No return button handler passed.")}};var M=L,Q=(n(532),function(e){var t=e.hasLoggedIn,n=e.onSongSelectRequest,a=e.onLoginRequest,r=e.onAboutPageRequest,i=e.onLeaderboardsPageRequest,s=o.a.createElement(T,{text:"Spotify Login",onClick:a}),c=o.a.createElement(T,{text:"Select Song",onClick:n}),u=o.a.createElement(T,{text:"About",onClick:r}),l=o.a.createElement(T,{text:"Leaderboards",onClick:i}),h=t?c:s;return o.a.createElement("div",{className:"hud-main-menu-outer-container"},o.a.createElement("div",{className:"hud-main-menu-button-container"},h,u,l))});Q.defaultProps={hasLoggedIn:!1,onSongSelectRequest:function(){throw new Error("No handler passed.")},onLoginRequest:function(){throw new Error("No handler passed.")},onAboutPageRequest:function(){throw new Error("No handler passed.")},onLeaderboardsPageRequest:function(){throw new Error("No handler passed.")}};var P=Q,U=(n(533),function(e){var t=e.songObject,n=e.positionInMilliseconds,a=e.shouldDisplay;if(!t)return null;var r=t.name,i=t.id,s=t.img,c=t.artist,u=t.duration,l={width:"".concat(n/u*100,"%")},h={display:a?"block":"none"};return o.a.createElement("div",{className:"song-progress-bar-container",style:h},o.a.createElement("div",{id:"bar-wrapper"},o.a.createElement("div",{id:"progress-bar",style:l})),o.a.createElement("div",{className:"progress-bar-song-icon"},o.a.createElement(I,{name:r,artist:c,imgURL:s,id:i,size:"mini"})))}),D="IN",x="OUT",B=function(e){e?e.next({position:D}):console.error("Invalid subject!")},G=function(e){e?e.next({position:x}):console.error("Invalid subject!")},F=(n(534),function(e){function t(e){var n;Object(r.a)(this,t),n=Object(s.a)(this,Object(c.a)(t).call(this,e));var a=e.IN,o=e.OUT,i=e.transitionRequestObservable;return n.state={position:e.shouldMountIn?D:x,currentStyle:e.shouldMountIn?a:o},i.delay(250).subscribe((function(t){var a=t.position;a===D?(n.handleTransitionStart(a),n.setState({position:a,currentStyle:e.IN})):a===x?(n.handleTransitionStart(a),n.setState({position:a,currentStyle:e.OUT})):console.error("Invalid position request. Position passed: ",a)})),n.handleTransitionStart=n.handleTransitionStart.bind(Object(y.a)(n)),n.handleTransitionEnd=n.handleTransitionEnd.bind(Object(y.a)(n)),n}return Object(u.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.onMount;e&&e()}},{key:"handleTransitionStart",value:function(e){switch(e){case D:if(!this.props.onStartTransitionIn)break;this.props.onStartTransitionIn();break;case x:if(!this.props.onStartTransitionOut)break;this.props.onStartTransitionOut();break;default:console.error("'Position' state not appropriate: ",e)}}},{key:"handleTransitionEnd",value:function(){switch(this.state.position){case D:if(!this.props.onEndTransitionIn)break;this.props.onEndTransitionIn();break;case x:if(!this.props.onEndTransitionOut)break;this.props.onEndTransitionOut();break;default:console.error("'Position' state not appropriate: ",this.state.position)}}},{key:"render",value:function(){return o.a.createElement("div",{className:"transition-wrapper",style:this.state.currentStyle,onTransitionEnd:this.handleTransitionEnd},this.props.children)}}]),t}(a.Component));F.defaultProps={onMount:function(){return console.log("Component mounted.")},onStartTransitionIn:null,onStartTransitionOut:null,onEndTransitionIn:null,onEndTransitionOut:null,shouldMountIn:!1};var z=F,Z=function(e){var t=e.shouldMountIn,n=e.onStartTransitionIn,a=e.onStartTransitionOut,r=e.onEndTransitionIn,i=e.onEndTransitionOut,s=e.transitionRequestObservable,c=e.onMount,u=c||function(){return B(s)};return o.a.createElement(z,{OUT:{opacity:0},IN:{opacity:1},shouldMountIn:t,transitionRequestObservable:s,onMount:u,onEndTransitionIn:r,onEndTransitionOut:i,onStartTransitionIn:n,onStartTransitionOut:a},e.children)};Z.defaultProps={shouldMountIn:!1};var H=Z,Y=function(e){var t=e.shouldMountIn,n=e.onStartTransitionIn,a=e.onStartTransitionOut,r=e.onEndTransitionIn,i=e.onEndTransitionOut,s=e.transitionRequestObservable,c=e.onMount,u=c||function(){return B(s)};return o.a.createElement(z,{OUT:{left:"100%"},IN:{left:"0"},shouldMountIn:t,transitionRequestObservable:s,onMount:u,onEndTransitionIn:r,onEndTransitionOut:i,onStartTransitionIn:n,onStartTransitionOut:a},e.children)};Y.defaultProps={shouldMountIn:!1};var W=Y,V=(n(535),function(e){var t=e.songObject,n=e.onConfirmation,a=t.name,r=t.id,i=t.img,s=t.artist;return o.a.createElement("div",{className:"hud-song-select-outer-container"},o.a.createElement(I,{size:"large",name:a,id:r,imgURL:i,artist:s}),o.a.createElement(T,{text:"Generate Level",onClick:n,style:{width:"auto"}}),o.a.createElement(T,{text:"<",type:E.RETURN,onClick:e.onReturn}))}),J=(n(536),["Very Low","Low","Somewhat Low","Somewhat High","High","Very High"]),K=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(s.a)(this,Object(c.a)(t).call(this,e))).state={q1:1,q2:"",q3:"",q4:"",q5:1,q6:1,q7:1,q8:"",q9:1,q10:1,q11:!1,q12:!1,q13:!1,q14:!1,q15:!1},n.handleChange=n.handleChange.bind(Object(y.a)(n)),n}return Object(u.a)(t,e),Object(i.a)(t,[{key:"handleChange",value:function(e,t){var n={};n[e]=t,this.setState(n)}},{key:"renderQuestionContainer",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return o.a.createElement("div",{className:"question-container",key:n},o.a.createElement("p",null,e),t,a?o.a.createElement("p",null,a):null)}},{key:"render",value:function(){var e=this,t=new d.Subject,n=[];return n.push(e.renderQuestionContainer("How would you rate your overall enjoyment of the game?",o.a.createElement("input",{type:"range",step:"1",value:e.state.q1,onChange:function(t){return e.handleChange("q1",parseInt(t.target.value,10))},min:"1",max:"6",name:"q1",id:"q1"}),n.length,J[e.state.q1-1])),n.push(e.renderQuestionContainer("What elements did you particularly enjoy?",o.a.createElement("input",{type:"text",value:e.state.q2,onChange:function(t){return e.handleChange("q2",t.target.value)},name:"q2",id:"q2"}),n.length,e.state.q2?"":"Field required")),n.push(e.renderQuestionContainer("What elements did you dislike/have problems with?",o.a.createElement("input",{type:"text",value:e.state.q3,onChange:function(t){return e.handleChange("q3",t.target.value)},name:"q3",id:"q3"}),n.length,e.state.q3?"":"Field required")),n.push(e.renderQuestionContainer("How did playing this game enhance your listening experience?",o.a.createElement("input",{type:"text",value:e.state.q4,onChange:function(t){return e.handleChange("q4",t.target.value)},name:"q4",id:"q4"}),n.length,e.state.q4?"":"Field required")),n.push(e.renderQuestionContainer("How would you rate the synchronicity between the mountain props and jumps and the music you were listening to?",o.a.createElement("input",{type:"range",step:"1",value:e.state.q5,onChange:function(t){return e.handleChange("q5",parseInt(t.target.value,10))},min:"1",max:"6",name:"q5",id:"q5"}),n.length,J[e.state.q5])),n.push(e.renderQuestionContainer("How much did the moving background help create the feeling of going down a mountain?",o.a.createElement("input",{type:"range",step:"1",value:e.state.q6,onChange:function(t){return e.handleChange("q6",parseInt(t.target.value,10))},min:"1",max:"6",name:"q6",id:"q6"}),n.length,e.state.q6)),n.push(e.renderQuestionContainer("To what degree did the moving background help give you a sense of speed as you went down the mountain?",o.a.createElement("input",{type:"range",step:"1",value:e.state.q7,onChange:function(t){return e.handleChange("q7",parseInt(t.target.value,10))},min:"1",max:"6",name:"q7",id:"q7"}),n.length,e.state.q7)),n.push(e.renderQuestionContainer("How appropriate was the downhill speed for the type of song you chose?",o.a.createElement("input",{type:"text",value:e.state.q8,onChange:function(t){return e.handleChange("q8",t.target.value)},name:"q8",id:"q8"}),n.length,e.state.q8?"":"Field required")),n.push(e.renderQuestionContainer("To what extent did the background elements positively complement your experience?",o.a.createElement("input",{type:"range",step:"1",value:e.state.q9,onChange:function(t){return e.handleChange("q9",parseInt(t.target.value,10))},min:"1",max:"6",name:"q9",id:"q9"}),n.length,"(1 - not at all, 6 - very much) Your answer: ".concat(e.state.q9))),n.push(e.renderQuestionContainer("Were you able to find the song you were looking for easily?",o.a.createElement("label",{className:"switch"},o.a.createElement("input",{type:"checkbox",onChange:function(t){return e.handleChange("q11",t.target.checked)},checked:e.state.q11}),o.a.createElement("span",{className:"slider"})),n.length,e.state.q11?"Yes":"No")),n.push(e.renderQuestionContainer("Did it take a short or long time to start playing the game after you picked a song?",o.a.createElement("label",{className:"switch"},o.a.createElement("input",{type:"checkbox",onChange:function(t){return e.handleChange("q12",t.target.checked)},checked:e.state.q12}),o.a.createElement("span",{className:"slider"})),n.length,e.state.q12?"Long":"Short")),n.push(e.renderQuestionContainer("Would you like to see song recommendations based on what you listened to previously?",o.a.createElement("label",{className:"switch"},o.a.createElement("input",{type:"checkbox",onChange:function(t){return e.handleChange("q13",t.target.checked)},checked:e.state.q13}),o.a.createElement("span",{className:"slider"})),n.length,e.state.q13?"Yes":"No")),n.push(e.renderQuestionContainer("Are you a musician?",o.a.createElement("label",{className:"switch"},o.a.createElement("input",{type:"checkbox",onChange:function(t){return e.handleChange("q14",t.target.checked)},checked:e.state.q14}),o.a.createElement("span",{className:"slider"})),n.length,e.state.q14?"Yes":"No")),n.push(e.renderQuestionContainer("Did you play using spotify premium?",o.a.createElement("label",{className:"switch"},o.a.createElement("input",{type:"checkbox",onChange:function(t){return e.handleChange("q15",t.target.checked)},checked:e.state.q15}),o.a.createElement("span",{className:"slider"})),n.length,e.state.q15?"Yes":"No")),o.a.createElement(W,{transitionRequestObservable:t,onMount:function(){return B(t)}},o.a.createElement("div",{className:"form-container"},o.a.createElement("form",null,n,o.a.createElement(T,{type:E.SMALL,text:"Submit!"}))))}}]),t}(a.Component),X=n(219),_=n.n(X),$=n(220),ee=n.n($),te=(n(537),function(e){var t=e.isPlaying,n=e.onPause,a=e.onResume;return o.a.createElement("div",{className:"pause-overlay-container ".concat(t?"":"cover-screen")},o.a.createElement(T,{className:"play-pause-btn ".concat(t?"playing":"paused"),onClick:function(){t&&n(),a()},text:""},o.a.createElement("img",{src:t?_.a:ee.a,alt:"Play/Pause Icon"})))}),ne=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(s.a)(this,Object(c.a)(t).call(this,e))).state={selectedSong:null,playing:!1,playbackPosition:0,displayCompletionForm:!1,displayPauseOverlay:!1,displayError:!1,menuStack:[]},n.mainMenuTransitionController=null,e.gameStateController.onNotificationOf(v.GameStateEnums.PLAY,(function(){n.state.selectedSong&&(n.props.spotifyService.play(n.state.selectedSong.id),n.setState({playing:!0,displayPauseOverlay:!0}))})),e.spotifyService.stateNotifier.filter((function(e){return"PLAYER_STATE_CHANGED"===e.state})).subscribe((function(e){return n.readAndUpdateState(e.body)})),n.playerStateUpdaterIntervalID=null,n.mountSongSearchMenu=n.mountSongSearchMenu.bind(Object(y.a)(n)),n.mountSongSelectMenu=n.mountSongSelectMenu.bind(Object(y.a)(n)),n.popMenu=n.popMenu.bind(Object(y.a)(n)),n.mainMenu=n.mainMenu.bind(Object(y.a)(n)),n.updatePlaybackState=n.updatePlaybackState.bind(Object(y.a)(n)),n.renderOverlay=n.renderOverlay.bind(Object(y.a)(n)),n}return Object(u.a)(t,e),Object(i.a)(t,[{key:"readAndUpdateState",value:function(e){var t=b.a.get(e,"track_window.current_track.id"),n=b.a.get(this.state,"selectedSong.id"),a=b.a.get(e,"paused"),o=b.a.get(e,"position");t!==n?this.state.displayCompletionForm||(this.props.gameStateController.request(v.GameStateEnums.IDLE,{reason:"Outside forces changed the song."}),this.mainMenu(),this.setState({playing:!1,displayPauseOverlay:!1}),B(this.mainMenuTransitionController),this.props.spotifyService.deactivate()):a?(0===o?(this.props.gameStateController.request(v.GameStateEnums.IDLE,{reason:"end"}),this.setState({playing:!1,displayPauseOverlay:!1,displayCompletionForm:!0}),this.props.spotifyService.deactivate()):(this.props.gameStateController.request(v.GameStateEnums.PAUSE,{reason:"paused"}),this.setState({playing:!1,playbackPosition:o})),this.terminatePlaybackStateUpdater()):(this.state.playing||this.props.gameStateController.request(v.GameStateEnums.PLAY,{reason:"unpaused"}),this.initPlaybackStateUpdater(),this.setState({playing:!0,playbackPosition:o}))}},{key:"componentDidMount",value:function(){var e=this,t=new d.Subject;this.mainMenuTransitionController=t,this.setState({menuStack:[o.a.createElement(H,{transitionRequestObservable:t,key:0},o.a.createElement(P,{hasLoggedIn:!0,onSongSelectRequest:function(){G(t),e.mountSongSearchMenu(t)}}))]})}},{key:"updatePlaybackState",value:function(){var e=this,t=this.props.spotifyService.playerState;t&&t.then((function(t){if(t){var n=t.position,a=t.paused;e.setState({playbackPosition:n,playing:!a})}else console.error("User is not playing music through the Web Playback SDK")}))}},{key:"initPlaybackStateUpdater",value:function(){this.terminatePlaybackStateUpdater(),this.playerStateUpdaterIntervalID=setInterval(this.updatePlaybackState,3e3)}},{key:"terminatePlaybackStateUpdater",value:function(){clearInterval(this.playerStateUpdaterIntervalID)}},{key:"mountSongSearchMenu",value:function(e){var t=this,n=new d.Subject,a=o.a.createElement(W,{transitionRequestObservable:n,key:1},o.a.createElement(M,{spotifyService:this.props.spotifyService,selectSong:function(e){G(n),t.mountSongSelectMenu(e,n)},onReturn:function(){G(n),t.popMenu(),B(e)}}));this.setState((function(e){return{menuStack:[].concat(Object(g.a)(e.menuStack),[a])}}))}},{key:"mountSongSelectMenu",value:function(e,t){var n=this;this.setState({selectedSong:e});var a=new d.Subject,r=o.a.createElement(W,{transitionRequestObservable:a,key:2},o.a.createElement(V,{songObject:e,onConfirmation:function(){n.initPlaybackStateUpdater(),G(a),n.props.spotifyService.getAudioAnalysisAndFeatures(e.id,(function(e){console.log("Features and analysis: ",e),n.props.gameStateController.request(v.GameStateEnums.GENERATE,e),n.props.gameStateController.notify(v.GameStateEnums.PLAY)})),n.props.spotifyService.activate(),n.mainMenu()},onReturn:function(){G(a),n.popMenu(),B(t)}}));this.setState((function(e){return{menuStack:[].concat(Object(g.a)(e.menuStack),[r])}}))}},{key:"popMenu",value:function(){this.setState((function(e){var t=e.menuStack;return t.pop(),{menuStack:Object(g.a)(t)}}))}},{key:"mainMenu",value:function(){this.setState((function(e){return{menuStack:[e.menuStack[0]]}}))}},{key:"renderOverlay",value:function(){var e=this.state,t=e.displayCompletionForm,n=e.displayPauseOverlay,a=e.displayError,r=this.props.spotifyService;return a?null:t?o.a.createElement(K,null):n?o.a.createElement(te,{isPlaying:this.state.playing,onPause:function(){r.toggle().then((function(){return r.toggle()}))},onResume:function(){r.toggle()}}):null}},{key:"render",value:function(){if(!this.props.hasLoggedIn){var e=new d.Subject;return o.a.createElement("div",null,o.a.createElement(H,{transitionRequestObservable:e,onMount:function(){return B(e)}},o.a.createElement(P,{onLoginRequest:this.props.spotifyService.login,hasLoggedIn:!1})))}var t=o.a.createElement(U,{songObject:this.state.selectedSong,positionInMilliseconds:this.state.playbackPosition,shouldDisplay:this.state.playing});return o.a.createElement("div",null,t,this.state.errorComponent,this.renderOverlay(),this.state.menuStack)}}]),t}(a.Component);ne.defaultProps={hasLoggedIn:!1};var ae=ne,oe=n(224),re=function(){function e(){Object(r.a)(this,e)}return Object(i.a)(e,[{key:"checkInUser",value:function(e,t,n){return new Promise((function(a,o){fetch("/api/user/".concat(e)).then((function(e){return e.json()})).then((function(r){if("success"===r.status)a(!0);else{if("failure"===r.status&&1===r.errorCode)return function(){var a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({spotifyID:e,displayName:t,imageUrl:n})};return fetch("/api/users",a)}();o()}})).then((function(e){return e.json()})).then((function(e){"success"===e.status?a(!1):o()})).catch((function(){return o()}))}))}},{key:"saveGameSession",value:function(e,t){var n=this;return new Promise((function(a,o){n.saveGameSessionOnly(e).then((function(e){return n.saveInputArrayOnly(t,e)})).then((function(e){return a(e)})).catch((function(e){return o(e)}))}))}},{key:"saveGameSessionOnly",value:function(e){var t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};return new Promise((function(e,n){fetch("/api/sessions",t).then((function(e){return e.json()})).then((function(t){var a=b.a.get(t,"sessions");return"success"===t.status?e(a[a.length-1].sessionID):n(t)})).catch((function(e){return n(e)}))}))}},{key:"saveInputArrayOnly",value:function(e,t){var n=e.map((function(e){return Object(oe.a)({},e,{sessionID:t})})),a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({inputs:n})};return new Promise((function(n,o){"number"!==typeof t&&o({status:"failure",reason:"something is wrong",thing:{inputArray:e,sessionID:t}}),fetch("/api/inputs",a).then((function(e){return e.json()})).then((function(e){return"success"===e.status?n():o(e)})).catch((function(e){return o(e)}))}))}},{key:"fetchLeaderboard",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t="/api/leaderboard".concat(e?"/".concat(e):""),n=function(e,n){fetch(t).then((function(e){return e.json()})).then((function(t){return"success"===t.status?e(t):n(t)})).catch((function(e){return n(e)}))};return new Promise(n)}},{key:"fetchInputs",value:function(e){var t="/api/session/".concat(e);return new Promise((function(e,n){fetch(t).then((function(e){return e.json()})).then((function(t){return"success"===t.status?e(t):n(t)})).catch((function(e){return n(e)}))}))}}]),e}(),ie=n(221),se=n.n(ie),ce=(n(575),function(e){function t(e){var n;Object(r.a)(this,t),n=Object(s.a)(this,Object(c.a)(t).call(this,e));var a=new m("".concat("Tune Mountain"," Web Player"));return a.stateNotifier.subscribe((function(e){return console.log(e)})),a.stateNotifier.filter((function(e){return"LOGGED_IN"===e.state})).subscribe((function(){return n.setState({hasLoggedIn:!0})})),n.spotifyService=a,n.apiService=new re,n.canvasReference=o.a.createRef(),n.game=null,n.gameStateController=new v.GameStateController,n.state={hasLoggedIn:!1,currentMenu:null},n}return Object(u.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){this.game=new se.a(this.gameStateController,this.canvasReference.current)}},{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement("canvas",{ref:this.canvasReference,className:"game-viewport",width:window.innerWidth,height:window.innerHeight}),o.a.createElement(ae,{spotifyService:this.spotifyService,hasLoggedIn:this.state.hasLoggedIn,gameStateController:this.gameStateController}))}}]),t}(a.Component)),ue=n(223),le=n.n(ue);n(579);le.a.render(o.a.createElement(ce,null),document.getElementById("root"))}},[[225,1,2]]]);
//# sourceMappingURL=main.94c33b55.chunk.js.map