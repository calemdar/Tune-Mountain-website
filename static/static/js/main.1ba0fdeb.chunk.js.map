{"version":3,"sources":["img/return.png","img/pause.png","img/play.png","utils/SpotifyServiceTools.js","utils/SpotifyService.js","components/hud/HUDButton.js","utils/StringTools.js","components/hud/HUDSearchBar.js","components/hud/SpotifySong.js","pages/hud/HUDSongSearchMenu.js","pages/hud/HUDMainMenu.js","components/hud/ScoreContainer.js","components/hud/HUDSongProgress.js","utils/TransitionUtils.js","components/transition/GenericTransitionWrapper.js","components/transition/FadeTransition.js","components/transition/SlideTransition.js","pages/hud/HUDSongSelectMenu.js","components/FormOverlay.js","components/hud/Controls.js","components/hud/PauseOverlay.js","components/MessageOverlay.js","components/hud/LoadingOverlay.js","utils/APIService.js","components/hud/GameSession.js","pages/hud/HUDLeaderboardsMenu.js","utils/HUDOverlayManager.js","pages/App.js","index.js"],"names":["module","exports","log","state","body","message","notifier","notification","next","console","getTokensFromQuery","urlParams","URLSearchParams","window","location","search","accessToken","get","refreshToken","history","replaceState","SpotifyService","spotifyPlayerName","$cdn","Rx","BehaviorSubject","$sdk","$token","$spotifyServiceStateNotifier","ReplaySubject","combineLatest","cdnLoaded","sdkLoaded","tokenLoaded","filter","isAllLoaded","subscribe","player","Player","Spotify","callback","connect","addListener","device_id","webPlaybackStateObject","initPlayer","refreshTokenFunction","stateNotifier","queryTokens","localStorage","setItem","localStorageRefreshToken","getItem","then","json","processTokens","this","getNewAccessToken","notif","newState","name","spotifyStateNotifier","fromCDN","onSpotifyWebPlaybackSDKReady","pause","bind","resume","toggle","disconnect","tokenToBeUsed","fetch","response","catch","error","togglePlay","songID","uri","Error","play","spotifyURI","getOAuthToken","id","access_token","details","JSON","stringify","searchQueryString","index","type","limit","url","header","err","analysisURL","featuresURL","analysis","features","analysisObject","featuresObject","userID","handler","resolve","reject","res","resJSON","display_name","images","Promise","item","songName","artistNames","dotProp","map","artist","imgURL","duration","img","createTrackObject","getCurrentState","HUDButtonTypesEnum","Object","freeze","TypeToClassMap","TypeToStyleMap","HUDButton","props","btnRef","React","createRef","text","onClick","style","children","className","disabled","isHovering","filteredType","Boolean","SMALL","onHover","setState","onMouseEnter","onMouseOver","onMouseLeave","ref","event","current","blur","buttonType","RETURN","src","returnIcon","alt","String","toLowerCase","Component","defaultProps","trimEnd","string","length","substring","HUDSearchBar","lastSubmittedValue","autoSearchTimer","handleChange","handleSubmit","clearTimeout","setTimeout","submissionTimeoutDelay","target","value","searchSongsWithQuery","letters","trim","match","words","curWord","forEach","letter","push","wordsToArray","onKeyUp","keyEvent","keyCode","placeholder","onChange","ENTER","query","SongContainerClassMap","SpotifySong","handleClick","size","arr","str","artistInArray","renderArtistArray","HUDSongSearchMenu","spotifyService","filterReceivedJSON","items","newTrackArray","songList","hasSearched","song","key","selectSong","input","renderSongList","onReturn","HUDMainMenu","hasLoggedIn","onSongSelectRequest","onLoginRequest","onAboutPageRequest","onLeaderboardsPageRequest","spotifyLoginButton","SPOTIFY","selectSongButton","aboutButton","leaderboardsButton","mainButton","ScoreContainer","replayMode","score","multiplier","HUDSongProgress","songObject","positionInMilliseconds","shouldDisplay","barProperties","componentStyle","TransitionEnums","Transition","subject","GenericTransitionWrapper","IN","OUT","transitionRequestObservable","shouldMountIn","delay","msg","position","handleTransitionStart","handleTransitionEnd","onMount","onStartTransitionIn","onStartTransitionOut","onEndTransitionIn","onEndTransitionOut","currentStyle","zIndex","onTransitionEnd","FadeTransition","mountHandler","SlideTransition","HUDSongSelectMenu","onConfirmation","rangeLowToHigh","rangeSlowFast","questionLabels","FormOverlay","question","inputComponent","currentValueDisplay","choiceLabels","questionID","other","stateObjRef","stateObjKeys","keys","handleCheckboxChange","evt","box","oldState","checked","handleOtherChange","otherValue","label","transitionObservable","Subject","questions","q1andq2Labels","renderMultipleChoiceContainer","renderQuestionContainer","q3","step","q4","parseInt","min","max","q5","q6","q7","q8","q9","q11","q12","q13","q14","form","onSubmit","preventDefault","btnText","confirmationScreen","onCancel","showForm","Controls","controlMap","highlight","hide","PauseOverlay","isPlaying","onPause","onResume","pauseIcon","playIcon","MessageOverlay","buttonText","onButtonClick","title","subtitle","paragraphs","subtitleElement","titleElement","bodyElement","Array","isArray","paragraph","LoadingOverlay","onUnmount","APIService","spotifyID","displayName","imageUrl","status","errorCode","init","addNewUser","sessionObject","inputArray","saveGameSessionOnly","saveInputArrayOnly","responseJSON","sessionID","modifiedArray","timestamp","action","headers","Headers","append","process","responseObject","GameSession","rank","onReplayRequest","color","colSpan","profilePicture","HUDLeaderboardsMenu","makeComplexSession","fetchLeaderboard","sessions","session","gameVersion","userInfoPromise","getUserInfo","songInfoPromise","getSongInfo","all","userObject","output","fetchInputs","inputs","handleReplayRequest","HUDOverlayManager","mainMenuTransitionController","gameStateController","onNotificationOf","GameStateEnums","PLAY","selectedSong","onReplayPlaybackStart","onGameStart","SCORE_CHANGED","stateLog","readAndUpdateState","playerStateUpdaterIntervalID","mountSongSearchMenu","mountSongSelectMenu","popMenu","mainMenu","updatePlaybackState","renderOverlay","stateObj","givenId","currentId","paused","displayCompletionForm","request","IDLE","onReplayInterruptRequest","onGameInterrupted","deactivate","terminatePlaybackStateUpdater","onGameFinish","PAUSE","onGamePause","playing","initPlaybackStateUpdater","mountLeaderboardsPage","spotifyPlayerState","playerState","setInterval","clearInterval","prevScreenTransitionObservable","songSearchMenu","inputHistory","onReplayBeginRequest","getAudioAnalysisAndFeatures","object","GENERATE","activate","menuStack","oldStack","pop","show","reload","displayPauseOverlay","displayError","displayWelcomeOverlay","handleResume","respObj","submitFeedback","displayLoadingOverlay","mountLoadingOverlay","observable","progBar","playbackPosition","errorComponent","renderLoadingOverlay","login","mainComponent","App","userObj","checkInUser","apiService","canvasReference","game","GameStateController","inputManager","handleGameFinish","handleGameInterrupt","handleGamePause","handleGameResume","handleGameStart","handleReplayBeginRequest","handleReplayInterruptRequest","handleReplayPlaybackStart","InputManager","Game","startSession","pauseSession","resumeSession","terminateSession","user","saveGameSession","loadInputsForReplay","terminateReplaySession","beginReplaySession","width","innerWidth","height","innerHeight","onGameResume","ReactDOM","render","document","getElementById"],"mappings":"2IAAAA,EAAOC,QAAU,kzU,kBCAjBD,EAAOC,QAAU,soC,kBCAjBD,EAAOC,QAAU,k2D,mhBCaXC,EAAM,SAACC,EAAOC,GAAyC,IAAnCC,EAAkC,uDAAxB,GAAIC,EAAoB,uDAAT,KAEzCC,EAAe,CACjB,OAAU,iBACVJ,QACAC,OACAC,WAIAC,EAAUA,EAASE,KAAKD,GACvBE,QAAQP,IAAIK,IAQfG,EAAqB,WACvB,IAAMC,EAAY,IAAIC,gBAAgBC,OAAOC,SAASC,QAChDC,EAAcL,EAAUM,IAAI,eAC5BC,EAAeP,EAAUM,IAAI,gBAKnC,OAFAJ,OAAOM,QAAQC,aAAa,KAAM,GAAI,KAE/B,CACHJ,cACAE,iB,iBCuaOG,E,WAlcd,WAAaC,GAAoB,IAAD,2BAG/B,IAAMC,EAAO,IAAIC,IAAGC,iBAAgB,GAC9BC,EAAO,IAAIF,IAAGC,iBAAgB,GAC9BE,EAAS,IAAIH,IAAGC,iBAAgB,GAMhCG,EAA+B,IAAIJ,IAAGK,cAwC5CN,EAAKO,cACJJ,EACAC,GACA,SAACI,EAAWC,EAAWC,GAAvB,OAAuCF,GAAaC,GAAaC,KAEhEC,QAAO,SAAAC,GAAW,OAAIA,KACtBC,WAAU,WACVlC,EAAI,YAAa,KAAM,sBAAuB0B,GA5C7B,WAGlB,IAAI,EAAKS,OAAT,CAHwB,IAKjBC,EAAUzB,OAAO0B,QAAjBD,OAMP,EAAKD,OAAS,IAAIC,EAAO,CACxB,KAAQ,gBACR,cAAiB,SAAAE,GAAQ,OAAIA,EAAS,EAAKxB,cAC3C,OAAU,KAGX,EAAKqB,OAAOI,UAGZ,EAAKJ,OAAOK,YAAY,SAAS,YAAkB,IAAhBC,EAAe,EAAfA,UAClCzC,EAAI,eAAD,kDAA4DyC,GAAaf,MAI7E,EAAKS,OAAOK,YAAY,wBAAwB,SAAAE,GAAsB,OAAI1C,EACzE,uBACA0C,EACA,gCACAhB,OAgBAiB,MDrBkB,SAACC,GAAgD,IAA1BC,EAAyB,uDAAT,KAGnDC,EAActC,IAEhBM,EAAc,KACdE,EAAe,KAGnB,GAAI8B,EAAYhC,aAAegC,EAAY9B,aAGvCF,EAAcgC,EAAYhC,YAC1BE,EAAe8B,EAAY9B,aAG3BhB,EAAI,wBAAyB,CACzBc,cACAE,gBACD,gDAAiD6B,GAGpDE,aAAaC,QA1EK,wBA0EsBF,EAAY9B,kBAEjD,CAGHhB,EAAI,mCAAoC,KAAM,iEAAkE6C,GAEhH,IAAMI,EAA2BF,aAAaG,QAjF5B,yBAoFdD,GAEAjD,EACA,mBACI,KACA,uFACA6C,GAGJD,EAAqBK,GAChBE,MAAK,SAAAC,GAEFpD,EACI,wBACA,CACI,YAAeoD,EAAKtC,YACpB,aAAgBmC,GAEpB,gCACAJ,OAOZ7C,EACI,kBACA,KACA,kDACA6C,ICrCdQ,CAAcC,KAAKC,kBAAmB7B,GAGhCA,EACKM,QAAO,SAAAwB,GAAK,MAAoB,0BAAhBA,EAAMvD,SACtBiC,WAAU,SAAAuB,GAAY,MAMfA,EAASvD,KAFTY,EAJe,EAIfA,YACAE,EALe,EAKfA,aAGJ,EAAKF,YAAcA,EACnB,EAAKE,aAAeA,EAEhBF,GAAeE,EAAcS,EAAOnB,MAAK,GACxCmB,EAAOnB,MAAK,MAI/BgD,KAAKI,KAAOtC,EACZkC,KAAKnB,OAAS,KACdmB,KAAKK,qBAAuBjC,EAG5BkC,IAAQ,CAAC,0CACPT,MAAK,WACL9B,EAAKf,MAAK,MAGZK,OAAOkD,6BAA+B,kBAAMrC,EAAKlB,MAAK,IAEtDgD,KAAKK,qBAAuBjC,EAG5B4B,KAAKQ,MAAQR,KAAKQ,MAAMC,KAAKT,MAC7BA,KAAKU,OAASV,KAAKU,OAAOD,KAAKT,MAC/BA,KAAKW,OAASX,KAAKW,OAAOF,KAAKT,M,uDAyB/B,OAAIA,KAAKnB,OAAemB,KAAKnB,OAAOI,UAE7B,O,mCAIHe,KAAKnB,QAAQmB,KAAKnB,OAAO+B,e,0CAQU,IAAtBlD,EAAqB,uDAAN,KAE1BmD,EAAgBnD,GAA8BsC,KAAKtC,aAEzD,OAAOoD,MAAM,GAAD,OAAkC,GAAlC,0CAAsED,IAChFhB,MAAK,SAAAkB,GAAQ,OAAIA,EAASjB,UAC1BkB,OAAM,SAAAC,GACNhE,QAAQgE,MAAMA,Q,8BAUhB,OAAIjB,KAAKnB,OAAemB,KAAKnB,OAAO2B,QAE7B,O,+BASP,OAAIR,KAAKnB,OAAemB,KAAKnB,OAAOqC,aAE7B,O,+BASP,OAAIlB,KAAKnB,OAAemB,KAAKnB,OAAO6B,SAE7B,O,2BAQHS,GAEJ,IAAMC,EAAG,wBAAoBD,GAE7B,IAAKnB,KAAKnB,OAAQ,MAAM,IAAIwC,MAAM,2BAElC,IAAMC,EAAO,SAAC,GAQP,IAPNC,EAOK,EAPLA,WAOK,4BAJHC,EAIG,EAJHA,cACAC,EAGG,EAHHA,GAIFD,GAAc,SAAAE,GACb,IAAMC,EAAU,CACf,OAAU,MACV,QAAW,CACV,eAAgB,mBAChB,cAAgB,UAAhB,OAA2BD,KAIzBH,IACHI,EAAQ/E,KAAOgF,KAAKC,UAAU,CAAC,KAAQ,CAACN,MAGzCT,MAAM,uDAAD,OACkDW,GACtDE,GACC9B,MAAK,kBAAM5C,QAAQP,IAAR,gCAAqC6E,WAKpDD,EAAK,CACJ,eAAkBtB,KAAKnB,OACvB,WAAcuC,M,8BAWfnE,QAAQP,IAAI,+CACZW,OAAOC,SAAP,UAAmD,GAAnD,4B,+BAiBA,IAJqC,IAAD,OAA9B0B,EAA8B,uDAAnB,KAGb8C,EAAoB,KACfC,EAAQ,EAAGA,GAAK,0CAAoBA,IAG5CD,GAA8BC,EAAb,uBAAaA,EAAb,mBAAaA,EAAb,GAGjBD,GAAqBC,EAAQ,KAAR,0CAAgC,GAAK,MAK3D,IAAMC,EAAO,aACPC,EAAQ,UAGRC,EAAG,4CAAwCJ,EAAxC,YAA6DE,EAA7D,YAAqEC,GACxEE,EAAS,CACd,OAAU,MACV,QAAW,CACV,OAAU,mBACV,eAAgB,mBAChB,cAAgB,UAAhB,OAA2BnC,KAAKxC,eAKlCsD,MAAMoB,EAAKC,GACTtC,MAAK,SAAAkB,GAAQ,OAAIA,EAASjB,UAC1BD,MAAK,SAAAC,GAGLpD,EACC,iBACAoD,EACA,+BACA,EAAKO,sBAKFrB,GAAUA,EAASc,MAGvBkB,OAAM,SAAAoB,GACN,MAAM,IAAIf,MAAMe,Q,kDAYSX,EAAIzC,GAAW,IAAD,OAEnCqD,EAAW,oDAAgDZ,GAC3Da,EAAW,oDAAgDb,GAE3DU,EAAS,CACd,OAAU,MACV,QAAW,CACV,OAAU,mBACV,eAAgB,mBAChB,cAAgB,UAAhB,OAA2BnC,KAAKxC,eAI9B+E,EAAW,KACXC,EAAW,KAEf1B,MAAMuB,EAAaF,GACjBtC,MAAK,SAAAkB,GAAQ,OAAIA,EAASjB,UAC1BD,MAAK,SAAA4C,GAGL,OAFAF,EAAWE,EAEJ3B,MAAMwB,EAAaH,MAE1BtC,MAAK,SAAAkB,GAAQ,OAAIA,EAASjB,UAC1BD,MAAK,SAAA6C,GACLF,EAAWE,EAEP1D,GAGHA,EAAS,CACRwD,WACAD,aAMF7F,EACC,kBACA,CACC,cAAiB8F,EACjB,cAAiBD,GAElB,sBACA,EAAKlC,yBAINW,OAAM,SAAAC,GAAK,OAAIhE,QAAQgE,MAAMA,Q,oCAQJ,IAAD,OAAf0B,EAAe,uDAAN,KAEdC,EAAU,SAACC,EAASC,GAEzB,IAAMZ,EAAMS,EAAM,2CAAuCA,GAAW,gCAC9DR,EAAS,CACd,OAAU,MACV,QAAW,CACV,OAAU,mBACV,eAAgB,mBAChB,cAAgB,UAAhB,OAA2B,EAAK3E,eAIlC,OAAOsD,MAAMoB,EAAKC,GAChBtC,MAAK,SAAAkD,GAAG,OAAIA,EAAIjD,UAChBD,MAAK,SAAAmD,GAAO,OAAIH,EAAQ,CACxB,UAAaG,EAAQvB,GACrB,YAAeuB,EAAQC,aACvB,SAAYD,EAAQE,OAAO,GAAKF,EAAQE,OAAO,GAAGhB,IAAM,kGAExDlB,OAAM,SAAAoB,GAAG,OAAIU,EAAOV,OAIvB,OAAO,IAAIe,QAAQP,K,kCAURzB,GAAS,IAAD,OAuCnB,OAAO,IAAIgC,SArCK,SAACN,EAASC,GAEzB,IAAMZ,EAAG,4CAAwCf,GAC3CgB,EAAS,CACd,OAAU,MACV,QAAW,CACV,OAAU,mBACV,eAAgB,mBAChB,cAAgB,UAAhB,OAA2B,EAAK3E,eAYlC,OAAOsD,MAAMoB,EAAKC,GAChBtC,MAAK,SAAAkD,GAAG,OAAIA,EAAIjD,UAChBD,MAAK,SAAAuD,GAEL,IAAM3B,EAAK2B,EAAK3B,GACV4B,EAAWD,EAAKhD,KAChBkD,EAAcC,IAAQ9F,IAAI2F,EAAM,WAAWI,KAAI,SAAAC,GAAM,OAAIA,EAAOrD,QAChEsD,EAASH,IAAQ9F,IAAI2F,EAAM,gBAAgB,GAAGlB,IAC9CyB,EAAWJ,IAAQ9F,IAAI2F,EAAM,eAEnCP,EAlBwB,SAACpB,EAAIrB,EAAMqD,EAAQG,EAAKD,GAAxB,MAAsC,CAC/DvD,OACAqD,SACAG,MACAnC,KACAkC,YAaSE,CAAkBpC,EAAI4B,EAAUC,EAAaI,EAAQC,OAG7D3C,OAAM,SAAAoB,GAAG,OAAIU,EAAOV,W,oCA3UvB,OAAOpC,KAAKK,uB,kCAQZ,OAAIL,KAAKnB,OAAemB,KAAKnB,OAAOiF,kBAE7B,S,+CC3HIC,G,OAAqBC,OAAOC,OAAO,CAC5C,MAAS,QACT,MAAS,QACT,OAAU,SACV,MAAS,QACT,QAAW,aAGTC,EAAiBF,OAAOC,OAAO,CACjC,MAAS,mBACT,MAAS,mBACT,OAAU,oBACV,MAAS,mBACT,QAAW,oCAGTE,EAAiBH,OAAOC,OAAO,CACjC,MAAS,2BACT,OAAU,4BACV,MAAS,2BACT,QAAW,6BAWTG,E,YAEF,WAAYC,GAAQ,IAAD,8BACf,4CAAMA,KAED1H,MAAQ,CACT,YAAc,GAGlB,EAAK2H,OAASC,IAAMC,YAPL,E,sEAWT,IAAD,SAWDxE,KAAKqE,MAPLrC,EAJC,EAIDA,KACAyC,EALC,EAKDA,KACAC,EANC,EAMDA,QACAC,EAPC,EAODA,MACAC,EARC,EAQDA,SACAC,EATC,EASDA,UACAC,EAVC,EAUDA,SAIAC,EACA/E,KAAKrD,MADLoI,WAKEC,EADcC,QAAQlB,EAAmB/B,IACZkC,EAAelC,GAAQkC,EAAegB,MAQnEC,EAAU,kBAAM,EAAKC,SAAS,CAAC,YAAeN,IAAY,KAIhE,OACI,yBAAKO,aAAcF,EACdG,YAAaH,EACbI,aANU,kBAAM,EAAKH,SAAS,CAAC,YAAc,KAO7CP,UAAS,yBAAoBA,GAC7BF,MAAOA,GAER,4BACIa,IAAKxF,KAAKsE,OACVO,UAAS,qBAAgBG,EAAhB,YAAgCD,EAAU,UAAMZ,EAAenC,GAArB,YAAuC,IAC1F8C,SAAUA,EACVJ,QAAU,SAAAe,GACN,EAAKnB,OAAOoB,QAAQC,OACpBF,EAAMG,WAAaZ,EACnBN,EAAQe,KAxBhBzD,IAAS+B,EAAmB8B,OAAe,yBAAKC,IAAKC,IAAYC,IAAI,gBAChEvB,EAAawB,OAAOxB,GAAMyB,cAE5BtB,Q,GArCKuB,aAoFxB/B,EAAUgC,aAAe,CACrB,KAAQrC,EAAmBmB,MAC3B,KAAQ,sBACR,QAAW,kBAAMjI,QAAQgE,MAAM,2CAC/B,QAAW,kBAAMhE,QAAQgE,MAAM,2CAC/B,WAAc,kBAAMhE,QAAQgE,MAAM,+CAClC,UAAa,GACb,YAAc,EACd,UAAY,GAGDmD,QC3FTiC,EAAU,SAACC,GAAgD,IAAxCC,EAAuC,uDA7C9B,GA+C9B,GAAID,EAAOC,QAAUA,EAAQ,OAAOD,EAEpC,IAAME,EAAYF,EAAOE,UAAU,EAAGD,GAEtC,MAAM,GAAN,OAAUC,EAAV,QC9CEC,G,mBAEF,WAAYpC,GAAQ,IAAD,8BACf,4CAAMA,KAED1H,MAAQ,CACT,MAAS,IAEb,EAAK+J,mBAAqB,KAE1B,EAAKC,gBAAkB,KAGvB,EAAKC,aAAe,EAAKA,aAAanG,KAAlB,gBACpB,EAAKoG,aAAe,EAAKA,aAAapG,KAAlB,gBAZL,E,0EAoBNgF,GAGLzF,KAAK2G,iBAAiBG,aAAa9G,KAAK2G,iBAC5C3G,KAAK2G,gBAAkBI,WAAW/G,KAAK6G,aAAc7G,KAAKqE,MAAM2C,wBAEhEhH,KAAKoF,SAAS,CAAC,MAASK,EAAMwB,OAAOC,U,qCAYZ,KAArBlH,KAAKrD,MAAMuK,OAGXlH,KAAKrD,MAAMuK,QAAUlH,KAAK0G,qBAE1B1G,KAAKqE,MAAM8C,qBDzCF,SAAAb,GAGjB,IAMMc,EANYd,EAAOe,OAMCC,MAHZ,iBAKRC,EAAQ,GACVC,EAAU,GAad,OAVAJ,EAAQK,SAAQ,SAACC,EAAQ3F,GACN,MAAX2F,GACIF,EAAQjB,OAAS,GAAGgB,EAAMI,KAAKH,GACnCA,EAAU,KAEVA,GAAWE,EACP3F,EAAQ,IAAMqF,EAAQb,QAAQgB,EAAMI,KAAKH,OAI9CD,ECgBiCK,CAAa5H,KAAKrD,MAAMuK,QACxDlH,KAAK0G,mBAAqB1G,KAAKrD,MAAMuK,S,+BAMnC,IAAD,OACL,OACI,yBACIrC,UAAU,uBACVgD,QAAS,SAAAC,GACoB,KAArBA,EAASC,SAAgB,EAAKlB,iBAGtC,2BACIhC,UAAU,WACVmD,YAAahI,KAAKqE,MAAM2D,YACxBhG,KAAK,OAAOkF,MAAOlH,KAAKrD,MAAMuK,MAC9Be,SAAUjI,KAAK4G,eAEnB,kBAAC,EAAD,CAAW5E,KAAM+B,EAAmBmE,MACzBzD,KAAK,SACLC,QAAS1E,KAAK6G,oB,GApEdV,cA6E3BM,EAAaL,aAAe,CACxB,qBAAwB,SAAA+B,GACpB,MAAM,IAAI9G,MAAJ,2CAA8C8G,EAA9C,0BAEV,YAAe,6BACf,uBAA0B,KAUf1B,QC7FT2B,G,OAAwBpE,OAAOC,OAAO,CACxC,MAAS,uBACT,MAAS,uBACT,KAAQ,yBAUNoE,EAAc,SAAAhE,GAAU,IAGtBjE,EAOAiE,EAPAjE,KACAqB,EAMA4C,EANA5C,GACAiC,EAKAW,EALAX,OACAD,EAIAY,EAJAZ,OACAE,EAGAU,EAHAV,SACA2E,EAEAjE,EAFAiE,YACAC,EACAlE,EADAkE,KAeJ,OACI,yBAAK1D,UAAS,UAAKuD,EAAsBG,GAA3B,mBAAmD7D,QAAS,kBAAM4D,EAAY,CACxFlI,OACAqB,KACAiC,SACAD,SACAE,eAEA,yBAAKkB,UAAU,aAAaiB,IAAKpC,EAAQsC,IAAG,+BAA0B5F,EAA1B,sBAA4CqD,KACxF,yBAAKoB,UAAU,uBACX,wBAAIA,UAAU,aAAawB,EAAQjG,EAAM,KACzC,wBAAIyE,UAAU,eAAewB,EAvBf,SAAAmC,GAEtB,IAAIC,EAAM,GAOV,OALAD,EAAIf,SAAQ,SAACiB,EAAe3G,GACzB0G,GAAOC,EACPD,GAAO1G,EAAQ,IAAMyG,EAAIjC,OAAS,GAAK,QAGnCkC,EAcsCE,CAAkBlF,QAOvE4E,EAAYjC,aAAe,CACvB,KAAQ,wBACR,GAAM,eACN,OAAU,sBACV,OAAU,YACV,UAAa,EACb,YAAe,WACXnJ,QAAQP,IAAI,kBAEhB,KAAQ,SAaG2L,QCpETO,E,YAEF,WAAYvE,GAAQ,IAAD,EAGf,GAHe,oBACf,4CAAMA,KAEDA,EAAMwE,eAAgB,MAAM,IAAIxH,MAAM,wEAH5B,OAMf,EAAKwH,eAAiBxE,EAAMwE,eAG5B,EAAKlM,MAAQ,CACT,SAAY,GACZ,aAAe,GAInB,EAAKmM,mBAAqB,EAAKA,mBAAmBrI,KAAxB,gBAfX,E,gFA0BAX,GAGf,IAAMiJ,EAAQxF,IAAQ9F,IAAIqC,EAAM,gBAChC,IAAKiJ,EAAO,MAAM,IAAI1H,MAAM,sCAI5B,IAQM2H,EAAgBD,EAAMvF,KAAI,SAAAJ,GAQ5B,OAhBsB,SAAC3B,EAAIrB,EAAMqD,EAAQG,EAAKD,GAAxB,MAAsC,CAC5DvD,OACAqD,SACAG,MACAnC,KACAkC,YAWOE,CANIT,EAAK3B,GACC2B,EAAKhD,KACFmD,IAAQ9F,IAAI2F,EAAM,WAAWI,KAAI,SAAAC,GAAM,OAAIA,EAAOrD,QACvDmD,IAAQ9F,IAAI2F,EAAM,gBAAgB,GAAGlB,IACnCqB,IAAQ9F,IAAI2F,EAAM,mBAOvCpD,KAAKoF,SAAS,CACV,SAAY4D,M,uCASF,IAAD,SAEmBhJ,KAAKrD,MAA9BsM,EAFM,EAENA,SAAUC,EAFJ,EAEIA,YAEjB,OAAwB,IAApBD,EAAS1C,QAAgB2C,EAElB,wBAAIrE,UA/EA,WA+EJ,uCAIJoE,EAASzF,KAAI,SAAA2F,GAAI,OAAI,kBAAC,EAAD,CACpB/I,KAAM+I,EAAK/I,KACXqD,OAAQ0F,EAAK1F,OACbC,OAAQyF,EAAKvF,IACbD,SAAUwF,EAAKxF,SACflC,GAAI0H,EAAK1H,GACT2H,IAAKD,EAAK1H,GACV6G,YAAa,kBAAM,EAAKjE,MAAMgF,WAAWF,W,+BAM3C,IAAD,OAEL,OACI,yBAAKtE,UAAU,mCACX,yBAAKA,UAAU,mCACX,kBAAC,EAAD,CACIsC,qBAAsB,SAAAmC,GAAK,OAAI,EAAKT,eAAetL,OAAO,EAAKuL,mBAAoBQ,MAEvF,yBAAKzE,UAAW,uBACX7E,KAAKuJ,kBAEV,kBAAC,EAAD,CACI9E,KAAM,IACNzC,KAAM+B,EAAmB8B,OACzBnB,QAAS1E,KAAKqE,MAAMmF,iB,GAxGZrD,aAkHhCyC,EAAkBxC,aAAe,CAC7B,eAAkB,KAClB,WAAc,SAAA+C,GACVlM,QAAQgE,MAAM,0CAA2CkI,IAE7D,SAAY,WACRlM,QAAQgE,MAAM,sCAWP2H,QCtITa,G,OAAc,SAAApF,GAAU,IAGtBqF,EAKArF,EALAqF,YACAC,EAIAtF,EAJAsF,oBACAC,EAGAvF,EAHAuF,eACAC,EAEAxF,EAFAwF,mBACAC,EACAzF,EADAyF,0BAIEC,EAAqB,kBAAC,EAAD,CACvBtF,KAAK,gBACLC,QAASkF,EACT5H,KAAM+B,EAAmBiG,UAGvBC,EAAmB,kBAAC,EAAD,CACrBxF,KAAK,cACLC,QAASiF,EACT3H,KAAM+B,EAAmBiG,UAGvBE,EAAc,kBAAC,EAAD,CAChBzF,KAAK,QACLC,QAASmF,EACT/E,UAAU,IAGRqF,EAAqB,kBAAC,EAAD,CACvB1F,KAAK,eACLC,QAASoF,IAIPM,EAAaV,EAAcO,EAAmBF,EAEpD,OAEI,yBAAKlF,UAAU,iCACX,yBAAKA,UAAU,kCACVuF,EACAD,EACAD,MAkBjBT,EAAYrD,aAAe,CACvB,aAAe,EACf,oBAAuB,WACnB,MAAM,IAAI/E,MAAM,uBAEpB,eAAkB,WACd,MAAM,IAAIA,MAAM,uBAEpB,mBAAsB,WAClB,MAAM,IAAIA,MAAM,uBAEpB,0BAA6B,WACzB,MAAM,IAAIA,MAAM,wBAIToI,QChEAY,G,cApBQ,SAAAhG,GACnB,OAAIA,EAAMiG,WACC,yBAAKzF,UAAU,mBAClB,6CAKD,yBAAKA,UAAU,mBACV,uCAAgB,4BAAKR,EAAMkG,OAAW,gCAAMlG,EAAMmG,eCqEnDC,EA5ES,SAAApG,GAAU,IAG1BqG,EAMArG,EANAqG,WACAC,EAKAtG,EALAsG,uBACAC,EAIAvG,EAJAuG,cACAL,EAGAlG,EAHAkG,MACAC,EAEAnG,EAFAmG,WACAF,EACAjG,EADAiG,WAGJ,IAAKI,EAAY,OAAO,KAXK,IAczBtK,EAKAsK,EALAtK,KACAqB,EAIAiJ,EAJAjJ,GACAmC,EAGA8G,EAHA9G,IACAH,EAEAiH,EAFAjH,OACAE,EACA+G,EADA/G,SAKEkH,EAAgB,CAClB,MAAQ,GAAR,OAHeF,EAAyBhH,EAAW,IAGnD,MAGEmH,EAAiB,CACnB,QAAWF,EAAgB,QAAU,QAGzC,OACI,yBACI/F,UAAW,8BACXF,MAAOmG,GAEP,yBAAKrJ,GAAI,eACL,yBACIA,GAAI,eACJkD,MAAOkG,KAGf,yBAAKhG,UAAW,0BACR,kBAAC,EAAD,CACIzE,KAAMA,EACNqD,OAAQA,EACRC,OAAQE,EACRnC,GAAIA,EACJ8G,KAAM,SAEV,kBAAC,EAAD,CACIgC,MAAOA,GAAgB,EACvBC,WAAYA,GAA0B,EACtCF,WAAYA,OCtD9BS,EACI,KADJA,EAEK,MAOLC,EACI,SAAAC,GACEA,EACAA,EAAQjO,KAAK,CACT,SAAY+N,IAEb9N,QAAQgE,MAAM,qBANvB+J,EAQK,SAAAC,GACCA,EACAA,EAAQjO,KAAK,CACT,SAAY+N,IAEb9N,QAAQgE,MAAM,qBCVvBiK,G,mBAEF,WAAY7G,GAAQ,IAAD,sBACf,4CAAMA,IADS,IAKX8G,EAGA9G,EAHA8G,GACAC,EAEA/G,EAFA+G,IACAC,EACAhH,EADAgH,4BAPW,OAWf,EAAK1O,MAAQ,CACT,SAAY0H,EAAMiH,cAAgBP,EAAqBA,EACvD,aAAgB1G,EAAMiH,cAAgBH,EAAKC,GAI/CC,EAA4BE,MAAM,KAAK3M,WAAU,SAAA4M,GAAQ,IAGjDC,EACAD,EADAC,SAGAA,IAAaV,GAEb,EAAKW,sBAAsBD,GAC3B,EAAKrG,SAAS,CACVqG,WACA,aAAgBpH,EAAM8G,MAGnBM,IAAaV,GAEpB9N,QAAQP,IAAI,oBAEZ,EAAKgP,sBAAsBD,GAC3B,EAAKrG,SAAS,CACVqG,WACA,aAAgBpH,EAAM+G,OAGvBnO,QAAQgE,MAAM,8CAA+CwK,MAKxE,EAAKC,sBAAwB,EAAKA,sBAAsBjL,KAA3B,gBAC7B,EAAKkL,oBAAsB,EAAKA,oBAAoBlL,KAAzB,gBA/CZ,E,iFAmDE,IAGbmL,EACA5L,KAAKqE,MADLuH,QAGAA,GAASA,M,4CASKH,GAElB,OAAOA,GAEH,KAAKV,EAED,IAAK/K,KAAKqE,MAAMwH,oBAAqB,MACrC7L,KAAKqE,MAAMwH,sBACX,MACJ,KAAKd,EAED,IAAK/K,KAAKqE,MAAMyH,qBAAsB,MACtC9L,KAAKqE,MAAMyH,uBACX,MACJ,QACI7O,QAAQgE,MAAM,qCAAsCwK,M,4CAY5D,OAAOzL,KAAKrD,MAAM8O,UAEd,KAAKV,EACD,IAAK/K,KAAKqE,MAAM0H,kBAAmB,MACnC/L,KAAKqE,MAAM0H,oBACX,MACJ,KAAKhB,EACD,IAAK/K,KAAKqE,MAAM2H,mBAAoB,MACpChM,KAAKqE,MAAM2H,qBACX,MACJ,QACI/O,QAAQgE,MAAM,qCAAsCjB,KAAKrD,MAAM8O,a,+BAOvE,OACI,yBACI5G,UAAW,qBACXF,MAAK,eACE3E,KAAKrD,MAAMsP,aADb,CAED,OAAUjM,KAAKqE,MAAM6H,SAEzBC,gBAAiBnM,KAAK2L,qBAErB3L,KAAKqE,MAAMO,c,GA1HWuB,cAgJvC+E,EAAyB9E,aAAe,CACpC,QAAW,kBAAMnJ,QAAQP,IAAI,uBAC7B,oBAAuB,KACvB,qBAAwB,KACxB,kBAAqB,KACrB,mBAAsB,KACtB,eAAiB,EACjB,OAAU,GAGCwO,QCtKTkB,EAAiB,SAAA/H,GAAU,IAGzBiH,EAQAjH,EARAiH,cACAO,EAOAxH,EAPAwH,oBACAC,EAMAzH,EANAyH,qBACAC,EAKA1H,EALA0H,kBACAC,EAIA3H,EAJA2H,mBACAX,EAGAhH,EAHAgH,4BACAO,EAEAvH,EAFAuH,QACAM,EACA7H,EADA6H,OAIEG,EAAeT,GAAoB,kBAAMZ,EAAcK,IAE7D,OACI,kBAAC,EAAD,CACIa,OAAQA,EACRd,IAAK,CAAC,QAAW,GACjBD,GAAI,CAAC,QAAW,GAChBG,cAAeA,EACfD,4BAA6BA,EAC7BO,QAASS,EACTN,kBAAmBA,EACnBC,mBAAoBA,EACpBH,oBAAqBA,EACrBC,qBAAsBA,GACxBzH,EAAMO,WAiBhBwH,EAAehG,aAAe,CAC1B,eAAiB,EACjB,OAAU,GAGCgG,QClDTE,EAAkB,SAAAjI,GAAU,IAG1BiH,EAQAjH,EARAiH,cACAO,EAOAxH,EAPAwH,oBACAC,EAMAzH,EANAyH,qBACAC,EAKA1H,EALA0H,kBACAC,EAIA3H,EAJA2H,mBACAX,EAGAhH,EAHAgH,4BACAO,EAEAvH,EAFAuH,QACAM,EACA7H,EADA6H,OAIEG,EAAeT,GAAoB,kBAAMZ,EAAcK,IAE7D,OACI,kBAAC,EAAD,CACIa,OAAQA,EACRd,IAAK,CAAC,KAAQ,QACdD,GAAI,CAAC,KAAQ,KACbG,cAAeA,EACfD,4BAA6BA,EAC7BO,QAASS,EACTN,kBAAmBA,EACnBC,mBAAoBA,EACpBH,oBAAqBA,EACrBC,qBAAsBA,GACxBzH,EAAMO,WAiBhB0H,EAAgBlG,aAAe,CAC3B,eAAiB,GAGNkG,QCKAC,G,OA7CW,SAAAlI,GAAU,IAG5BqG,EAEArG,EAFAqG,WACA8B,EACAnI,EADAmI,eAIApM,EAIAsK,EAJAtK,KACAqB,EAGAiJ,EAHAjJ,GACAmC,EAEA8G,EAFA9G,IACAH,EACAiH,EADAjH,OAOJ,OACI,yBAAKoB,UAAU,mCACP,kBAAC,EAAD,CACI0D,KAAK,QACLnI,KAAMA,EACNqB,GAAIA,EACJiC,OAAQE,EACRH,OAAQA,IAEZ,kBAAC,EAAD,CAAWgB,KAAK,iBAAiBC,QAAS8H,EAAgB7H,MAblD,CAChB,MAAS,UAaD,kBAAC,EAAD,CAAWF,KAAM,IAAKzC,KAAM+B,EAAmB8B,OAAQnB,QAASL,EAAMmF,cC9BhFiD,G,OAAiB,CAAC,cAAe,SAAU,kBAAmB,gBAAiB,OAAQ,cACvFC,GAAgB,CAAC,WAAY,aAAc,YAEpCC,GACH,4CADGA,GAEH,oDAFGA,GAGH,oFAHGA,GAIH,2GAJGA,GAKH,6FALGA,GAMH,oGANGA,GAOH,4FAPGA,GAQH,2FARGA,GASH,0HATGA,GAUF,2DAVEA,GAWF,uFAXEA,GAYF,6EAZEA,GAaF,yCAbEA,GAcF,iDAOLC,G,YAGF,WAAYvI,GAAQ,IAAD,8BACf,4CAAMA,KAGD1H,MAAQ,CACT,QAAW,UACX,UAAY,EACZ,GAAM,CACF,OAAS,EACT,QAAU,EACV,kBAAoB,EACpB,MAAQ,EACR,KAAO,EACP,WAAa,EACb,YAAc,EACd,UAAY,GAEhB,GAAM,CACF,OAAS,EACT,QAAU,EACV,kBAAoB,EACpB,MAAQ,EACR,KAAO,EACP,WAAa,EACb,YAAc,EACd,UAAY,GAEhB,IAAM,EACN,GAAM,EACN,GAAM,EACN,GAAM,EACN,GAAM,EACN,GAAM,EACN,IAAM,EACN,IAAO,CACH,MAAQ,EACR,cAAgB,EAChB,eAAiB,EACjB,aAAe,EACf,kBAAoB,EACpB,OAAS,EACT,WAAc,IAElB,KAAO,EACP,IAAO,GACP,KAAO,EACP,IAAO,GACP,KAAQ,IAGZ,EAAKiK,aAAe,EAAKA,aAAanG,KAAlB,gBAlDL,E,0EAsDLoM,EAAU3F,GACpB,IAAM/G,EAAW,GACjBA,EAAS0M,GAAY3F,EAErBlH,KAAKoF,SAASjF,K,8CAGOsE,EAAMqI,EAAgB1D,GAAkC,IAA7B2D,EAA4B,uDAAN,KAEtE,OACI,yBAAKlI,UAAU,qBAAqBuE,IAAKA,GACrC,2BAAI3E,GACJ,yBAAKI,UAAU,iBACViI,EACAC,EAAsB,2BAAG,gCAASA,IAAoC,S,oDAMxDtI,EAAM2E,EAAK4D,EAAcC,GAA4B,IAAD,OAAfC,EAAe,wDAEzEC,EAAcnN,KAAKrD,MAAMsQ,GACzBG,EAAepJ,OAAOqJ,KAAKF,GAEjC,GAAID,GACA,GAAIF,EAAazG,SAAW6G,EAAa7G,OAAS,EAM9C,OALAtJ,QAAQgE,MAAM,mCAAoC,CAC9C,OAAU+L,EAAazG,OACvB,KAAQ6G,EAAa7G,SAGlB,UAER,GAAIyG,EAAazG,SAAW6G,EAAa7G,OAMxC,OALAtJ,QAAQgE,MAAM,mCAAoC,CAC9C,OAAU+L,EAAazG,OACvB,KAAQ6G,EAAa7G,SAGlB,KAGf,IAAM+G,EAAuB,SAAAC,GAEzB,IAAMC,EAAMD,EAAItG,OAAOC,MACjBuG,EAAWN,EACjBM,EAASD,GAAOD,EAAItG,OAAOyG,QAE3B,IAAMvN,EAAW,GACjBA,EAAS8M,GAAcQ,EAEvB,EAAKrI,SAASjF,IAIZwN,EAAoB,SAAAJ,GAEtB,IAAME,EAAWN,EACjBM,EAASG,WAAaL,EAAItG,OAAOC,MAEjC,IAAM/G,EAAW,GACjBA,EAAS8M,GAAcQ,EAEvB,EAAKrI,SAASjF,IAIlB,OACI,yBAAK0E,UAAU,qBAAqBuE,IAAKA,GACrC,2BAAI3E,GACJ,yBAAKI,UAAU,4BACVmI,EAAaxJ,KAAI,SAACqK,EAAO9L,GAAR,OAAkB,yBAAK8C,UAAU,eAAeuE,IAAK6D,EAAalL,GAChF,+BACI,2BACIC,KAAK,WACL0L,QAASP,EAAYC,EAAarL,IAClCmF,MAAOkG,EAAarL,GACpBkG,SAAUqF,IALlB,IAK4CO,OAG/CX,EAAQ,2BACLlL,KAAK,OACL8C,UAAWqI,EAAYD,MACvBhG,MAAOiG,EAAYS,WACnB3F,SAAU0F,EACVvN,KAAM6M,EACNxL,GAAIwL,IAAiB,S,+BAO/B,IAAD,OAECa,EAAuB,IAAIC,UAE3BC,EAAY,GAEZC,EAAgB,CAClB,YACA,aACA,yBACA,cACA,cACA,uBACA,aACA,mCAKAD,EAAUrG,KAAK,EAAKuG,8BAChBvB,GACAqB,EAAUzH,OACV0H,EAAe,OAInBD,EAAUrG,KAAK,EAAKuG,8BAChBvB,GACAqB,EAAUzH,OACV0H,EACA,OAIJD,EAAUrG,KAAK,EAAKwG,wBAChBxB,GACA,2BAAO9H,UAAU,UACb,2BAAO7C,KAAK,WACLiG,SAAU,SAAAsF,GAAG,OAAI,EAAK3G,aAAa,KAAM2G,EAAItG,OAAOyG,UACpDA,QAAS,EAAK/Q,MAAMyR,KAC3B,0BAAMvJ,UAAU,YAEpBmJ,EAAUzH,OACV,EAAK5J,MAAMyR,GAAK,MAAQ,OAI5BJ,EAAUrG,KAAK,EAAKwG,wBAChBxB,GACA,2BACI3K,KAAK,QACLqM,KAAK,IACLnH,MAAO,EAAKvK,MAAM2R,GAClBrG,SAAU,SAAAsF,GAAG,OAAI,EAAK3G,aAAa,KAAM2H,SAAShB,EAAItG,OAAOC,MAAO,MACpEsH,IAAI,IACJC,IAAI,IACJrO,KAAK,KACLqB,GAAG,OACPuM,EAAUzH,OACVkG,EAAe,EAAK9P,MAAM2R,GAAK,KAInCN,EAAUrG,KAAK,EAAKwG,wBAChBxB,GACA,2BACI3K,KAAK,QACLqM,KAAK,IACLnH,MAAO,EAAKvK,MAAM+R,GAClBzG,SAAU,SAAAsF,GAAG,OAAI,EAAK3G,aAAa,KAAM2H,SAAShB,EAAItG,OAAOC,MAAO,MACpEsH,IAAI,IACJC,IAAI,IACJrO,KAAK,KACLqB,GAAG,OACPuM,EAAUzH,OACVkG,EAAe,EAAK9P,MAAM+R,GAAK,KAInCV,EAAUrG,KAAK,EAAKwG,wBAChBxB,GACA,2BACI3K,KAAK,QACLqM,KAAK,IACLnH,MAAO,EAAKvK,MAAMgS,GAClB1G,SAAU,SAAAsF,GAAG,OAAI,EAAK3G,aAAa,KAAM2H,SAAShB,EAAItG,OAAOC,MAAO,MACpEsH,IAAI,IACJC,IAAI,IACJrO,KAAK,KACLqB,GAAG,OACPuM,EAAUzH,OACVkG,EAAe,EAAK9P,MAAMgS,GAAK,KAInCX,EAAUrG,KAAK,EAAKwG,wBAChBxB,GACA,2BACIhI,MAAO,CACH,MAAS,QAEb3C,KAAK,QACLqM,KAAK,IACLnH,MAAO,EAAKvK,MAAMiS,GAClB3G,SAAU,SAAAsF,GAAG,OAAI,EAAK3G,aAAa,KAAM2H,SAAShB,EAAItG,OAAOC,MAAO,MACpEsH,IAAI,IACJC,IAAI,IACJrO,KAAK,KACLqB,GAAG,OACPuM,EAAUzH,OACVmG,GAAc,EAAK/P,MAAMiS,GAAK,KAIlCZ,EAAUrG,KAAK,EAAKwG,wBAChBxB,GACA,2BACI3K,KAAK,QACLqM,KAAK,IACLnH,MAAO,EAAKvK,MAAMkS,GAClB5G,SAAU,SAAAsF,GAAG,OAAI,EAAK3G,aAAa,KAAM2H,SAAShB,EAAItG,OAAOC,MAAO,MACpEsH,IAAI,IACJC,IAAI,IACJrO,KAAK,KACLqB,GAAG,OACPuM,EAAUzH,OACVkG,EAAe,EAAK9P,MAAMkS,GAAK,KAInCb,EAAUrG,KAAK,EAAKwG,wBAChBxB,GACA,2BAAO9H,UAAU,UACb,2BAAO7C,KAAK,WACLiG,SAAU,SAAAsF,GAAG,OAAI,EAAK3G,aAAa,KAAM2G,EAAItG,OAAOyG,UACpDA,QAAS,EAAK/Q,MAAMmS,KAC3B,0BAAMjK,UAAU,YAEpBmJ,EAAUzH,OACV,EAAK5J,MAAMmS,GAAK,MAAQ,OAI5Bd,EAAUrG,KAAK,EAAKuG,8BAChBvB,GACAqB,EAAUzH,OACV,CACI,cACA,eACA,gCACA,gBACA,yBACA,SAEJ,OACA,IAIJyH,EAAUrG,KAAK,EAAKwG,wBAChBxB,GACA,2BAAO9H,UAAU,UACb,2BAAO7C,KAAK,WACLiG,SAAU,SAAAsF,GAAG,OAAI,EAAK3G,aAAa,MAAO2G,EAAItG,OAAOyG,UACrDA,QAAS,EAAK/Q,MAAMoS,MAC3B,0BAAMlK,UAAU,YAEpBmJ,EAAUzH,OACV,EAAK5J,MAAMoS,IAAM,MAAQ,OAI7Bf,EAAUrG,KAAK,EAAKwG,wBAChBxB,GACA,2BACI3K,KAAK,OACLkF,MAAO,EAAKvK,MAAMqS,IAClB/G,SAAU,SAAAsF,GAAG,OAAI,EAAK3G,aAAa,MAAO2G,EAAItG,OAAOC,QACrD9G,KAAK,MACLqB,GAAG,QACPuM,EAAUzH,OACV,EAAK5J,MAAMqS,IAAM,SAAM,mBAI3BhB,EAAUrG,KAAK,EAAKwG,wBAChBxB,GACA,2BAAO9H,UAAU,UACb,2BAAO7C,KAAK,WACLiG,SAAU,SAAAsF,GAAG,OAAI,EAAK3G,aAAa,MAAO2G,EAAItG,OAAOyG,UACrDA,QAAS,EAAK/Q,MAAMsS,MAC3B,0BAAMpK,UAAU,YAEpBmJ,EAAUzH,OACV,EAAK5J,MAAMsS,IAAM,MAAQ,OAI7BjB,EAAUrG,KAAK,EAAKwG,wBAChBxB,GACA,2BACI3K,KAAK,OACLkF,MAAO,EAAKvK,MAAMuS,IAClBjH,SAAU,SAAAsF,GAAG,OAAI,EAAK3G,aAAa,MAAO2G,EAAItG,OAAOC,QACrD9G,KAAK,MACLqB,GAAG,QACPuM,EAAUzH,OACV,KAMR,IAAM4I,EAAO,yBAAKtK,UAAW,kBACzB,0BAAMuK,SAAU,SAAA7B,GACZA,EAAI8B,iBAEJ,EAAKhL,MAAM+K,SAAS,EAAKzS,SAExBqR,EACAhO,KAAKmO,wBACF,+EACA,2BACInM,KAAK,OACLkF,MAAOlH,KAAKrD,MAAMyD,KAClB6H,SAAU,SAAAsF,GAAG,OAAI,EAAK3G,aAAa,OAAQ2G,EAAItG,OAAOC,QACtD9G,KAAK,OACLqB,GAAG,SACPuM,EAAUzH,QAEd,kBAAC,EAAD,CACI7B,QAAS,kBAAM,EAAKU,SAAS,CAAC,QAAW,mBACzCpD,KAAM+B,EAAmBmB,MACzBJ,UAAW9E,KAAKrD,MAAMyD,KACtBqE,KAAMzE,KAAKrD,MAAMyD,KAAOJ,KAAKrD,MAAM2S,QAAU,6BAInDC,EAAqB,yBAAK1K,UAAU,iCACtC,2GACA,kBAAC,EAAD,CACIH,QAAS,kBAAM,EAAKU,SAAS,CAAC,UAAY,KAC1CX,KAAM,cAEV,kBAAC,EAAD,CACIC,QAAS1E,KAAKqE,MAAMmL,SACpB/K,KAAM,eAId,OACI,kBAAC,EAAD,CACIyH,OAAQlM,KAAKqE,MAAM6H,OACnBb,4BAA6ByC,EAC7BlC,QA3PQ,kBAAMZ,EAAc8C,KA4P3B9N,KAAKrD,MAAM8S,SAAWN,EAAOI,O,GAtZpBpJ,aAma1ByG,GAAYxG,aAAe,CACvB,OAAU,GAGCwG,U,0CCvcT8C,I,OAAW,SAAArL,GAAU,IAGnBsL,EAGAtL,EAHAsL,WACAC,EAEAvL,EAFAuL,UACAC,EACAxL,EADAwL,KAKJ,OAAO,yBAAKhL,UAAS,kCAA6B+K,EAAY,4BAA8B,GAAvE,YAA6EC,EAAO,OAAS,KAC9G,yCAEI7L,OAAOqJ,KAAKsC,GAAYnM,KAAI,SAAC4F,EAAKrH,GAAN,OAAgB,wBAAIqH,IAAKA,EAAMrH,GACvD,gCAASqH,GANP,WAM4BuG,EAAWvG,UAYzDsG,GAAStJ,aAAe,CACpB,WAAc,CACV,SAAY,OACZ,EAAK,YACL,EAAK,MACL,EAAK,aACL,EAAK,aAET,WAAa,GAGFsJ,UCPAI,I,OA3BM,SAAAzL,GAAU,IAGvB0L,EAGA1L,EAHA0L,UACAC,EAEA3L,EAFA2L,QACAC,EACA5L,EADA4L,SAQJ,OACI,yBAAKpL,UAAS,kCAA6BkL,EAAY,GAAK,iBACxD,kBAAC,EAAD,CACIlL,UAAS,yBAAoBkL,EAAY,UAAY,UACrDrL,QATQ,WACZqL,GAAWC,IACfC,KAQQxL,KAAK,IACL,yBAAKqB,IAAKiK,EAAYG,KAAYC,KAAUnK,IAAI,qBAEpD,kBAAC,GAAD,CAAU4J,WAAYG,EAAWF,KAAME,OCZ7CK,I,OAAiB,SAAA/L,GAAU,IAGzBgM,EAMAhM,EANAgM,WACAC,EAKAjM,EALAiM,cACAC,EAIAlM,EAJAkM,MACAC,EAGAnM,EAHAmM,SACAC,EAEApM,EAFAoM,WACA7L,EACAP,EADAO,SAGJ,GAAIA,GAAY6L,EAIZ,OAFAxT,QAAQgE,MAAM,0EAEP,KAIX,IAAMyP,EAAkBF,EAAW,4BAAKA,GAAiB,KACnDG,EAAeJ,EAAQ,4BAAKA,GAAc,KAE5CK,EAAc,KAEdhM,EAAUgM,EAAchM,EACnB6L,GAAcI,MAAMC,QAAQL,KAAaG,EAAcH,EAAWjN,KAAI,SAACuN,EAAWhP,GAAZ,OAAsB,uBAAGqH,IAAKrH,GAAQgP,OAErH,IAAMjD,EAAuB,IAAIC,UAGjC,OAEQ,kBAAC,EAAD,CACI1C,4BAA6ByC,EAC7BxC,eAAe,EACfY,OAAQ,EACRF,mBAAoBsE,GAEpB,yBAAKzL,UAAU,mCACX,yBAAKA,UAAU,kCACV8L,EACAD,EACAE,EACD,6BACA,kBAAC,EAAD,CAAW5O,KAAM+B,EAAmBmB,MAAOT,KAAM4L,EAAY3L,QAhBvD,kBAAMsG,EAAe8C,WAgCnDsC,GAAehK,aAAe,CAC1B,WAAc,KACd,cAAiB,kBAAMnJ,QAAQgE,MAAM,6BACrC,MAAS,mBACT,SAAY,sBAIDmP,UCtCAY,I,OAvCQ,SAAA3M,GAAU,IAGzByJ,EAEAzJ,EAFAyJ,qBACAmD,EACA5M,EADA4M,UAGJ,OACI,kBAAC,EAAD,CACI5F,4BAA6ByC,EAC7BxC,eAAe,EACfY,OAAQ,EACRF,mBAAoBiF,GAEpB,yBAAKpM,UAAU,6BACX,yBAAKA,UAAU,cACX,8BACA,8BACA,8BACA,8BACA,8BACA,8BACA,8BACA,+BAEJ,wBAAIA,UAAU,gBAAd,0BACA,kBAAC,GAAD,UC6ODqM,G,yGA3PQC,EAAWC,EAAaC,GAkDvC,OAAO,IAAIlO,SA9BY,SAACN,EAASC,GAG7BhC,MAAM,aAAD,OAAcqQ,IACdtR,MAAK,SAAAkD,GAAG,OAAIA,EAAIjD,UAChBD,MAAK,SAAAmD,GAEF,GAAuB,YAAnBA,EAAQsO,OAGRzO,GAAQ,OAEL,IAAuB,YAAnBG,EAAQsO,QAA8C,IAAtBtO,EAAQuO,UAE/C,OAhCG,WAEf,IAAMC,EAAO,CACT,OAAU,OACV,QAAW,CACP,eAAgB,oBAEpB,KAAQ5P,KAAKC,UAAU,CACnBsP,YACAC,cACAC,cAIR,OAAOvQ,MAAM,aAAc0Q,GAkBRC,GAEJ3O,QAGVjD,MAAK,SAAAkD,GAAG,OAAIA,EAAIjD,UAChBD,MAAK,SAAAmD,GACqB,YAAnBA,EAAQsO,OACRzO,GAAQ,GACLC,OAEV9B,OAAM,kBAAM8B,Y,sCAgBF4O,EAAeC,GAAa,IAAD,OAW9C,OAAO,IAAIxO,SATK,SAACN,EAASC,GAEtB,EAAK8O,oBAAoBF,GACpB7R,MAAK,SAAA4B,GAAE,OAAI,EAAKoQ,mBAAmBF,EAAYlQ,MAC/C5B,MAAK,SAAAkD,GAAG,OAAIF,EAAQE,MACpB/B,OAAM,SAAAoB,GAAG,OAAIU,EAAOV,W,0CAeNsP,GAEvB,IACMF,EAAO,CACT,OAAU,OACV,QAAW,CACP,eAAgB,oBAEpB,KAAQ5P,KAAKC,UAAU6P,IAkB3B,OAAO,IAAIvO,SAfK,SAACN,EAASC,GAEtBhC,MAXQ,gBAWG0Q,GACN3R,MAAK,SAAAkB,GAAQ,OAAIA,EAASjB,UAC1BD,MAAK,SAAAiS,GACF,IAAMrQ,EAAK8B,IAAQ9F,IAAIqU,EAAc,iBAErC,MAA+B,YAAxBA,EAAaR,OACdzO,EAAQpB,GACRqB,EAAOgP,MAEhB9Q,OAAM,SAAAoB,GAAG,OAAIU,EAAOV,W,yCAiBPuP,EAAYI,GAElC,IAAMC,EAAgBL,EAAWnO,KAAI,SAAA8F,GAAK,MAAK,CAC3C,UAAarD,OAAOqD,EAAM2I,WAC1B,OAAU3I,EAAM4I,OAChB,KAAQ5I,EAAMtH,KACd+P,gBAIEP,EAAO,CACT,OAAU,OACV,QAAW,CACP,eAAgB,oBAEpB,KAAQ5P,KAAKC,UAAU,CACnB,OAAUmQ,KAwBlB,OAAO,IAAI7O,SApBK,SAACN,EAASC,GAEG,kBAAdiP,GAAwBjP,EAAO,CAClC,OAAU,UACV,OAAU,qBACV,MAAS,CACL6O,aACAI,eAIZjR,MAtBQ,cAsBG0Q,GACN3R,MAAK,SAAAkB,GAAQ,OAAIA,EAASjB,UAC1BD,MAAK,SAAAiS,GAAY,MAA4B,YAAxBA,EAAaR,OAC7BzO,IACAC,EAAOgP,MACZ9Q,OAAM,SAAAoB,GAAG,OAAIU,EAAOV,W,yCAeO,IAAhBO,EAAe,uDAAN,KAEvBwP,EAAU,IAAIC,QACpBD,EAAQE,OAAO,eAAgB,oBAC/BF,EAAQE,OAAO,iBAAkBpM,OAAOqM,UAExC,IAAMpQ,EAAG,0BAAsBS,EAAM,WAAOA,GAAW,IACjD6O,EAAO,CACT,OAAU,MACV,KAAQ,OACR,QAAWW,GAGTvP,EAAU,SAACC,EAASC,GAEtBhC,MAAMoB,EAAKsP,GACN3R,MAAK,SAAAkB,GAAQ,OAAIA,EAASjB,UAC1BD,MAAK,SAAAiS,GAAY,MAA4B,YAAxBA,EAAaR,OAC7BzO,EAAQiP,GACRhP,EAAOgP,MACZ9Q,OAAM,SAAAoB,GAAG,OAAIU,EAAOV,OAI7B,OAAO,IAAIe,QAAQP,K,kCAWJmP,GAEf,IAAM7P,EAAG,uBAAmB6P,GAc5B,OAAO,IAAI5O,SAZK,SAACN,EAASC,GAGtBhC,MAAMoB,GACDrC,MAAK,SAAAkB,GAAQ,OAAIA,EAASjB,UAC1BD,MAAK,SAAAiS,GAAY,MAA4B,YAAxBA,EAAaR,OAC7BzO,EAAQiP,GACRhP,EAAOgP,MACZ9Q,OAAM,SAAAoB,GAAG,OAAIU,EAAOV,W,qCAaXmQ,GAElB,IACMf,EAAO,CACT,OAAU,OACV,QAAW,CACP,eAAgB,oBAEpB,KAAQ5P,KAAKC,UAAU0Q,IAG3B,OAAOzR,MATK,uBASM0Q,GACb3R,MAAK,SAAAkB,GAAQ,OAAIA,EAASjB,c,eCpQjC0S,I,OAAc,SAAAnO,GAAU,IAGtBqN,EAKArN,EALAqN,cACAhH,EAIArG,EAJAqG,WACA+H,EAGApO,EAHAoO,KACAtQ,EAEAkC,EAFAlC,OACAuQ,EACArO,EADAqO,gBAIJ,IAAKvQ,KAAYuI,IAAegH,GAAgB,MAAM,IAAIrQ,MAAJ,kBAAsBqJ,EAA6B,iBAAhB,cAAnC,MAEtD,IAAMiI,EAAQF,EAAO,EAAI,UAAY,WAGrC,OAAItQ,EAAe,wBAAI0C,UAAW8N,GAC9B,wBAAI9N,UAAU,eAAd,QACA,wBAAIA,UAAU,eAAe+N,QAAS,GAAtC,SACA,wBAAI/N,UAAU,sBAAsB+N,QAAS,GAA7C,UACA,wBAAI/N,UAAU,mBAAmB+N,QAAS,GAA1C,SAGG,wBAAI/N,UAAW8N,GAClB,wBAAI9N,UAAU,gBAAgB4N,GAC9B,wBAAI5N,UAAU,iBAAiB6M,EAAcnH,OAC7C,wBAAI1F,UAAU,2BAA0B,yBAAKiB,IAAK4L,EAAcmB,eAAgB7M,IAAG,UAAK0L,EAAcN,YAAnB,yBACnF,wBAAIvM,UAAU,wBAAwB6M,EAAcN,aACpD,wBAAIvM,UAAU,uBAAsB,yBAAKiB,IAAK4E,EAAW9G,IAAKoC,IAAG,gCAA2B0E,EAAWtK,SACvG,wBAAIyE,UAAU,qBAAqB6F,EAAWtK,MAC9C,wBAAIyE,UAAU,yBAAwB,4BAAQH,QAASgO,GAAjB,mBAK9CF,GAAYpM,aAAe,CAevB,QAAU,GAqBCoM,UCiDAM,I,mBAlHX,WAAYzO,GAAQ,IAAD,8BACf,4CAAMA,KAED1H,MAAQ,CACT,SAAY,IAIhB,EAAKoW,mBAAqB,EAAKA,mBAAmBtS,KAAxB,gBARX,E,iFAWE,IAAD,OAEhByQ,GAAW8B,mBACNnT,MAAK,qBAAEoT,SAAuBxL,SAAQ,SAACyL,EAASnR,GAC7C,EAAKgR,mBAAmBG,EAASnR,W,yCAQ1BmR,EAASnR,GAAQ,IAAD,OAG3B8G,EACA7I,KAAKqE,MADLwE,eAIAkJ,EAKAmB,EALAnB,UACApP,EAIAuQ,EAJAvQ,OACA4H,EAGA2I,EAHA3I,MACApJ,EAEA+R,EAFA/R,OACAgS,EACAD,EADAC,YAIEC,EAAkBvK,EAAewK,YAAY1Q,GAG7C2Q,EAAkBzK,EAAe0K,YAAYpS,GAGnDgC,QAAQqQ,IAAI,CAACJ,EAAiBE,IACzBzT,MAAK,YAA+B,IAAD,oBAA5B4T,EAA4B,KAAhB/I,EAAgB,KAC1BgJ,EAAS,CACX,KAAQ3R,EAAQ,EAChB,cAAiB,CACbgQ,YACA,YAAe0B,EAAWrC,YAC1B,eAAkBqC,EAAWpC,SAC7B9G,QACA4I,eAEJzI,cAGJ,EAAKtF,UAAS,SAAAqI,GAAQ,MAAK,CACvB,SAAW,GAAX,mBACOA,EAASwF,UADhB,CAEIS,a,0CAUAhJ,EAAYqH,GAAY,IAAD,OAEvCb,GAAWyC,YAAY5B,GAClBlS,MAAK,YAAe,IAAb+T,EAAY,EAAZA,OAEJ,EAAKvP,MAAMqO,gBAAgBhI,EAAYkJ,Q,+BAMzC,IAAD,OACL,OAAO,6BACH,yBAAK/O,UAAU,wBACX,+BACI,+BACA,kBAAC,GAAD,CAAa1C,QAAQ,IAEjBnC,KAAKrD,MAAMsW,SACNvU,QAAO,SAAAwU,GAAO,OAAIA,EAAQT,QAC1BjP,KAAI,SAAA0P,GAAO,OAAI,kBAAC,GAAD,CACI9J,IAAK8J,EAAQT,KACbA,KAAMS,EAAQT,KACdf,cAAewB,EAAQxB,cACvBhH,WAAYwI,EAAQxI,WACpBgI,gBAAiB,kBAAM,EAAKmB,oBAAoBX,EAAQxI,WAAYwI,EAAQxB,cAAcK,oBAM9H,kBAAC,EAAD,CAAW/P,KAAM+B,EAAmB8B,OAAQpB,KAAM,IAAKC,QAAS1E,KAAKqE,MAAMmF,gB,GAxGrDrD,cCqB5B2N,G,YAEF,WAAYzP,GAAQ,IAAD,8BACf,4CAAMA,KAGD1H,MAAQ,CACT,aAAgB,KAChB,SAAW,EACX,iBAAoB,EACpB,MAAS,EACT,WAAc,EACd,uBAAyB,EACzB,qBAAuB,EACvB,uBAAyB,EACzB,qBAAuB,EACvB,uBAAyB,EACzB,yBAA2B,EAC3B,cAAgB,EAChB,YAAc,EACd,UAAa,IAGjB,EAAKoX,6BAA+B,KAGpC1P,EAAM2P,oBAAoBC,iBAAiBC,iBAAeC,MAAM,WAExD,EAAKxX,MAAMyX,eAGP,EAAKzX,MAAM2N,WACX,EAAKjG,MAAMgQ,wBAEX,EAAKhQ,MAAMiQ,cAIf,EAAKjQ,MAAMwE,eAAevH,KAAK,EAAK3E,MAAMyX,aAAa3S,IAEvD,EAAK2D,SAAS,CACV,SAAW,EACX,uBAAyB,EACzB,qBAAuB,QAKnCf,EAAM2P,oBAAoBC,iBAClBC,iBAAeK,eACnB,gBAAE3X,EAAF,EAAEA,KAAF,OAAY,EAAKwI,SAAS,CACtB,MAASxI,EAAK2N,MACd,WAAc3N,EAAK4N,gBAK3BnG,EAAMwE,eAAetJ,cAChBb,QAAO,SAAA8V,GAAQ,MAAuB,yBAAnBA,EAAS7X,SAC5BiC,WAAU,SAAA4V,GAAQ,OAAI,EAAKC,mBAAmBD,EAAS5X,SAG5D,EAAK8X,6BAA+B,KAGpC,EAAKC,oBAAsB,EAAKA,oBAAoBlU,KAAzB,gBAC3B,EAAKmU,oBAAsB,EAAKA,oBAAoBnU,KAAzB,gBAC3B,EAAKoU,QAAU,EAAKA,QAAQpU,KAAb,gBACf,EAAKqU,SAAW,EAAKA,SAASrU,KAAd,gBAChB,EAAKsU,oBAAsB,EAAKA,oBAAoBtU,KAAzB,gBAC3B,EAAKuU,cAAgB,EAAKA,cAAcvU,KAAnB,gBApEN,E,gFA4ECwU,GAEZ,IAAMC,EAAU3R,IAAQ9F,IAAIwX,EAAU,iCAChCE,EAAY5R,IAAQ9F,IAAIuC,KAAKrD,MAAO,mBACpCyY,EAAS7R,IAAQ9F,IAAIwX,EAAU,UAC/BxJ,EAAWlI,IAAQ9F,IAAIwX,EAAU,YAQnCC,IAAYC,EAGPnV,KAAKrD,MAAM0Y,wBAEZrV,KAAKqE,MAAM2P,oBAAoBsB,QAC3BpB,iBAAeqB,KACf,CAAC,OAAU,qCAGfvV,KAAK8U,WAGD9U,KAAKrD,MAAM2N,WAAYtK,KAAKqE,MAAMmR,2BACjCxV,KAAKqE,MAAMoR,oBAEhBzV,KAAKoF,SAAS,CACV,SAAW,EACX,qBAAuB,EACvB,YAAc,IAGlB4F,EAAchL,KAAK+T,8BAGnB/T,KAAKqE,MAAMwE,eAAe6M,aAG1B1V,KAAK2V,iCAWJP,GAEDpV,KAAKrD,MAAM2N,YAEXtK,KAAKqE,MAAMmR,2BAGXxV,KAAKqE,MAAMwE,eAAe6M,aAE1B1V,KAAKoF,SAAS,CACV,SAAW,EACX,qBAAuB,EACvB,uBAAyB,IAG7BpF,KAAK8U,UAAS,IAEM,IAAbrJ,GAEPzL,KAAKqE,MAAM2P,oBAAoBsB,QAC3BpB,iBAAeqB,KACf,CAAC,OAAU,QAGfvV,KAAKoF,SAAS,CACV,SAAW,EACX,qBAAuB,EACvB,uBAAyB,IAI7BpF,KAAKqE,MAAMwE,eAAe6M,aAG1B1V,KAAKqE,MAAMuR,aAAa5V,KAAKrD,MAAM4N,MAAOvK,KAAKrD,MAAMyX,aAAa3S,MAKlEzB,KAAKqE,MAAM2P,oBAAoBsB,QAC3BpB,iBAAe2B,MACf,CAAC,OAAU,WAGf7V,KAAKoF,SAAS,CACV,SAAW,EACX,iBAAoBqG,IAIxBzL,KAAKqE,MAAMyR,eAMf9V,KAAK2V,kCAWA3V,KAAKrD,MAAMoZ,SACZ/V,KAAKqE,MAAM2P,oBACNsB,QAAQpB,iBAAeC,KAAM,CAAC,OAAU,aAIjDnU,KAAKgW,2BAELhW,KAAKoF,SAAS,CACV,SAAW,EACX,iBAAoBqG,O,0CAUf,IAAD,OAGVqC,EAAuB,IAAIC,UAiBjC/N,KAAK+T,6BAA+BjG,EAGpC9N,KAAKoF,SAAS,CACV,UAAa,CACT,kBAAC,EAAD,CACIiG,4BAA6ByC,EAC7B1E,IAAK,GAEL,kBAAC,EAAD,CACIM,aAAa,EACbC,oBA1BgB,WAE5BqB,EAAe8C,GAGf,EAAK6G,oBAAoB7G,IAsBbhE,0BApBkB,WAE9BkB,EAAe8C,GAGf,EAAKmI,sBAAsBnI,UAsB1BrO,aAAaG,QAAQ,YAAYmH,YAAW,WAE7C,EAAK3B,SAAS,CACV,uBAAyB,IAI7B3F,aAAaC,QAAQ,UAAW,UAEjC,Q,4CAWgB,IAAD,OACZwW,EAAqBlW,KAAKqE,MAAMwE,eAAesN,YAEjDD,GACAA,EAAmBrW,MAAK,SAAAsW,GACpB,GAAKA,EAAL,CADmC,IAU/B1K,EAEA0K,EAFA1K,SACA2J,EACAe,EADAf,OAGJ,EAAKhQ,SAAS,CACV,iBAAoBqG,EACpB,SAAY2J,SAbZnY,QAAQgE,MAAM,+D,iDAwB1BjB,KAAK2V,gCAEL3V,KAAK0U,6BAA+B0B,YAAYpW,KAAK+U,oBAAqB,O,sDAO1EsB,cAAcrW,KAAK0U,gC,4CAKD4B,GAAiC,IAAD,OAS5CxI,EAAuB,IAAIC,UA8C3BwI,EACF,kBAAC,EAAD,CACIlL,4BAA6ByC,EAC7B1E,IAAK,GAEL,kBAAC,GAAD,CACIP,eAAgB7I,KAAKqE,MAAMwE,eAC3BW,SAnDS,WAEjB,EAAKqL,UACL7J,EAAcsL,IAiDN5D,gBA9CgB,SAAChI,EAAY8L,GAErC,EAAKR,2BAGL,EAAK3R,MAAMoS,qBAAqBD,GAEhC,EAAKpR,SAAS,CACV,aAAgBsF,EAChB,uBAAyB,EACzB,qBAAuB,EACvB,YAAc,IAMlB,EAAKrG,MAAMwE,eACN6N,4BACGhM,EAAWjJ,IACX,SAAAkV,GAEI1Z,QAAQP,IAAI,0BAA2Bia,GAGvC,EAAKtS,MAAM2P,oBAAoBsB,QAAQpB,iBAAe0C,SAAUD,MAM5E,EAAKtS,MAAMwE,eAAegO,WAG1B,EAAK/B,eAiBT9U,KAAKoF,UAAS,SAAAqI,GAAQ,MAAK,CACvB,UAAY,GAAZ,mBACOA,EAASqJ,WADhB,CAEIP,U,0CAOQD,GAAiC,IAAD,OAG1CxI,EAAuB,IAAIC,UAc3BwI,EACF,kBAAC,EAAD,CACIlL,4BAA6ByC,EAC7B1E,IAAK,GAEL,kBAAC,EAAD,CACIP,eAAgB7I,KAAKqE,MAAMwE,eAC3BQ,WAnBa,SAAAqB,GACrBM,EAAe8C,GACf,EAAK8G,oBAAoBlK,EAAYoD,IAkB7BtE,SAfS,WAEjB,EAAKqL,UACL7J,EAAcsL,OAiBlBtW,KAAKoF,UAAS,SAAAqI,GAAQ,MAAK,CACvB,UAAY,GAAZ,mBACOA,EAASqJ,WADhB,CAEIP,U,0CAOQ7L,EAAY4L,GAAiC,IAAD,OAG5DtW,KAAKoF,SAAS,CACV,aAAgBsF,IAIpB,IAAMoD,EAAuB,IAAIC,UAuC3BwI,EACF,kBAAC,EAAD,CACIlL,4BAA6ByC,EAC7B1E,IAAK,GAEL,kBAAC,EAAD,CACIsB,WAAYA,EACZ8B,eA5Ce,WACvB,EAAKwJ,2BAEL,EAAK5Q,SAAS,CACV,uBAAyB,EACzB,qBAAuB,EACvB,YAAc,IAGlB4F,EAAe8C,GAEf,EAAKzJ,MAAMwE,eACN6N,4BACGhM,EAAWjJ,IACP,SAAAkV,GAEI1Z,QAAQP,IAAI,0BAA2Bia,GAGvC,EAAKtS,MAAM2P,oBAAoBsB,QAAQpB,iBAAe0C,SAAUD,MAMhF,EAAKtS,MAAMwE,eAAegO,WAE1B,EAAK/B,YAkBGtL,SAfS,WAEjB,EAAKqL,UACL7J,EAAcsL,OAiBlBtW,KAAKoF,UAAS,SAAAqI,GAAQ,MAAK,CACvB,UAAY,GAAZ,mBACOA,EAASqJ,WADhB,CAEIP,U,gCAQRvW,KAAKoF,UAAS,SAAAqI,GAEV,IAAMsJ,EAAWtJ,EAASqJ,UAG1B,OAFAC,EAASC,MAEF,CAAC,UAAY,YAAKD,S,iCAMT,IAAfE,EAAc,wDAGfA,GAAM3Z,SAAS4Z,SAGFD,GAAOjM,EAAchL,KAAK+T,8BAE3C/T,KAAKoF,UAAS,SAAAqI,GAAQ,MAAK,CAAC,UAAa,CAACA,EAASqJ,UAAU,U,sCAIhD,IAAD,SAOR9W,KAAKrD,MALL0Y,EAFQ,EAERA,sBACA8B,EAHQ,EAGRA,oBACAC,EAJQ,EAIRA,aACAC,EALQ,EAKRA,sBACA/M,EANQ,EAMRA,WAGGzB,EAAkB7I,KAAKqE,MAAvBwE,eAUDyO,EAAe,WACjBzO,EAAelI,UASnB,OAAIyW,EAAqB,MACf9M,GAAc+K,EAA8B,kBAAC,GAAD,CAClDnJ,OAAQlM,KAAKrD,MAAMma,UAAUvQ,OAC7B6I,SAAU,SAAAmI,GACNrG,GAAWsG,eAAX,eAA8BD,EAA9B,CACI,OAAUhU,IAAQ9F,IAAI,EAAKd,MAAO,sBACjCkD,MAAK,WACF,EAAKiV,UAAS,GACd,EAAK1P,SAAS,CACV,uBAAyB,OAGhCpE,OAAM,SAAAoB,GAAG,OAAInF,QAAQgE,MAAMmB,OAEpCoN,SAAU,WACN,EAAKsF,UAAS,GACd,EAAK1P,SAAS,CACV,uBAAyB,QAK3BkF,GAAc6M,EAA4B,kBAAC,GAAD,CAChDpH,UAAW/P,KAAKrD,MAAMoZ,QACtB/F,QAzCgB,WAChBnH,EAAelI,SACVd,MAAK,kBAAMgJ,EAAelI,aAwC/BsP,SAAUqH,IAELhN,GAAc6M,EAA4B,kBAAC,EAAD,CAC/CzS,QAAS4S,EACTzS,UAAW,iBACXJ,KAAK,SACLE,MAAO,CACH,OAAU,GACV,IAAO,MACP,MAAS,SAGR0S,EAA8B,kBAAC,GAAD,CACnChH,WAAW,YACXC,cAAe,kBAAM,EAAKlL,SAAS,CAAC,uBAAyB,KAC7DmL,MAAM,4BACNC,SAAS,wDAET,0EAA+C,4CAA/C,kGAAuK,+CAAvK,6HACA,6EACA,qIAIG,O,6CAIa,IAAD,SAKfxQ,KAAKrD,MAFL8a,EAHe,EAGfA,sBACAC,EAJe,EAIfA,oBAGEC,EAAa,IAAI5J,UAEvB,OAAI0J,GAAyBC,EAElB,kBAAC,GAAD,CACH5J,qBAAsB6J,EACtB1G,UAAW,kBAAM,EAAK7L,SAAS,CAC3B,qBAAuB,OAM5B,O,+BAKD,IAAD,OAqCCwS,EAAU,kBAAC,EAAD,CACZlN,WAAY1K,KAAKrD,MAAMyX,aACvBzJ,uBAAwB3K,KAAKrD,MAAMkb,iBACnCjN,cAAe5K,KAAKrD,MAAMoZ,QAC1BxL,MAAOvK,KAAKrD,MAAM4N,MAClBC,WAAYxK,KAAKrD,MAAM6N,WACvBF,WAAYtK,KAAKrD,MAAM2N,aAG3B,OACI,6BACKsN,EACA5X,KAAKrD,MAAMmb,eACX9X,KAAK+X,uBACL/X,KAAKgV,gBAhDQ,WAClB,IAAK,EAAK3Q,MAAMqF,YAAa,CAGzB,IAAMoE,EAAuB,IAAIC,UAQjC,OACI,6BACI,kBAAC,EAAD,CACI1C,4BAA6ByC,EAE7BlC,QAPI,kBAAMZ,EAAc8C,KASxB,kBAAC,EAAD,CACIlE,eAAgB,EAAKvF,MAAMwE,eAAemP,MAC1CtO,aAAa,MAQrC,OAAO,EAAK/M,MAAMma,UAoBTmB,Q,GAprBe9R,aAgtBhC2N,GAAkB1N,aAAe,CAC7B,aAAe,EACf,KAAQ,CACJ,YAAe,KACf,SAAY,KACZ,UAAa,OAIN0N,U,qBC7iBAoE,I,mBA7Ld,WAAY7T,GAAQ,IAAD,sBAElB,4CAAMA,IAEN,IAAMwE,EAAiB,IAAIhL,EAAJ,UARR,gBAQQ,gBAJL,OAOlBgL,EAAetJ,cAAcX,WAAU,SAAAjC,GAAK,OAAIM,QAAQP,IAAIC,MAC5DkM,EAAetJ,cACbb,QAAO,SAAA3B,GAAY,MAA2B,cAAvBA,EAAaJ,SACpCiC,WAAU,WACViK,EAAewK,cACbxT,MAAK,SAAAsY,GAELjH,GAAWkH,YAAYD,EAAQhH,UAAWgH,EAAQ/G,YAAa+G,EAAQ9G,UAGvE,EAAKjM,SAAS,CACb,aAAe,EACf,KAAQ+S,UAMb,EAAKtP,eAAiBA,EAGtB,EAAKwP,WAAa,IAAInH,GAGtB,EAAKoH,gBAAkB/T,IAAMC,YAG7B,EAAK+T,KAAO,KACZ,EAAKvE,oBAAsB,IAAIwE,sBAC/B,EAAKC,aAAe,KAEpB,EAAK9b,MAAQ,CACZ+M,aAlCmB,EAmCnB,YAAe4I,SAGhB,EAAKoG,iBAAmB,EAAKA,iBAAiBjY,KAAtB,gBACxB,EAAKkY,oBAAsB,EAAKA,oBAAoBlY,KAAzB,gBAC3B,EAAKmY,gBAAkB,EAAKA,gBAAgBnY,KAArB,gBACvB,EAAKoY,iBAAmB,EAAKA,iBAAiBpY,KAAtB,gBACxB,EAAKqY,gBAAkB,EAAKA,gBAAgBrY,KAArB,gBACvB,EAAKsY,yBAA2B,EAAKA,yBAAyBtY,KAA9B,gBAChC,EAAKuY,6BAA+B,EAAKA,6BAA6BvY,KAAlC,gBACpC,EAAKwY,0BAA4B,EAAKA,0BAA0BxY,KAA/B,gBAlDf,E,iFAwDlBT,KAAKyY,aAAe,IAAIS,eAGxBlZ,KAAKuY,KAAO,IAAIY,KAAKnZ,KAAKgU,oBAAqBhU,KAAKsY,gBAAgB5S,QAAS1F,KAAKyY,gB,wCAUlFzY,KAAKyY,aAAaW,iB,wCAUlBpZ,KAAKyY,aAAaY,iB,yCAUlBrZ,KAAKyY,aAAaa,kB,uCAOF/O,EAAOpJ,GAGvB,IAAMqV,EAAexW,KAAKyY,aAAac,mBAGvC,GAAI/C,EAAc,CAEjB,IAAMtD,EAAU,CACf/R,SACAoJ,QACA,OAAUvK,KAAKrD,MAAM6c,KAAKrI,UAC1B,YAAenR,KAAKrD,MAAMwW,aAG3BlW,QAAQP,IAAIwW,EAASsD,GAErBtF,GAAWuI,gBAAgBvG,EAASsD,GAClC3W,KAAK5C,QAAQP,Q,4CAYhBO,QAAQP,IAAI,oBAAqBsD,KAAKyY,aAAac,sB,+CAO3B/C,GAExBxW,KAAKyY,aAAaiB,oBAAoBlD,K,qDAStCxW,KAAKyY,aAAakB,2B,kDASlB3Z,KAAKyY,aAAamB,uB,+BAMlB,OACC,6BACC,4BACCpU,IAAKxF,KAAKsY,gBACVzT,UAAW,gBACXgV,MAAOxc,OAAOyc,WACdC,OAAQ1c,OAAO2c,cAEhB,kBAAC,GAAD,CACCnR,eAAgB7I,KAAK6I,eACrBa,YAAa1J,KAAKrD,MAAM+M,YACxBsK,oBAAqBhU,KAAKgU,oBAC1BwF,KAAMxZ,KAAKrD,MAAM6c,KACjB5D,aAAc5V,KAAK0Y,iBACnBjD,kBAAmBzV,KAAK2Y,oBACxB7C,YAAa9V,KAAK4Y,gBAClBtE,YAAatU,KAAK8Y,gBAClBmB,aAAcja,KAAK6Y,iBAClBpC,qBAAsBzW,KAAK+Y,yBAC3BvD,yBAA0BxV,KAAKgZ,6BAC/B3E,sBAAuBrU,KAAKiZ,4BAE9B,uBAAGxX,GAAG,WAAN,OAAqBzB,KAAKrD,MAAMwW,kB,GAvLlBhN,c,4BCLlB+T,KAASC,OAAO,kBAAC,GAAD,MAASC,SAASC,eAAe,W","file":"static/js/main.1ba0fdeb.chunk.js","sourcesContent":["module.exports = \"data:image/png;base64,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\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAQAAABpN6lAAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QAAKqNIzIAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAAHdElNRQfkAgYVAzrpZhRiAAACH0lEQVR42u2dOU7DYBgFX5yC0LMVHIfAKUBwC8RFAFGwiDIsB4jSQEBCwBWIWJQAUY5gU1gI0WHH/obijWvrzT9ylPKXctZ0oZFSZRU+E/W0qaamoakt9TSp1CvVSOda/Rlp6bTSgd9PX4ulj7+k2xrNTjSTz9R5/EyZ7tUqdfxZPdZsdpx//PWOZMq0XSrAToBZW7oMmBmoUfj4DT0HmJ019K6F0r/Rv7Ost8JvvAR4jRLNBcyoROT5GK9ESchQ8ZUgr5iZf4wD0AI0DkAL0DgALUDjALQAjQPQAjQOQAvQOAAtQOMAtACNA9ACNA5AC9A4AC1A4wC0AI0D0AI0DkAL0DgALUDjALQAjQPQAjQOQAvQOAAtQOMAtACNA9ACNA5AC9A4AC1A4wC0AI0D0AI0DkAL0DgALUDjALQAjQPQAjQOQAvQOAAtQOMAtACNA9ACNA5AC9A4AC1A4wC0AI0D0AI0DkAL0DgALUDjALQAjQPQAjQOQAvQOAAtQOMAtACNA9ACNA5AC9A4AC1A4wC0AI0D0AI0DkAL0DgALUDjALQAjQPQAjQOQAvQOAAtQOMAtABNojRkp/hKkFeiz5Chj8JvBHklugmYGRS+c1Z61VOA2XWivYCZ3VJvHQSY7UvSSc2XG9+Vvnr7oWazw3xoptYEV1Nc7Lyofo1mR9+Xr0tSWx0NlVY6MFZX61P+0Ta1oa7GlXqlGqqjlXzgC6j1AcnsGbLmAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIwLTAyLTA2VDIxOjAzOjU4KzAwOjAwh3nvzwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMC0wMi0wNlQyMTowMzo1OCswMDowMPYkV3MAAAAZdEVYdFNvZnR3YXJlAHd3dy5pbmtzY2FwZS5vcmeb7jwaAAAAAElFTkSuQmCC\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAQAAABpN6lAAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QAAKqNIzIAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAAHdElNRQfkAgYVAyFjA92OAAAERElEQVR42uWdT4hWVRjGfzVZmA4zpQsZ3UQGgqCFLSKiVFQU+kctLOkPLpJ0kYsINxFBGLUIdDkuJ3QxLhRBrURF0bTZiKHTJv+MWKNCTo7lODZ+b4u7iDK95/u+e8/z3nuesz13eJ/fvBfu893LeyBUnaxjPxcZ51cG+IqlTAq+tgZaxgXsP+sCH9GtLiyOlnLzDvvZusp6OtTlla0ert3FfraOM1ddYrnqu6d9wxjjQ+5Xl1mWpjGeC8AwvucJdanlaF2QfcMY5T3uU5dbvLYGAzCMb5ipLrhoDTYFwPiNN9QlF6vrTQIwjH6mq8suSh00WgBgXOJldenFqKsl+9naQqe6/PbV3QYA4zyL1Aa0AIwGvTysNqEEYBiDPK22oQVg/MUXPKi2ogRgGCeZrzajBWCMsaF60blIAIZxlNlqS1oAxihrqhSZigdgVCoylQPAGOFttTUtAMPoZ5ranhaAcYmX1Aa1AAyjz3dkKh+AcY6FaptaAK4jUxwAhnGaBWqzWgBZZHL3vjEmAMMYYI7ashZAFpkcvWWKD8AwjviJTBoAxjXWqK1rARjGXnrU9rUAjBHeShuAIY9MegDGsDIyeQBgGH1MTRuAcY4X0gZgNNjMQykDMIxTsSOTNwDRI5M/AIbxQ7zI5BNAxMjkFYBhHOHxtAFEiUy+ARjGnnIjk38AxhVeSxuAYfTzaNoAjGFebMWgo1/f2tQMdtFbfGSqTgdk6yzPN2ewPh2Q6TEO8EmRrqrWAdnaG34r1K0DMi1nH10pA4Bn2Bn2ZWJdAcBCPgvZlve9Vjcjaict6zbPMpC3qb4dAB1szN9UZwCwhHlpA4A3UweQ+1xYdwDJ3wJT894k1B0AWNoARrmVNoCTeRvqDuBw6gC2pQ1gD4MpA5jg4/xNdQbwOSfa/yPV/EnMMHbzQIjBunbAIVYykS6AHazgj7Ct9QMwwQZeZyx0e9B9UiGd4V2ONnNBnTrA2ML85uzXqQOGWM3B5i+rSwds56lW7OerCs8Bl3mlPLL+AWwvd2aRbwC/p/2R1LfMKtu+XwB/sj7OGAafACLOLvQHIPIoFm8AfuTJeOa9AZCMY/ID4Geei23eD4AGvUxR2PcB4DyLNeZ9AOjnEZ19NYBSY45/ACXHHN8AIsQczwCixByvAG7Eijk+Abgb0R4TwE2PEyfjAYgeczwBcDx1NgYAUczxAUAYczwAkMYcPQBxzNECuMyramtKAC5ijgqAm5ijAfCdn5gTH4CzmBMbgLuYExPALT71F3PiAXAac+IAcBxzYgA44znmhKmrZfMNNjFZXX77avWorSH/MSdUrR22VoGYE6qfmjQvHYBZhpo7cLFCMSdU4UduXmWVutgyFHroauViTri+zjV/nferF3PC1cPoPe0fjDHXT6u7H709zDt1/t//oyUM/c+D7geqcccKdbKWfVxknF84xpcsqmrA/bf+BrbynChoRDjLAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIwLTAyLTA2VDIxOjAzOjMzKzAwOjAwQxGysgAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMC0wMi0wNlQyMTowMzozMyswMDowMDJMCg4AAAAZdEVYdFNvZnR3YXJlAHd3dy5pbmtzY2FwZS5vcmeb7jwaAAAAAElFTkSuQmCC\"","// key for accessing local storage data\r\nconst LOCAL_STORAGE_KEY = \"spotify-refresh-token\";\r\n\r\n/**\r\n * Either console logs or broadcasts a state message.\r\n *\r\n * @param {String} state current spotify service state\r\n * @param {*} body the body of the notification. Could be anything depending on the state.\r\n * @param {String} message optional message to be notified\r\n * @param {Rx.Subject} notifier the observable to emit the message from\r\n *\r\n * @returns {void}\r\n */\r\nconst log = (state, body, message = \"\", notifier = null) => {\r\n\r\n    const notification = {\r\n        \"source\": \"SpotifyService\",\r\n        state,\r\n        body,\r\n        message\r\n    };\r\n\r\n    // broadcast state\r\n    if (notifier) notifier.next(notification);\r\n    else console.log(notification);\r\n\r\n};\r\n\r\n/**\r\n * Fetches tokens from URL query and returns them in an object.\r\n * @returns {{accessToken: *, refreshToken: *}} object containing both tokens\r\n */\r\nconst getTokensFromQuery = () => {\r\n    const urlParams = new URLSearchParams(window.location.search);\r\n    const accessToken = urlParams.get(\"accessToken\");\r\n    const refreshToken = urlParams.get(\"refreshToken\");\r\n\r\n    // clear for safety\r\n    window.history.replaceState(null, \"\", \"/\");\r\n\r\n    return {\r\n        accessToken,\r\n        refreshToken\r\n    };\r\n};\r\n\r\n/**\r\n * Returns refresh and access tokens if a valid refresh token is found either in the query or local storage.\r\n * If no valid refresh token exists, returned tokens will be \"null\".\r\n * @param {Function} refreshTokenFunction function that fetches refresh tokens from server.\r\n * @param {Rx.Subject} stateNotifier an optional Subject that will be used to broadcast state of the utility\r\n * @returns {{accessToken: *, refreshToken: *}} object containing both tokens\r\n */\r\nconst processTokens = (refreshTokenFunction, stateNotifier = null) => {\r\n\r\n    // Handle state of SDK and user token\r\n    const queryTokens = getTokensFromQuery();\r\n\r\n    let accessToken = null;\r\n    let refreshToken = null;\r\n\r\n    // check if refresh token exists in local storage, or else check query\r\n    if (queryTokens.accessToken && queryTokens.refreshToken) {\r\n\r\n        // set state tokens\r\n        accessToken = queryTokens.accessToken;\r\n        refreshToken = queryTokens.refreshToken;\r\n\r\n        // update state\r\n        log(\"ACCESS_TOKEN_ACQUIRED\", {\r\n            accessToken,\r\n            refreshToken\r\n        }, \"Using tokens from query returned from server!\", stateNotifier);\r\n\r\n        // save token locally if it was found\r\n        localStorage.setItem(LOCAL_STORAGE_KEY, queryTokens.refreshToken);\r\n\r\n    } else {\r\n\r\n        // this is the case when query tokens don't exist\r\n        log(\"LOADING_TOKEN_FROM_LOCAL_STORAGE\", null, \"Spotify tokens not found in query. Looking in local storage...\", stateNotifier);\r\n\r\n        const localStorageRefreshToken = localStorage.getItem(LOCAL_STORAGE_KEY);\r\n\r\n        // if found, attempt to refresh\r\n        if (localStorageRefreshToken) {\r\n\r\n            log(\r\n            \"REFRESHING_TOKEN\",\r\n                null,\r\n                \"Spotify refresh token found in localStorage. Fetching new accessToken from server...\",\r\n                stateNotifier\r\n            );\r\n\r\n            refreshTokenFunction(localStorageRefreshToken)\r\n                .then(json => {\r\n\r\n                    log(\r\n                        \"ACCESS_TOKEN_ACQUIRED\",\r\n                        {\r\n                            \"accessToken\": json.accessToken,\r\n                            \"refreshToken\": localStorageRefreshToken\r\n                        },\r\n                        \"Spotify access token fetched.\",\r\n                        stateNotifier\r\n                    );\r\n\r\n                });\r\n\r\n        } else {\r\n\r\n            log(\r\n                \"NO_ACCESS_TOKEN\",\r\n                null,\r\n                \"No tokens found or refreshed. User must log in.\",\r\n                stateNotifier\r\n            );\r\n\r\n        }\r\n    }\r\n};\r\n\r\nexport {\r\n    getTokensFromQuery,\r\n    processTokens,\r\n    log\r\n};","import fromCDN from \"from-cdn\";\nimport Rx from \"rxjs\";\nimport {processTokens, log} from \"./SpotifyServiceTools\";\nimport dotProp from \"dot-prop\";\n\n// url for react debugging on node server (comment out for building in production)\nconst REDIRECT_URL = \"\";  // \"http://localhost:8080\";\n\n\n/**\n * Service that handles client-side handling of Spotify communications.\n */\nclass SpotifyService {\n\n\t// Must have a reference to SDK so playback functions can be called.\n\tconstructor (spotifyPlayerName) {\n\n\t\t// keep track of all three initializations\n\t\tconst $cdn = new Rx.BehaviorSubject(false);\n\t\tconst $sdk = new Rx.BehaviorSubject(false);\n\t\tconst $token = new Rx.BehaviorSubject(false);\n\n\t\t/*\n\t\t * spotify service observable\n\t\t * subject that notifies of all state changes within this module.\n\t\t */\n\t\tconst $spotifyServiceStateNotifier = new Rx.ReplaySubject();\n\n\t\t// does all necessary initialization\n\t\tconst initPlayer = () => {\n\n\t\t\t// if this is running again after initialization, quit.\n\t\t\tif (this.player) return;\n\n\t\t\tconst {Player} = window.Spotify;\n\n\t\t\t/*\n\t\t\t * todo: may extract this to a separate func\n\t\t\t * Initialize player\n\t\t\t */\n\t\t\tthis.player = new Player({\n\t\t\t\t\"name\": \"tune mountain\",\n\t\t\t\t\"getOAuthToken\": callback => callback(this.accessToken),\n\t\t\t\t\"volume\": 0.5\n\t\t\t});\n\n\t\t\tthis.player.connect();\n\n\t\t\t// noinspection JSDeprecatedSymbols\n\t\t\tthis.player.addListener(\"ready\", ({device_id}) => {\n\t\t\t\tlog(\"PLAYER_READY\", `Spotify player ready to stream songs on ${device_id}`, $spotifyServiceStateNotifier);\n\t\t\t});\n\n\t\t\t// check for player state updates and notify them\n\t\t\tthis.player.addListener(\"player_state_changed\", webPlaybackStateObject => log(\n\t\t\t\t\"PLAYER_STATE_CHANGED\",\n\t\t\t\twebPlaybackStateObject,\n\t\t\t\t\"Spotify player state changed!\",\n\t\t\t\t$spotifyServiceStateNotifier\n\t\t\t));\n\n\t\t\t// TODO: add listener for error and automatically refresh token\n\n\t\t};\n\n\t\t// only init spotify player/service once all three parts are done with their processes\n\t\t$cdn.combineLatest(\n\t\t\t$sdk,\n\t\t\t$token,\n\t\t\t(cdnLoaded, sdkLoaded, tokenLoaded) => cdnLoaded && sdkLoaded && tokenLoaded\n\t\t)\n\t\t\t.filter(isAllLoaded => isAllLoaded)\n\t\t\t.subscribe(() => {\n\t\t\t\tlog(\"LOGGED_IN\", null, \"User has logged in.\", $spotifyServiceStateNotifier);\n\t\t\t\tinitPlayer();\n\t\t\t});\n\n\t\t// process tokens and collect notifications from it\n\t\tprocessTokens(this.getNewAccessToken, $spotifyServiceStateNotifier);\n\n\t\t// save tokens when they're acquired\n        $spotifyServiceStateNotifier\n            .filter(notif => notif.state === \"ACCESS_TOKEN_ACQUIRED\")\n            .subscribe(newState => {\n\n                // get tokens from update\n                const {\n                    accessToken,\n                    refreshToken\n                } = newState.body;\n\n                this.accessToken = accessToken;\n                this.refreshToken = refreshToken;\n\n                if (accessToken && refreshToken) $token.next(true);\n                else $token.next(false);\n\n            });\n\n\t\tthis.name = spotifyPlayerName;\n\t\tthis.player = null;\n\t\tthis.spotifyStateNotifier = $spotifyServiceStateNotifier;\n\n\t\t// Load sdk, update state\n\t\tfromCDN([\"https://sdk.scdn.co/spotify-player.js\"])\n\t\t\t.then(() => {\n\t\t\t\t$cdn.next(true);\n\t\t\t});\n\n\t\twindow.onSpotifyWebPlaybackSDKReady = () => $sdk.next(true);\n\n\t\tthis.spotifyStateNotifier = $spotifyServiceStateNotifier;\n\n\t\t// bind functions?\n\t\tthis.pause = this.pause.bind(this);\n\t\tthis.resume = this.resume.bind(this);\n\t\tthis.toggle = this.toggle.bind(this);\n\t}\n\n\t/**\n\t * Getter for Rx.Subject that notifies state of this module to rest of the app.\n\t * @returns {Subject} Rx Observable that emits state updates.\n\t */\n\tget stateNotifier() {\n\t\treturn this.spotifyStateNotifier;\n\t}\n\n\t/**\n\t * Getter for current state of spotify player.\n\t * @returns {Promise} contains the player state object\n\t */\n\tget playerState() {\n\t\tif (this.player) return this.player.getCurrentState();\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * Connects spotify player to Spotify Connct\n\t */\n\tactivate() {\n\t\tif (this.player) return this.player.connect();\n\n\t\treturn null;\n\t}\n\n\tdeactivate() {\n\t\tif (this.player) this.player.disconnect();\n\t}\n\n\t/**\n\t * Refreshes the user token.\n\t * @param {String} refreshToken refresh token received from Spotify\n\t * @returns {JSON} JSON returned from query.\n\t */\n\tgetNewAccessToken(refreshToken = null) {\n\n\t\tconst tokenToBeUsed = refreshToken ? refreshToken : this.refreshToken;\n\n\t\treturn fetch(`${REDIRECT_URL ? REDIRECT_URL : \"\"}/spotify-service/refresh-token/${tokenToBeUsed}`)\n\t\t\t.then(response => response.json())\n\t\t\t.catch(error => {\n\t\t\t\tconsole.error(error);\n\t\t\t});\n\n\t}\n\n\t/**\n\t * Pauses playback on local spotify player.\n\t * @returns {Promise}\n\t */\n\tpause() {\n\t\tif (this.player) return this.player.pause();\n\n\t\treturn null;\n\n\t}\n\n\t/**\n\t * Pauses playback on local spotify player.\n\t * @returns {Promise}\n\t */\n\ttoggle() {\n\t\tif (this.player) return this.player.togglePlay();\n\n\t\treturn null;\n\n\t}\n\n\t/**\n\t * Resumes playback on local spotify player\n\t * @returns {Promise}\n\t */\n\tresume() {\n\t\tif (this.player) return this.player.resume();\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * Plays a song on the current active player with a given spotify URI.\n\t * @param {String} songID the Spotify track ID of the song. Can be acquired through search params.\n\t * @returns {void}\n\t */\n\tplay(songID) {\n\n\t\tconst uri = `spotify:track:${songID}`;\n\n\t\tif (!this.player) throw new Error(\"Player not initialized.\");\n\n\t\tconst play = ({\n\t\t\tspotifyURI,\n\t\t\t\"playerInstance\": {\n\t\t\t\t\"_options\": {\n\t\t\t\t\tgetOAuthToken,\n\t\t\t\t\tid\n\t\t\t\t}\n\t\t\t}\n\t\t}) => {\n\t\t\tgetOAuthToken(access_token => {\n\t\t\t\tconst details = {\n\t\t\t\t\t\"method\": \"PUT\",\n\t\t\t\t\t\"headers\": {\n\t\t\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t\t\t\"Authorization\": `Bearer ${access_token}`\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tif (spotifyURI) {\n\t\t\t\t\tdetails.body = JSON.stringify({\"uris\": [spotifyURI]});\n\t\t\t\t}\n\n\t\t\t\tfetch(\n\t\t\t\t`https://api.spotify.com/v1/me/player/play?device_id=${id}`,\n\t\t\t\t\tdetails\n\t\t\t\t).then(() => console.log(`Success: Playing uri: ${spotifyURI}`));\n\t\t\t});\n\t\t};\n\n\t\t// run the function\n\t\tplay({\n\t\t\t\"playerInstance\": this.player,\n\t\t\t\"spotifyURI\": uri\n\t\t});\n\n\t}\n\n\t/**\n\t * Redirects application to accounts.spotify.com web page for login.\n\t * @returns {void}\n\t */\n\tlogin() {\n\n\t\tconsole.log(\"Redirecting to Spotify for authorization...\");\n\t\twindow.location = `${REDIRECT_URL ? REDIRECT_URL : \"\"}/spotify-service/login`;\n\n\t}\n\n\t/**\n\t * Searches spotify servers using the passed keywords in any order (without quotations on query).\n\t * Returns tracks on the State updater using the state keyword TRACKS_FETCHED; if a callback function is\n\t * passed, the returned JSON object is passed as the only argument in the callback function.\n\t *\n\t * @param {Function} callback an optional callback function whose argument will be the JSON object containing the songs\n\t * @param {...String} keywords one or more strings to be used in the query parameter.\n\t * @returns {void} return values are emitted on Subject or passed to callback\n\t */\n\tsearch(callback = null, ...keywords) {\n\n\t\t// 1: filter keywords into a query string\n\t\tlet searchQueryString = \"q=\";\n\t\tfor (let index = 0; index < keywords.length; index++) {\n\n\t\t\t// append keyword\n\t\t\tsearchQueryString += keywords[index];\n\n\t\t\t// add &20 between keywords if not last item\n\t\t\tsearchQueryString += index + 1 === keywords.length ? \"\" : \"&20\";\n\n\t\t}\n\n\t\t// other filtering parameters\n\t\tconst type = \"type=track\";\n\t\tconst limit = \"limit=8\";\n\n\t\t// 2: define GET parameters and headers\n\t\tconst url = `https://api.spotify.com/v1/search?${searchQueryString}&${type}&${limit}`;\n\t\tconst header = {\n\t\t\t\"method\": \"GET\",\n\t\t\t\"headers\": {\n\t\t\t\t\"Accept\": \"application/json\",\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t\"Authorization\": `Bearer ${this.accessToken}`\n\t\t\t}\n\t\t};\n\n\t\t// 3: emit result in callback and subject\n\t\tfetch(url, header)\n\t\t\t.then(response => response.json())\n\t\t\t.then(json => {\n\n\t\t\t\t// emit\n\t\t\t\tlog(\n\t\t\t\t\t\"TRACKS_FETCHED\",\n\t\t\t\t\tjson,\n\t\t\t\t\t\"Choose any of these songs...\",\n\t\t\t\t\tthis.spotifyStateNotifier\n\t\t\t\t);\n\n\t\t\t\t// callback\n\t\t\t\t// eslint-disable-next-line callback-return\n\t\t\t\tif (callback) callback(json);\n\n\t\t\t})\n\t\t\t.catch(err => {\n\t\t\t\tthrow new Error(err);\n\t\t\t});\n\n\t}\n\n\t/**\n\t * Returns through callback an object containing \"audioFeatures\" and \"audioAnalysis\" for a given\n\t * track ID.\n\t * @param {String} id a spotify track id\n\t * @param {Function} callback callback function for handling features and analysis\n\t * @returns {void} return values are passed to callback\n\t */\n\tgetAudioAnalysisAndFeatures(id, callback) {\n\n\t\tconst analysisURL = `https://api.spotify.com/v1/audio-analysis/${id}`;\n\t\tconst featuresURL = `https://api.spotify.com/v1/audio-features/${id}`;\n\n\t\tconst header = {\n\t\t\t\"method\": \"GET\",\n\t\t\t\"headers\": {\n\t\t\t\t\"Accept\": \"application/json\",\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t\"Authorization\": `Bearer ${this.accessToken}`\n\t\t\t}\n\t\t};\n\n\t\tlet analysis = null;\n\t\tlet features = null;\n\n\t\tfetch(analysisURL, header)\n\t\t\t.then(response => response.json())\n\t\t\t.then(analysisObject => {\n\t\t\t\tanalysis = analysisObject;\n\n\t\t\t\treturn fetch(featuresURL, header);\n\t\t\t})\n\t\t\t.then(response => response.json())\n\t\t\t.then(featuresObject => {\n\t\t\t\tfeatures = featuresObject;\n\n\t\t\t\tif (callback) {\n\n\t\t\t\t\t// eslint-disable-next-line callback-return\n\t\t\t\t\tcallback({\n\t\t\t\t\t\tfeatures,\n\t\t\t\t\t\tanalysis\n\t\t\t\t\t});\n\n\t\t\t\t}\n\n\t\t\t\t// emit\n\t\t\t\tlog(\n\t\t\t\t\t\"METADATA_FECHED\",\n\t\t\t\t\t{\n\t\t\t\t\t\t\"audioFeatures\": features,\n\t\t\t\t\t\t\"audioAnalysis\": analysis\n\t\t\t\t\t},\n\t\t\t\t\t\"Metadata available.\",\n\t\t\t\t\tthis.spotifyStateNotifier\n\t\t\t\t);\n\n\t\t\t})\n\t\t\t.catch(error => console.error(error));\n\t}\n\n\t/**\n\t *  Fetches user info\n\t *\n\t *  @returns {Promise} promise that evaluates in the response.\n\t */\n\tgetUserInfo(userID = null) {\n\n\t\tconst handler = (resolve, reject) => {\n\n\t\t\tconst url = userID ? `https://api.spotify.com/v1/users/${userID}` : \"https://api.spotify.com/v1/me\";\n\t\t\tconst header = {\n\t\t\t\t\"method\": \"GET\",\n\t\t\t\t\"headers\": {\n\t\t\t\t\t\"Accept\": \"application/json\",\n\t\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t\t\"Authorization\": `Bearer ${this.accessToken}`\n\t\t\t\t}\n\t\t\t};\n\n\t\t\treturn fetch(url, header)\n\t\t\t\t.then(res => res.json())\n\t\t\t\t.then(resJSON => resolve({\n\t\t\t\t\t\"spotifyID\": resJSON.id,\n\t\t\t\t\t\"displayName\": resJSON.display_name,\n\t\t\t\t\t\"imageUrl\": resJSON.images[0] ? resJSON.images[0].url : \"http://icons.iconarchive.com/icons/papirus-team/papirus-status/128/avatar-default-icon.png\"\n\t\t\t\t}))\n\t\t\t\t.catch(err => reject(err));\n\n\t\t};\n\n\t\treturn new Promise(handler);\n\n\t}\n\n\t/**\n\t * Fetches song info\n\t *\n\t * @param {String} songID spotify id for a given song\n\t * @returns {Promise<Object>} promise that evaluates into the song object\n\t */\n\tgetSongInfo(songID) {\n\n\t\tconst handler = (resolve, reject) => {\n\n\t\t\tconst url = `https://api.spotify.com/v1/tracks/${songID}`;\n\t\t\tconst header = {\n\t\t\t\t\"method\": \"GET\",\n\t\t\t\t\"headers\": {\n\t\t\t\t\t\"Accept\": \"application/json\",\n\t\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t\t\"Authorization\": `Bearer ${this.accessToken}`\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconst createTrackObject = (id, name, artist, img, duration) => ({\n\t\t\t\tname,\n\t\t\t\tartist,\n\t\t\t\timg,\n\t\t\t\tid,\n\t\t\t\tduration\n\t\t\t});\n\n\t\t\treturn fetch(url, header)\n\t\t\t\t.then(res => res.json())\n\t\t\t\t.then(item => {\n\n\t\t\t\t\tconst id = item.id;\n\t\t\t\t\tconst songName = item.name;\n\t\t\t\t\tconst artistNames = dotProp.get(item, \"artists\").map(artist => artist.name);\n\t\t\t\t\tconst imgURL = dotProp.get(item, \"album.images\")[0].url;\n\t\t\t\t\tconst duration = dotProp.get(item, \"duration_ms\");\n\n\t\t\t\t\tresolve(createTrackObject(id, songName, artistNames, imgURL, duration));\n\n\t\t\t\t})\n\t\t\t\t.catch(err => reject(err));\n\n\t\t};\n\n\t\treturn new Promise(handler);\n\n\t}\n\n}\n\nexport default SpotifyService;\n","import React, {Component} from \"react\";\nimport PropTypes from \"prop-types\";\nimport returnIcon from \"../../img/return.png\";\nimport \"../../css/hud/HUDButton.css\";\n\n/**\n * Enumeration that defines types of button CSS layouts supported. Buttons instantiated without\n * a type will default to SMALL.\n * This value is emitted along with the original click event.\n * @type {Readonly<{RETURN: string, SMALL: string, LARGE: string, ENTER: string}>}\n */\nexport const HUDButtonTypesEnum = Object.freeze({\n    \"SMALL\": \"SMALL\",\n    \"LARGE\": \"LARGE\",\n    \"RETURN\": \"RETURN\",\n    \"ENTER\": \"ENTER\",\n    \"SPOTIFY\": \"SPOTIFY\"\n});\n\nconst TypeToClassMap = Object.freeze({\n    \"SMALL\": \"hud-button-small\",\n    \"LARGE\": \"hud-button-large\",\n    \"RETURN\": \"hud-button-return\",\n    \"ENTER\": \"hud-button-enter\",\n    \"SPOTIFY\": \"hud-button-small spotify-button\"\n});\n\nconst TypeToStyleMap = Object.freeze({ // todo: pull this out onto css document\n    \"SMALL\": \"hud-button-small-pressed\",\n    \"RETURN\": \"hud-button-return-pressed\",\n    \"ENTER\": \"hud-button-enter-pressed\",\n    \"SPOTIFY\": \"hud-button-small-pressed\"\n});\n\n/**\n * Wrapper for HTML Button element. Sanitizes button text and has preset styles.\n * Emits button type on click.\n *\n * @param {Object} props React properties\n * @returns {React.Component} JSX element\n * @constructor\n */\nclass HUDButton extends Component {\n\n    constructor(props) {\n        super(props);\n\n        this.state = {\n            \"isHovering\": false\n        };\n\n        this.btnRef = React.createRef();\n    }\n\n\n    render() {\n\n        // props\n        const {\n            type,\n            text,\n            onClick,\n            style,\n            children,\n            className,\n            disabled // todo: make it pressed when disabled\n        } = this.props;\n\n        const {\n            isHovering\n        } = this.state;\n\n        // check if passed type exists\n        const isValidType = Boolean(HUDButtonTypesEnum[type]);\n        const filteredType = isValidType ? TypeToClassMap[type] : TypeToClassMap.SMALL;\n        const buttonContent = () => {\n            if (type === HUDButtonTypesEnum.RETURN) return <img src={returnIcon} alt=\"return icon\"/>;\n            else if (text) return String(text).toLowerCase();\n\n            return children;\n        };\n\n        const onHover = () => this.setState({\"isHovering\": !disabled && true});\n        const onHoverEnd = () => this.setState({\"isHovering\": false});\n\n        // return jsx\n        return (\n            <div onMouseEnter={onHover}\n                 onMouseOver={onHover}\n                 onMouseLeave={onHoverEnd}\n                 className={`button-wrapper ${className}`}\n                 style={style}\n            >\n                <button\n                    ref={this.btnRef}\n                    className={`hud-button ${filteredType} ${isHovering ? `${TypeToStyleMap[type]} pressed` : \"\"}`}\n                    disabled={disabled}\n                    onClick={(event => {\n                        this.btnRef.current.blur();\n                        event.buttonType = filteredType;\n                        onClick(event);\n                    })}\n                >\n                    {buttonContent()}\n                </button>\n            </div>\n        );\n\n    }\n\n}\n\n// prop types for development\nHUDButton.propTypes = {\n    \"type\": PropTypes.string,\n    \"text\": PropTypes.string,\n    \"onClick\": PropTypes.func,\n    \"onHover\": PropTypes.func,\n    \"onHoverEnd\": PropTypes.func,\n    \"isHovering\": PropTypes.bool,\n    \"style\": PropTypes.object,\n    \"className\": PropTypes.string,\n    \"disabled\": PropTypes.bool\n};\n\n// default props\nHUDButton.defaultProps = {\n    \"type\": HUDButtonTypesEnum.SMALL,\n    \"text\": \"Button Text Not Set\",\n    \"onClick\": () => console.error(\"Click handler not set for this button.\"),\n    \"onHover\": () => console.error(\"Hover handler not set for this button.\"),\n    \"onHoverEnd\": () => console.error(\"End Hover handler not set for this button.\"),\n    \"className\": \"\",\n    \"isHovering\": false,\n    \"disabled\": false\n};\n\nexport default HUDButton;\n","// constants\r\nconst DEFAULT_MAX_STRING_LENGTH = 26;\r\n\r\n/**\r\n * Converts a paragraph to an array of words, removing any symbols so that\r\n * no wacky HTTP GET requests are done to Spotify.\r\n *\r\n * @param {String} string the input string.\r\n * @returns {Array<String>} an array of the words passed to the function.\r\n */\r\nconst wordsToArray = string => {\r\n\r\n    // trim whitespace before and after\r\n    const paragraph = string.trim();\r\n\r\n    // eslint-disable-next-line require-unicode-regexp\r\n    const regex = /[A-Za-z0-1 ]/g;\r\n\r\n    // filter symbols\r\n    const letters = paragraph.match(regex);\r\n\r\n    const words = [];\r\n    let curWord = \"\";\r\n\r\n    // join letters and remove whitespace\r\n    letters.forEach((letter, index) => {\r\n        if (letter === \" \") {\r\n            if (curWord.length > 0) words.push(curWord);\r\n            curWord = \"\";\r\n        } else {\r\n            curWord += letter;\r\n            if (index + 1 === letters.length) words.push(curWord);\r\n        }\r\n    });\r\n\r\n    return words;\r\n\r\n};\r\n\r\n/**\r\n * Trims end of a string and adds ellipses at end of string\r\n *\r\n * @param {String} string input\r\n * @param {Number} length integer determining max length of string\r\n * @returns {String} modified string with ellipses or normal string if length is less than the one provided.\r\n */\r\nconst trimEnd = (string, length = DEFAULT_MAX_STRING_LENGTH) => {\r\n\r\n    if (string.length <= length) return string;\r\n\r\n    const substring = string.substring(0, length);\r\n\r\n    return `${substring}...`;\r\n\r\n};\r\n\r\nexport {\r\n    wordsToArray,\r\n    trimEnd\r\n};","import React, {Component} from \"react\";\r\nimport PropTypes from \"prop-types\";\r\nimport HUDButton, {HUDButtonTypesEnum} from \"./HUDButton\";\r\nimport {wordsToArray} from \"../../utils/StringTools\";\r\nimport \"../../css/hud/HUDSongSearch.css\";\r\n\r\nclass HUDSearchBar extends Component {\r\n\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            \"value\": \"\"\r\n        };\r\n        this.lastSubmittedValue = null;\r\n\r\n        this.autoSearchTimer = null;\r\n\r\n        // function bindings\r\n        this.handleChange = this.handleChange.bind(this);\r\n        this.handleSubmit = this.handleSubmit.bind(this);\r\n    }\r\n\r\n    /**\r\n     * Updates the text in the text box and resets the auto-search timer.\r\n     * @param {Event} event event of a key being pressed\r\n     * @returns {void}\r\n     */\r\n    handleChange(event) {\r\n\r\n        // if timer has been set, clear it and reset it.\r\n        if (this.autoSearchTimer) clearTimeout(this.autoSearchTimer);\r\n        this.autoSearchTimer = setTimeout(this.handleSubmit, this.props.submissionTimeoutDelay);\r\n\r\n        this.setState({\"value\": event.target.value});\r\n\r\n    }\r\n\r\n    /**\r\n     * Filters text in box into an array of words (also getting rid of illegal symbols)\r\n     * and runs handler function passing it such array.\r\n     * @returns {void}\r\n     */\r\n    handleSubmit() {\r\n\r\n        // do not search if nothing is in text box\r\n        if (this.state.value === \"\") return;\r\n\r\n        // only submit if the value has changed\r\n        if (this.state.value !== this.lastSubmittedValue) {\r\n\r\n            this.props.searchSongsWithQuery(wordsToArray(this.state.value));\r\n            this.lastSubmittedValue = this.state.value;\r\n\r\n        }\r\n\r\n    }\r\n\r\n    render() {\r\n        return(\r\n            <div\r\n                className=\"search-bar-container\"\r\n                onKeyUp={keyEvent => {\r\n                    if (keyEvent.keyCode === 13) this.handleSubmit();\r\n                }}\r\n            >\r\n                <input\r\n                    className=\"text-box\"\r\n                    placeholder={this.props.placeholder}\r\n                    type=\"text\" value={this.state.value}\r\n                    onChange={this.handleChange}\r\n                />\r\n                <HUDButton type={HUDButtonTypesEnum.ENTER}\r\n                           text=\"Search\"\r\n                           onClick={this.handleSubmit}\r\n                />\r\n            </div>\r\n        );\r\n    }\r\n\r\n}\r\n\r\n// default props\r\nHUDSearchBar.defaultProps = {\r\n    \"searchSongsWithQuery\": query => {\r\n        throw new Error(`Unable to search song with query ${query}. No handler passed.`);\r\n    },\r\n    \"placeholder\": \"Type the name of a song...\",\r\n    \"submissionTimeoutDelay\": 2000\r\n};\r\n\r\n// prop type constraints\r\nHUDSearchBar.propTypes = {\r\n    \"searchSongsWithQuery\": PropTypes.func,\r\n    \"placeholder\": PropTypes.string,\r\n    \"submissionTimeoutDelay\": PropTypes.number\r\n};\r\n\r\nexport default HUDSearchBar;","import React from \"react\";\r\nimport PropTypes from \"prop-types\";\r\nimport \"../../css/hud/SpotifySong.css\";\r\nimport {trimEnd} from \"../../utils/StringTools\";\r\n\r\nconst SongContainerClassMap = Object.freeze({\r\n    \"small\": \"song-container-small\",\r\n    \"large\": \"song-container-large\",\r\n    \"mini\": \"song-container-mini\"\r\n});\r\n\r\n/**\r\n * React element for rendering a song and handling clicks on that element to select a song.\r\n *\r\n * Two styles are supported. Props.size can be either \"small\", \"large\", or \"mini\"\r\n * @param {Object} props react properties\r\n * @constructor\r\n */\r\nconst SpotifySong = props => {\r\n\r\n    const {\r\n        name,\r\n        id,\r\n        imgURL,\r\n        artist,\r\n        duration,\r\n        handleClick,\r\n        size\r\n    } = props;\r\n\r\n    const renderArtistArray = arr => {\r\n\r\n        let str = \"\";\r\n\r\n        arr.forEach((artistInArray, index) => {\r\n           str += artistInArray;\r\n           str += index + 1 === arr.length ? \"\" : \", \";\r\n        });\r\n\r\n        return str;\r\n    };\r\n\r\n    return (\r\n        <div className={`${SongContainerClassMap[size]} song-container`} onClick={() => handleClick({\r\n            name,\r\n            id,\r\n            imgURL,\r\n            artist,\r\n            duration\r\n        })}>\r\n            <img className=\"song-image\" src={imgURL} alt={`Album cover for song ${name} by artist ${artist}`}/>\r\n            <div className=\"song-data-container\">\r\n                <h1 className=\"song-name\">{trimEnd(name, 36)}</h1>\r\n                <h2 className=\"song-artist\">{trimEnd(renderArtistArray(artist))}</h2>\r\n            </div>\r\n        </div>\r\n    );\r\n\r\n};\r\n\r\nSpotifySong.defaultProps = {\r\n    \"name\": \"No Song Name Assigned\",\r\n    \"id\": \"No ID Passed\",\r\n    \"imgURL\": \"No image URL passed\",\r\n    \"artist\": \"No Artist\",\r\n    \"duration\": -1,\r\n    \"handleClick\": () => {\r\n        console.log(\"Song clicked!\");\r\n    },\r\n    \"size\": \"small\"\r\n};\r\n\r\nSpotifySong.propTypes = {\r\n    \"name\": PropTypes.string,\r\n    \"id\": PropTypes.string,\r\n    \"imgURL\": PropTypes.string,\r\n    \"artist\": PropTypes.array,\r\n    \"duration\": PropTypes.number,\r\n    \"handleClick\": PropTypes.func,\r\n    \"size\": PropTypes.string\r\n};\r\n\r\nexport default SpotifySong;\r\n","import React, {Component} from \"react\";\r\nimport PropTypes from \"prop-types\";\r\nimport dotProp from \"dot-prop\";\r\nimport HUDSearchBar from \"../../components/hud/HUDSearchBar\";\r\nimport SpotifySong from \"../../components/hud/SpotifySong\";\r\nimport \"../../css/hud/HUDSongSearch.css\";\r\nimport HUDButton, {HUDButtonTypesEnum} from \"../../components/hud/HUDButton\";\r\n\r\nconst MSG_IDENTIFIER = \"message\";\r\n\r\n/**\r\n * Component responsible for rendering a search bar, and requesting\r\n * the Spotify service to search for songs.\r\n */\r\nclass HUDSongSearchMenu extends Component {\r\n\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        if (!props.spotifyService) throw new Error(\"HUDSearchMenu requires a reference to an instance of SpotifyService!\");\r\n\r\n        // save a reference to spotify service & state notifier\r\n        this.spotifyService = props.spotifyService;\r\n\r\n        // contains list of songs to be rendered\r\n        this.state = {\r\n            \"songList\": [],\r\n            \"hasSearched\": false\r\n        };\r\n\r\n        // bind functions\r\n        this.filterReceivedJSON = this.filterReceivedJSON.bind(this);\r\n    }\r\n\r\n    /**\r\n     * To be used as a callback (or subscription handler) for when a user searches\r\n     * for a set of keywords. This function filters the received object and strips it of\r\n     * unnecessary parameters.\r\n     *\r\n     * @param {Object} json the Spotify server response.\r\n     * @returns {void} new array of songs is updated to the state\r\n     */\r\n    filterReceivedJSON(json) {\r\n\r\n        // destructure tracks into array of items\r\n        const items = dotProp.get(json, \"tracks.items\");\r\n        if (!items) throw new Error(\"No items found in search response!\");\r\n\r\n        // for each item, collect URI, song name, artist name, album image\r\n        // eslint-disable-next-line max-params\r\n        const createTrackObject = (id, name, artist, img, duration) => ({\r\n            name,\r\n            artist,\r\n            img,\r\n            id,\r\n            duration\r\n        });\r\n\r\n        const newTrackArray = items.map(item => {\r\n\r\n            const id = item.id;\r\n            const songName = item.name;\r\n            const artistNames = dotProp.get(item, \"artists\").map(artist => artist.name);\r\n            const imgURL = dotProp.get(item, \"album.images\")[0].url;\r\n            const duration = dotProp.get(item, \"duration_ms\");\r\n\r\n            return createTrackObject(id, songName, artistNames, imgURL, duration);\r\n\r\n        });\r\n\r\n        // update state with new array\r\n        this.setState({\r\n            \"songList\": newTrackArray\r\n        });\r\n\r\n    }\r\n\r\n    /**\r\n     * Parses array of songs in state and converts them into JSX elements.\r\n     * @returns {Array} array of SpotifySong Components\r\n     */\r\n    renderSongList() {\r\n\r\n        const {songList, hasSearched} = this.state;\r\n\r\n        if (songList.length === 0 && hasSearched) {\r\n\r\n            return <h3 className={MSG_IDENTIFIER}>No songs found. Try something else.</h3>;\r\n\r\n        }\r\n\r\n        return songList.map(song => <SpotifySong\r\n                name={song.name}\r\n                artist={song.artist}\r\n                imgURL={song.img}\r\n                duration={song.duration}\r\n                id={song.id}\r\n                key={song.id}\r\n                handleClick={() => this.props.selectSong(song)}\r\n            />);\r\n\r\n    }\r\n\r\n    // renders a HUDSearchBar and a list of songs\r\n    render() {\r\n\r\n        return(\r\n            <div className=\"hud-song-search-outer-container\">\r\n                <div className=\"hud-song-search-inner-container\">\r\n                    <HUDSearchBar\r\n                        searchSongsWithQuery={input => this.spotifyService.search(this.filterReceivedJSON, input)}\r\n                    />\r\n                    <div className={\"song-list-container\"}>\r\n                        {this.renderSongList()}\r\n                    </div>\r\n                    <HUDButton\r\n                        text={\"<\"}\r\n                        type={HUDButtonTypesEnum.RETURN}\r\n                        onClick={this.props.onReturn}\r\n                    />\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n}\r\n\r\n// default props\r\nHUDSongSearchMenu.defaultProps = {\r\n    \"spotifyService\": null,\r\n    \"selectSong\": song => {\r\n        console.error(\"Couldn't select song. No handler passed\", song);\r\n    },\r\n    \"onReturn\": () => {\r\n        console.error(\"No return button handler passed.\");\r\n    }\r\n};\r\n\r\n// prop type constraints\r\nHUDSongSearchMenu.propTypes = {\r\n    \"spotifyService\": PropTypes.object,\r\n    \"selectSong\": PropTypes.func,\r\n    \"onReturn\": PropTypes.func\r\n};\r\n\r\nexport default HUDSongSearchMenu;","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport HUDButton, {HUDButtonTypesEnum} from \"../../components/hud/HUDButton\";\nimport \"../../css/hud/HUDMainMenu.css\";\n\n/**\n * HUD element that wraps all objects in main menu. Two types of main menu can exist:\n * pre and post login.\n * @param {Object} props react props\n * @constructor\n */\nconst HUDMainMenu = props => {\n\n    const {\n        hasLoggedIn,\n        onSongSelectRequest,\n        onLoginRequest,\n        onAboutPageRequest,\n        onLeaderboardsPageRequest\n    } = props;\n\n    // // // BUTTONS // // //\n    const spotifyLoginButton = <HUDButton\n        text=\"Spotify Login\"\n        onClick={onLoginRequest}\n        type={HUDButtonTypesEnum.SPOTIFY}\n    />;\n\n    const selectSongButton = <HUDButton\n        text=\"Select Song\"\n        onClick={onSongSelectRequest}\n        type={HUDButtonTypesEnum.SPOTIFY}\n    />;\n\n    const aboutButton = <HUDButton\n        text=\"About\"\n        onClick={onAboutPageRequest}\n        disabled={true}\n    />;\n\n    const leaderboardsButton = <HUDButton\n        text=\"Leaderboards\"\n        onClick={onLeaderboardsPageRequest}\n    />;\n\n    // determines which top button will be rendered\n    const mainButton = hasLoggedIn ? selectSongButton : spotifyLoginButton;\n\n    return (\n\n        <div className=\"hud-main-menu-outer-container\">\n            <div className=\"hud-main-menu-button-container\">\n                {mainButton}\n                {leaderboardsButton}\n                {aboutButton}\n            </div>\n        </div>\n\n    );\n\n};\n\n// prop type constraints\nHUDMainMenu.propTypes = {\n    \"hasLoggedIn\": PropTypes.bool,\n    \"onSongSelectRequest\": PropTypes.func,\n    \"onLoginRequest\": PropTypes.func,\n    \"onAboutPageRequest\": PropTypes.func,\n    \"onLeaderboardsPageRequest\": PropTypes.func\n};\n\n// default properties\nHUDMainMenu.defaultProps = {\n    \"hasLoggedIn\": false,\n    \"onSongSelectRequest\": () => {\n        throw new Error(\"No handler passed.\");\n    },\n    \"onLoginRequest\": () => {\n        throw new Error(\"No handler passed.\");\n    },\n    \"onAboutPageRequest\": () => {\n        throw new Error(\"No handler passed.\");\n    },\n    \"onLeaderboardsPageRequest\": () => {\n        throw new Error(\"No handler passed.\");\n    }\n};\n\nexport default HUDMainMenu;\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport \"../../css/hud/ScoreContainer.css\";\n\nconst ScoreContainer = props => {\n    if (props.replayMode) {\n        return <div className=\"score-container\">\n            <h2>Replaying...</h2>\n        </div>;\n\n    }\n\n    return <div className=\"score-container\">\n                <h2>Score: </h2><h1>{props.score}</h1><h1>x{props.multiplier}</h1>\n            </div>;\n\n};\n\nScoreContainer.propTypes = {\n    \"score\": PropTypes.number.isRequired,\n    \"multiplier\": PropTypes.number.isRequired,\n    \"replayMode\": PropTypes.bool\n};\n\nexport default ScoreContainer;\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport SpotifySong from \"./SpotifySong\";\nimport \"../../css/hud/HUDSongProgress.css\";\nimport ScoreContainer from \"./ScoreContainer\";\n\nconst HUDSongProgress = props => {\n\n    const {\n        songObject,\n        positionInMilliseconds,\n        shouldDisplay,\n        score,\n        multiplier,\n        replayMode\n    } = props;\n\n    if (!songObject) return null;\n\n    const {\n        name,\n        id,\n        img,\n        artist,\n        duration\n    } = songObject;\n\n    const percentage = positionInMilliseconds / duration * 100;\n\n    const barProperties = {\n        \"width\": `${percentage}%`\n    };\n\n    const componentStyle = {\n        \"display\": shouldDisplay ? \"block\" : \"none\"\n    };\n\n    return (\n        <div\n            className={\"song-progress-bar-container\"}\n            style={componentStyle}\n        >\n            <div id={\"bar-wrapper\"}>\n                <div\n                    id={\"progress-bar\"}\n                    style={barProperties}\n                />\n            </div>\n            <div className={\"progress-bar-song-icon\"}>\n                    <SpotifySong\n                        name={name}\n                        artist={artist}\n                        imgURL={img}\n                        id={id}\n                        size={\"mini\"}\n                    />\n                    <ScoreContainer\n                        score={score ? score : 0}\n                        multiplier={multiplier ? multiplier : 1}\n                        replayMode={replayMode}\n                    />\n            </div>\n        </div>\n    );\n\n};\n\nHUDSongProgress.propTypes = {\n    \"songObject\": PropTypes.shape({\n        \"name\": PropTypes.string,\n        \"id\": PropTypes.string,\n        \"img\": PropTypes.string,\n        \"artist\": PropTypes.array,\n        \"duration\": PropTypes.number\n    }),\n    \"positionInMilliseconds\": PropTypes.number.isRequired,\n    \"shouldDisplay\": PropTypes.bool.isRequired,\n    \"score\": PropTypes.number.isRequired,\n    \"multiplier\": PropTypes.number.isRequired,\n    \"replayMode\": PropTypes.bool\n};\n\nexport default HUDSongProgress;\n","\r\n/**\r\n * Defines handled transitions.\r\n * @type {{}}\r\n */\r\nconst TransitionEnums = {\r\n    \"IN\": \"IN\",\r\n    \"OUT\": \"OUT\"\r\n};\r\n\r\n/**\r\n * Defines default emissions for a transition subject.\r\n * @type {{in: Transition.in, out: Transition.out}}\r\n */\r\nconst Transition = {\r\n    \"in\": subject => {\r\n        if (subject) {\r\n            subject.next({\r\n                \"position\": TransitionEnums.IN\r\n            });\r\n        } else console.error(\"Invalid subject!\");\r\n    },\r\n    \"out\": subject => {\r\n        if (subject) {\r\n            subject.next({\r\n                \"position\": TransitionEnums.OUT\r\n            });\r\n        } else console.error(\"Invalid subject!\");\r\n    }\r\n};\r\n\r\nexport {\r\n    TransitionEnums,\r\n    Transition\r\n};","import React, {Component} from \"react\";\r\nimport PropTypes from \"prop-types\";\r\nimport {TransitionEnums} from \"../../utils/TransitionUtils\";\r\nimport \"../../css/GenericTransitionWrapper.css\";\r\n\r\n/**\r\n * Component responsible for generating a wrapper DIV with properties that allow\r\n * for controllable transition in and out of screen, with the ability to track\r\n * the beginning and end of each transition independently.\r\n *\r\n * Transition types are not specified, and are expected to be passed as an object\r\n * containing all CSS properties that represent either IN or OUT.\r\n *\r\n * @param {Object} props should contain functions for handling end of transitions, and definitions for changes that\r\n * entail IN or OUT states.\r\n * @constructor\r\n */\r\nclass GenericTransitionWrapper extends Component {\r\n\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        // define IN and OUT attributes.\r\n        const {\r\n            IN,\r\n            OUT,\r\n            transitionRequestObservable\r\n        } = props;\r\n\r\n        // determines whether wrapped element starts in or out of the viewport\r\n        this.state = {\r\n            \"position\": props.shouldMountIn ? TransitionEnums.IN : TransitionEnums.OUT,\r\n            \"currentStyle\": props.shouldMountIn ? IN : OUT\r\n        };\r\n\r\n        // handle transition requests\r\n        transitionRequestObservable.delay(250).subscribe(msg => {\r\n\r\n            const {\r\n                position\r\n            } = msg;\r\n\r\n            if (position === TransitionEnums.IN) {\r\n\r\n                this.handleTransitionStart(position);\r\n                this.setState({\r\n                    position,\r\n                    \"currentStyle\": props.IN\r\n                });\r\n\r\n            } else if (position === TransitionEnums.OUT) {\r\n\r\n                console.log(\"request received\");\r\n\r\n                this.handleTransitionStart(position);\r\n                this.setState({\r\n                    position,\r\n                    \"currentStyle\": props.OUT\r\n                });\r\n\r\n            } else console.error(\"Invalid position request. Position passed: \", position);\r\n\r\n        });\r\n\r\n        // bind functions\r\n        this.handleTransitionStart = this.handleTransitionStart.bind(this);\r\n        this.handleTransitionEnd = this.handleTransitionEnd.bind(this);\r\n\r\n    }\r\n\r\n    componentDidMount() {\r\n\r\n        const {\r\n            onMount\r\n        } = this.props;\r\n\r\n        if (onMount) onMount();\r\n\r\n    }\r\n\r\n    /**\r\n     * Handles start of transition, and calls appropriate handler prop.\r\n     * @param {TransitionEnums} position Enumeration designating desired change\r\n     * @returns {void}\r\n     */\r\n    handleTransitionStart(position) {\r\n\r\n        switch(position) {\r\n\r\n            case TransitionEnums.IN:\r\n                // break if no assigned functions\r\n                if (!this.props.onStartTransitionIn) break;\r\n                this.props.onStartTransitionIn();\r\n                break;\r\n            case TransitionEnums.OUT:\r\n                // break if no assigned functions\r\n                if (!this.props.onStartTransitionOut) break;\r\n                this.props.onStartTransitionOut();\r\n                break;\r\n            default:\r\n                console.error(\"'Position' state not appropriate: \", position);\r\n                break;\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n     * Handles end of transition, and calls appropriate handler prop.\r\n     * @returns {void}\r\n     */\r\n    handleTransitionEnd() {\r\n\r\n        switch(this.state.position) {\r\n\r\n            case TransitionEnums.IN:\r\n                if (!this.props.onEndTransitionIn) break;\r\n                this.props.onEndTransitionIn();\r\n                break;\r\n            case TransitionEnums.OUT:\r\n                if (!this.props.onEndTransitionOut) break;\r\n                this.props.onEndTransitionOut();\r\n                break;\r\n            default:\r\n                console.error(\"'Position' state not appropriate: \", this.state.position);\r\n                break;\r\n        }\r\n\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div\r\n                className={\"transition-wrapper\"}\r\n                style={{\r\n                    ...this.state.currentStyle,\r\n                    \"zIndex\": this.props.zIndex\r\n                }}\r\n                onTransitionEnd={this.handleTransitionEnd}\r\n            >\r\n                {this.props.children}\r\n            </div>\r\n        );\r\n    }\r\n\r\n\r\n}\r\n\r\nGenericTransitionWrapper.propTypes = {\r\n    \"IN\": PropTypes.object.isRequired,\r\n    \"OUT\": PropTypes.object.isRequired,\r\n    \"shouldMountIn\": PropTypes.bool,\r\n    \"children\": PropTypes.any,\r\n    \"onStartTransitionIn\": PropTypes.func,\r\n    \"onStartTransitionOut\": PropTypes.func,\r\n    \"onEndTransitionIn\": PropTypes.func,\r\n    \"onEndTransitionOut\": PropTypes.func,\r\n    \"transitionRequestObservable\": PropTypes.any.isRequired,\r\n    \"onMount\": PropTypes.func,\r\n    \"zIndex\": PropTypes.number\r\n};\r\n\r\nGenericTransitionWrapper.defaultProps = {\r\n    \"onMount\": () => console.log(\"Component mounted.\"),\r\n    \"onStartTransitionIn\": null,\r\n    \"onStartTransitionOut\": null,\r\n    \"onEndTransitionIn\": null,\r\n    \"onEndTransitionOut\": null,\r\n    \"shouldMountIn\": false,\r\n    \"zIndex\": 0\r\n};\r\n\r\nexport default GenericTransitionWrapper;","import React from \"react\";\r\nimport PropTypes from \"prop-types\";\r\nimport GenericTransitionWrapper from \"./GenericTransitionWrapper\";\r\nimport {Transition} from \"../../utils/TransitionUtils\";\r\n\r\nconst FadeTransition = props => {\r\n\r\n    const {\r\n        shouldMountIn,\r\n        onStartTransitionIn,\r\n        onStartTransitionOut,\r\n        onEndTransitionIn,\r\n        onEndTransitionOut,\r\n        transitionRequestObservable,\r\n        onMount,\r\n        zIndex\r\n    } = props;\r\n\r\n    // default to transitioning in on mount\r\n    const mountHandler = onMount ? onMount : () => Transition.in(transitionRequestObservable);\r\n\r\n    return (\r\n        <GenericTransitionWrapper\r\n            zIndex={zIndex}\r\n            OUT={{\"opacity\": 0}}\r\n            IN={{\"opacity\": 1}}\r\n            shouldMountIn={shouldMountIn}\r\n            transitionRequestObservable={transitionRequestObservable}\r\n            onMount={mountHandler}\r\n            onEndTransitionIn={onEndTransitionIn}\r\n            onEndTransitionOut={onEndTransitionOut}\r\n            onStartTransitionIn={onStartTransitionIn}\r\n            onStartTransitionOut={onStartTransitionOut}\r\n        >{props.children}</GenericTransitionWrapper>\r\n\r\n    );\r\n\r\n};\r\n\r\nFadeTransition.propTypes = {\r\n    \"onStartTransitionIn\": PropTypes.func,\r\n    \"onStartTransitionOut\": PropTypes.func,\r\n    \"onEndTransitionIn\": PropTypes.func,\r\n    \"onEndTransitionOut\": PropTypes.func,\r\n    \"onMount\": PropTypes.func,\r\n    \"transitionRequestObservable\": PropTypes.any.isRequired,\r\n    \"shouldMountIn\": PropTypes.bool,\r\n    \"zIndex\": PropTypes.number\r\n};\r\n\r\nFadeTransition.defaultProps = {\r\n    \"shouldMountIn\": false,\r\n    \"zIndex\": 0\r\n};\r\n\r\nexport default FadeTransition;","import React from \"react\";\r\nimport PropTypes from \"prop-types\";\r\nimport GenericTransitionWrapper from \"./GenericTransitionWrapper\";\r\nimport {Transition} from \"../../utils/TransitionUtils\";\r\n\r\nconst SlideTransition = props => {\r\n\r\n    const {\r\n        shouldMountIn,\r\n        onStartTransitionIn,\r\n        onStartTransitionOut,\r\n        onEndTransitionIn,\r\n        onEndTransitionOut,\r\n        transitionRequestObservable,\r\n        onMount,\r\n        zIndex\r\n    } = props;\r\n\r\n    // default to transitioning in on mount\r\n    const mountHandler = onMount ? onMount : () => Transition.in(transitionRequestObservable);\r\n\r\n    return (\r\n        <GenericTransitionWrapper\r\n            zIndex={zIndex}\r\n            OUT={{\"left\": \"100%\"}}\r\n            IN={{\"left\": \"0\"}}\r\n            shouldMountIn={shouldMountIn}\r\n            transitionRequestObservable={transitionRequestObservable}\r\n            onMount={mountHandler}\r\n            onEndTransitionIn={onEndTransitionIn}\r\n            onEndTransitionOut={onEndTransitionOut}\r\n            onStartTransitionIn={onStartTransitionIn}\r\n            onStartTransitionOut={onStartTransitionOut}\r\n        >{props.children}</GenericTransitionWrapper>\r\n\r\n    );\r\n\r\n};\r\n\r\nSlideTransition.propTypes = {\r\n    \"onStartTransitionIn\": PropTypes.func,\r\n    \"onStartTransitionOut\": PropTypes.func,\r\n    \"onEndTransitionIn\": PropTypes.func,\r\n    \"onEndTransitionOut\": PropTypes.func,\r\n    \"onMount\": PropTypes.func,\r\n    \"transitionRequestObservable\": PropTypes.any.isRequired,\r\n    \"shouldMountIn\": PropTypes.bool,\r\n    \"zIndex\": PropTypes.number\r\n};\r\n\r\nSlideTransition.defaultProps = {\r\n    \"shouldMountIn\": false\r\n};\r\n\r\nexport default SlideTransition;","import React from \"react\";\r\nimport PropTypes from \"prop-types\";\r\nimport SpotifySong from \"../../components/hud/SpotifySong\";\r\nimport HUDButton, {HUDButtonTypesEnum} from \"../../components/hud/HUDButton\";\r\nimport \"../../css/hud/HUDSongSelect.css\";\r\n\r\n/**\r\n * Component that displays selected song in the center of the screen, and that\r\n * progresses the flow of the application towards fetching data from a specific\r\n * track necessary for level generation, as well as updating game state.\r\n * @param {Object} props react props\r\n * @returns {*}\r\n * @constructor\r\n */\r\nconst HUDSongSelectMenu = props => {\r\n\r\n    const {\r\n        songObject,\r\n        onConfirmation\r\n    } = props;\r\n\r\n    const {\r\n        name,\r\n        id,\r\n        img,\r\n        artist\r\n    } = songObject;\r\n\r\n    const genBtnStyle = {\r\n        \"width\": \"auto\"\r\n    };\r\n\r\n    return (\r\n        <div className=\"hud-song-select-outer-container\">\r\n                <SpotifySong\r\n                    size=\"large\"\r\n                    name={name}\r\n                    id={id}\r\n                    imgURL={img}\r\n                    artist={artist}\r\n                />\r\n                <HUDButton text=\"Generate Level\" onClick={onConfirmation} style={genBtnStyle}/>\r\n                <HUDButton text={\"<\"} type={HUDButtonTypesEnum.RETURN} onClick={props.onReturn}/>\r\n        </div>\r\n    );\r\n\r\n};\r\n\r\nHUDSongSelectMenu.propTypes = {\r\n    \"songObject\": PropTypes.shape({\r\n        \"name\": PropTypes.string.isRequired,\r\n        \"id\": PropTypes.string.isRequired,\r\n        \"img\": PropTypes.string,\r\n        \"artist\": PropTypes.array.isRequired\r\n    }),\r\n    \"onConfirmation\": PropTypes.func.isRequired,\r\n    \"onReturn\": PropTypes.func.isRequired\r\n};\r\n\r\nexport default HUDSongSelectMenu;","import React, {Component} from \"react\";\nimport PropTypes from \"prop-types\";\nimport SlideTransition from \"./transition/SlideTransition\";\nimport {Subject} from \"rxjs\";\nimport {Transition} from \"../utils/TransitionUtils\";\nimport \"../css/Form.css\";\nimport HUDButton, {HUDButtonTypesEnum} from \"./hud/HUDButton\";\n\n/* eslint no-inline-comments: 0 */\n/* eslint line-comment-position: 0 */\n/* eslint max-params: 0 */\n\nconst rangeLowToHigh = [\"Very Poorly\", \"Poorly\", \"Somewhat Poorly\", \"Somewhat Well\", \"Well\", \"Very Well\"];\nconst rangeSlowFast = [\"Too Slow\", \"Just Right\", \"Too Fast\"];\n\nexport const questionLabels = {\n    \"q1\": \"What elements did you particularly enjoy?\",\n    \"q2\": \"What elements did you dislike/have problems with?\",\n    \"q3\": \"Did you feel that this experience helped enhance the music you were listening to?\",\n    \"q4\": \"To what degree did you feel the elements in the level were in sync with the music you were listening to?\",\n    \"q5\": \"To what extent did the moving background help create the feeling of going down a mountain?\",\n    \"q6\": \"How much did the moving background help give you a sense of speed as you went down the mountain? \",\n    \"q7\": \"Did you feel like you were moving at an appropriate speed for the type of song you chose?\",\n    \"q8\": \"To what extent did the background elements positively complement your visual experience?\",\n    \"q9\": \"Did being able to choose your own song help enhance your experience over having to select a song from a given playlist?\",\n    \"q10\": \"Select all that describe your experience choosing a song\",\n    \"q11\": \"Would you like to see song recommendations based on what you listened to previously?\",\n    \"q12\": \"If there was one thing you could improve about this game what would it be?\",\n    \"q13\": \"Do you have a Spotify Premium account?\",\n    \"q14\": \"Do you have any other comments about our game?\"\n};\n\n/**\n * Component that contains the end-of-game feedback\n * form.\n */\nclass FormOverlay extends Component {\n\n    // todo: constrain string length for questions\n    constructor(props) {\n        super(props);\n\n        // question values\n        this.state = {\n            \"btnText\": \"Submit!\",\n            \"showForm\": false,\n            \"q1\": {\n                \"speed\": false,\n                \"tricks\": false,\n                \"movingBackground\": false,\n                \"jump\": false,\n                \"art\": false,\n                \"character\": false,\n                \"animations\": false,\n                \"mountain\": false\n            }, // Q1: multiple ans\n            \"q2\": {\n                \"speed\": false,\n                \"tricks\": false,\n                \"movingBackground\": false,\n                \"jump\": false,\n                \"art\": false,\n                \"character\": false,\n                \"animations\": false,\n                \"mountain\": false\n            }, // Q2: mult ans\n            \"q3\": false, // Q3: y / n\n            \"q4\": 1, // Q4: range 1-6\n            \"q5\": 1, // Q5: Range from 1-6\n            \"q6\": 1, // Q6: Range from 1-6\n            \"q7\": 2, // Q7: Range from 1-3\n            \"q8\": 1, // Q8: Range from 1-6\n            \"q9\": false, // Q9: Textbox\n            \"q10\": {\n                \"easy\": false,\n                \"overwhelming\": false,\n                \"couldntChoose\": false,\n                \"cateredToMe\": false,\n                \"noChoiceAvailabe\": false,\n                \"other\": false,\n                \"otherValue\": \"\"\n            }, // mult choice with other\n            \"q11\": false, // Q11: Yes/No\n            \"q12\": \"\", // Q12: txt\n            \"q13\": false, // Q13: Yes/No\n            \"q14\": \"\", // Q14: txt,\n            \"name\": \"\"\n        };\n\n        this.handleChange = this.handleChange.bind(this);\n\n    }\n\n    handleChange (question, value) {\n        const newState = {};\n        newState[question] = value;\n\n        this.setState(newState);\n    }\n\n    renderQuestionContainer (text, inputComponent, key, currentValueDisplay = null) {\n\n        return (\n            <div className=\"question-container\" key={key}>\n                <p>{text}</p>\n                <div className=\"input-wrapper\">\n                    {inputComponent}\n                    {currentValueDisplay ? <p><strong>{currentValueDisplay}</strong></p> : null}\n                </div>\n            </div>\n        );\n    }\n\n    renderMultipleChoiceContainer (text, key, choiceLabels, questionID, other = false) {\n\n        const stateObjRef = this.state[questionID];\n        const stateObjKeys = Object.keys(stateObjRef);\n\n        if (other) {\n            if (choiceLabels.length !== stateObjKeys.length - 1) {\n                console.error(\"Labels not compatible with keys.\", {\n                    \"labels\": choiceLabels.length,\n                    \"keys\": stateObjKeys.length\n                });\n\n                return null;\n            }\n        } else if (choiceLabels.length !== stateObjKeys.length) {\n                console.error(\"Labels not compatible with keys.\", {\n                    \"labels\": choiceLabels.length,\n                    \"keys\": stateObjKeys.length\n                });\n\n                return null;\n            }\n\n        const handleCheckboxChange = evt => {\n\n            const box = evt.target.value;\n            const oldState = stateObjRef;\n            oldState[box] = evt.target.checked;\n\n            const newState = {};\n            newState[questionID] = oldState;\n\n            this.setState(newState);\n\n        };\n\n        const handleOtherChange = evt => {\n\n            const oldState = stateObjRef;\n            oldState.otherValue = evt.target.value;\n\n            const newState = {};\n            newState[questionID] = oldState;\n\n            this.setState(newState);\n\n        };\n\n        return (\n            <div className=\"question-container\" key={key}>\n                <p>{text}</p>\n                <div className=\"checkbox-array-container\">\n                    {choiceLabels.map((label, index) => <div className=\"checkbox-div\" key={questionID + index}>\n                        <label>\n                            <input\n                                type=\"checkbox\"\n                                checked={stateObjRef[stateObjKeys[index]]}\n                                value={stateObjKeys[index]}\n                                onChange={handleCheckboxChange} /> {label}\n                        </label>\n                    </div>)}\n                    {other ? <input\n                        type=\"text\"\n                        disabled={!stateObjRef.other}\n                        value={stateObjRef.otherValue}\n                        onChange={handleOtherChange}\n                        name={questionID}\n                        id={questionID} /> : null }\n                </div>\n            </div>\n        );\n\n    }\n\n    render() {\n\n        const transitionObservable = new Subject();\n        const onMount = () => Transition.in(transitionObservable);\n        const questions = [];\n\n        const q1andq2Labels = [\n            \"The speed\",\n            \"The tricks\",\n            \"The moving backgrounds\",\n            \"The jumping\",\n            \"The Artwork\",\n            \"The player character\",\n            \"Animations\",\n            \"Procedurally generated mountain\"\n        ];\n\n        const generateQuestions = () => {\n            // 1\n            questions.push(this.renderMultipleChoiceContainer(\n                questionLabels.q1,\n                questions.length,\n                q1andq2Labels, \"q1\"\n            ));\n\n            // 2\n            questions.push(this.renderMultipleChoiceContainer(\n                questionLabels.q2,\n                questions.length,\n                q1andq2Labels,\n                \"q2\"\n            ));\n\n            // 3\n            questions.push(this.renderQuestionContainer(\n                questionLabels.q3,\n                <label className=\"switch\">\n                    <input type=\"checkbox\"\n                           onChange={evt => this.handleChange(\"q3\", evt.target.checked)}\n                           checked={this.state.q3} />\n                    <span className=\"slider\"/>\n                </label>,\n                questions.length,\n                this.state.q3 ? \"Yes\" : \"No\"\n            ));\n\n            // 4\n            questions.push(this.renderQuestionContainer(\n                questionLabels.q4,\n                <input\n                    type=\"range\"\n                    step=\"1\"\n                    value={this.state.q4}\n                    onChange={evt => this.handleChange(\"q4\", parseInt(evt.target.value, 10))}\n                    min=\"1\"\n                    max=\"6\"\n                    name=\"q4\"\n                    id=\"q4\" />,\n                questions.length,\n                rangeLowToHigh[this.state.q4 - 1]\n            ));\n\n            // 5\n            questions.push(this.renderQuestionContainer(\n                questionLabels.q5,\n                <input\n                    type=\"range\"\n                    step=\"1\"\n                    value={this.state.q5}\n                    onChange={evt => this.handleChange(\"q5\", parseInt(evt.target.value, 10))}\n                    min=\"1\"\n                    max=\"6\"\n                    name=\"q5\"\n                    id=\"q5\" />,\n                questions.length,\n                rangeLowToHigh[this.state.q5 - 1]\n            ));\n\n            // 6\n            questions.push(this.renderQuestionContainer(\n                questionLabels.q6,\n                <input\n                    type=\"range\"\n                    step=\"1\"\n                    value={this.state.q6}\n                    onChange={evt => this.handleChange(\"q6\", parseInt(evt.target.value, 10))}\n                    min=\"1\"\n                    max=\"6\"\n                    name=\"q6\"\n                    id=\"q6\" />,\n                questions.length,\n                rangeLowToHigh[this.state.q6 - 1]\n            ));\n\n            // 7\n            questions.push(this.renderQuestionContainer(\n                questionLabels.q7,\n                <input\n                    style={{\n                        \"width\": \"20vw\"\n                    }}\n                    type=\"range\"\n                    step=\"1\"\n                    value={this.state.q7}\n                    onChange={evt => this.handleChange(\"q7\", parseInt(evt.target.value, 10))}\n                    min=\"1\"\n                    max=\"3\"\n                    name=\"q7\"\n                    id=\"q7\" />,\n                questions.length,\n                rangeSlowFast[this.state.q7 - 1]\n            ));\n\n            // 8\n            questions.push(this.renderQuestionContainer(\n                questionLabels.q8,\n                <input\n                    type=\"range\"\n                    step=\"1\"\n                    value={this.state.q8}\n                    onChange={evt => this.handleChange(\"q8\", parseInt(evt.target.value, 10))}\n                    min=\"1\"\n                    max=\"6\"\n                    name=\"q8\"\n                    id=\"q8\" />,\n                questions.length,\n                rangeLowToHigh[this.state.q8 - 1]\n            ));\n\n            // 9\n            questions.push(this.renderQuestionContainer(\n                questionLabels.q9,\n                <label className=\"switch\">\n                    <input type=\"checkbox\"\n                           onChange={evt => this.handleChange(\"q9\", evt.target.checked)}\n                           checked={this.state.q9} />\n                    <span className=\"slider\"/>\n                </label>,\n                questions.length,\n                this.state.q9 ? \"Yes\" : \"No\"\n            ));\n\n            // 10\n            questions.push(this.renderMultipleChoiceContainer(\n                questionLabels.q10,\n                questions.length,\n                [\n                    \"Easy to use\",\n                    \"Overwhelming\",\n                    \"Couldn’t think of a song\",\n                    \"Catered to me\",\n                    \"My choice wasn't there\",\n                    \"Other\"\n                ],\n                \"q10\",\n                true\n            ));\n\n            // 11\n            questions.push(this.renderQuestionContainer(\n                questionLabels.q11,\n                <label className=\"switch\">\n                    <input type=\"checkbox\"\n                           onChange={evt => this.handleChange(\"q11\", evt.target.checked)}\n                           checked={this.state.q11} />\n                    <span className=\"slider\"/>\n                </label>,\n                questions.length,\n                this.state.q11 ? \"Yes\" : \"No\"\n            ));\n\n            // 12\n            questions.push(this.renderQuestionContainer(\n                questionLabels.q12,\n                <input\n                    type=\"text\"\n                    value={this.state.q12}\n                    onChange={evt => this.handleChange(\"q12\", evt.target.value)}\n                    name=\"q12\"\n                    id=\"q12\" />,\n                questions.length,\n                this.state.q12 ? \"√\" : \"Field required\"\n            ));\n\n            // 13\n            questions.push(this.renderQuestionContainer(\n                questionLabels.q13,\n                <label className=\"switch\">\n                    <input type=\"checkbox\"\n                           onChange={evt => this.handleChange(\"q13\", evt.target.checked)}\n                           checked={this.state.q13} />\n                    <span className=\"slider\"/>\n                </label>,\n                questions.length,\n                this.state.q13 ? \"Yes\" : \"No\"\n            ));\n\n            // 14\n            questions.push(this.renderQuestionContainer(\n                questionLabels.q14,\n                <input\n                    type=\"text\"\n                    value={this.state.q14}\n                    onChange={evt => this.handleChange(\"q14\", evt.target.value)}\n                    name=\"q14\"\n                    id=\"q14\" />,\n                questions.length,\n                \"\"\n            ));\n        };\n\n        generateQuestions();\n\n        const form = <div className={\"form-container\"}>\n            <form onSubmit={evt => {\n                evt.preventDefault();\n\n                this.props.onSubmit(this.state);\n            }}>\n                {questions}\n                {this.renderQuestionContainer(\n                    \"Please sign digitally (your name will not be associated with your responses)\",\n                    <input\n                        type=\"text\"\n                        value={this.state.name}\n                        onChange={evt => this.handleChange(\"name\", evt.target.value)}\n                        name=\"name\"\n                        id=\"name\" />,\n                    questions.length\n                )}\n                <HUDButton\n                    onClick={() => this.setState({\"btnText\": \"Submitting...\"})}\n                    type={HUDButtonTypesEnum.SMALL}\n                    disabled={!this.state.name}\n                    text={this.state.name ? this.state.btnText : \"Please sign this form!\"} />\n            </form>\n        </div>;\n\n        const confirmationScreen = <div className=\"confirmation-screen-container\">\n            <h1>Thank you for playing! If you are a WPI student, please take our exit form.</h1>\n            <HUDButton\n                onClick={() => this.setState({\"showForm\": true})}\n                text={\"Show Form\"}\n            />\n            <HUDButton\n                onClick={this.props.onCancel}\n                text={\"Main Menu\"}\n            />\n        </div>;\n\n        return (\n            <SlideTransition\n                zIndex={this.props.zIndex}\n                transitionRequestObservable={transitionObservable}\n                onMount={onMount} >\n                {this.state.showForm ? form : confirmationScreen}\n            </SlideTransition>\n        );\n    }\n\n}\n\nFormOverlay.propTypes = {\n    \"onSubmit\": PropTypes.func.isRequired,\n    \"onCancel\": PropTypes.func.isRequired,\n    \"zIndex\": PropTypes.number\n};\n\nFormOverlay.defaultProps = {\n    \"zIndex\": 5\n};\n\nexport default FormOverlay;","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport \"../../css/hud/Controls.css\";\n\nconst Controls = props => {\n\n    const {\n        controlMap,\n        highlight,\n        hide\n    } = props;\n\n    const arrow = \" \\u27f6 \";\n\n    return <div className={`control-display-wrapper ${highlight ? \"highlight bounce animated\" : \"\"} ${hide ? \"hide\" : \"\"}`}>\n        <h1>Controls:</h1>\n        {\n            Object.keys(controlMap).map((key, index) => <h3 key={key + index}>\n                <strong>{key}</strong>{arrow}{controlMap[key]}\n            </h3>)\n        }\n    </div>;\n};\n\nControls.propTypes = {\n    \"controlMap\": PropTypes.object.isRequired,\n    \"highlight\": PropTypes.bool,\n    \"hide\": PropTypes.bool\n};\n\nControls.defaultProps = {\n    \"controlMap\": {\n        \"Spacebar\": \"Jump\",\n        \"W\": \"Tail Grab\",\n        \"A\": \"360\",\n        \"S\": \"Front Foot\",\n        \"D\": \"Back Foot\"\n    },\n    \"highlight\": false\n};\n\nexport default Controls;\n","import React from \"react\";\r\nimport HUDButton from \"./HUDButton\";\r\nimport pauseIcon from \"../../img/pause.png\";\r\nimport playIcon from \"../../img/play.png\";\r\nimport Controls from \"./Controls\";\r\nimport \"../../css/hud/PauseOverlay.css\";\r\n\r\nconst PauseOverlay = props => {\r\n\r\n    const {\r\n        isPlaying,\r\n        onPause,\r\n        onResume\r\n    } = props;\r\n\r\n    const handleClick = () => {\r\n        if (isPlaying) onPause();\r\n        onResume();\r\n    };\r\n\r\n    return (\r\n        <div className={`pause-overlay-container ${isPlaying ? \"\" : \"cover-screen\"}`}>\r\n            <HUDButton\r\n                className={`play-pause-btn ${isPlaying ? \"playing\" : \"paused\"}`}\r\n                onClick={handleClick}\r\n                text=\"\" >\r\n                <img src={isPlaying ? pauseIcon : playIcon} alt=\"Play/Pause Icon\"/>\r\n            </HUDButton>\r\n            <Controls highlight={!isPlaying} hide={isPlaying} />\r\n        </div>\r\n    );\r\n\r\n};\r\n\r\nexport default PauseOverlay;\r\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport HUDButton, {HUDButtonTypesEnum} from \"./hud/HUDButton\";\nimport \"../css/MessageOverlay.css\";\nimport LoremIpsum from \"../utils/LoremIpsum\";\nimport FadeTransition from \"./transition/FadeTransition\";\nimport {Subject} from \"rxjs\";\nimport {Transition} from \"../utils/TransitionUtils\";\n\n/**\n * Renders an overlay with a button. Possible to pass either\n * a title, subtitle and body to text, or title, subtitle, and child props.\n * @param {Object} props\n * @returns {jsx} the jsx object\n * @constructor\n */\nconst MessageOverlay = props => {\n\n    const {\n        buttonText,\n        onButtonClick,\n        title,\n        subtitle,\n        paragraphs,\n        children\n    } = props;\n\n    if (children && paragraphs) {\n\n        console.error(\"You can pass either an array of paragraphs or children to be rendered.\");\n\n        return null;\n\n    }\n\n    const subtitleElement = subtitle ? <h2>{subtitle}</h2> : null,\n          titleElement = title ? <h1>{title}</h1> : null;\n\n    let bodyElement = null;\n\n    if (children) bodyElement = children;\n    else if (paragraphs && Array.isArray(paragraphs)) bodyElement = paragraphs.map((paragraph, index) => <p key={index}>{paragraph}</p>);\n\n    const transitionObservable = new Subject();\n    const handleButtonClick = () => Transition.out(transitionObservable);\n\n    return (\n\n            <FadeTransition\n                transitionRequestObservable={transitionObservable}\n                shouldMountIn={false}\n                zIndex={3}\n                onEndTransitionOut={onButtonClick} >\n\n                <div className=\"message-overlay-outer-container\">\n                    <div className=\"message-overlay-body-container\">\n                        {titleElement}\n                        {subtitleElement}\n                        {bodyElement}\n                        <br/>\n                        <HUDButton type={HUDButtonTypesEnum.SMALL} text={buttonText} onClick={handleButtonClick} />\n                    </div>\n                </div>\n            </FadeTransition>\n    );\n\n};\n\nMessageOverlay.propTypes = {\n    \"buttonText\": PropTypes.string,\n    \"onButtonClick\": PropTypes.func.isRequired,\n    \"title\": PropTypes.string,\n    \"subtitle\": PropTypes.string,\n    \"paragraphs\": PropTypes.arrayOf(PropTypes.string)\n};\n\nMessageOverlay.defaultProps = {\n    \"buttonText\": \"OK\",\n    \"onButtonClick\": () => console.error(\"No button click handler.\"),\n    \"title\": \"Default message:\",\n    \"subtitle\": \"This is a message.\"\n    // \"paragraphs\": [...LoremIpsum.get(3), \"Thank you for reading!\"]\n};\n\nexport default MessageOverlay;","import React from \"react\";\r\nimport PropTypes from \"prop-types\";\r\nimport FadeTransition from \"../transition/FadeTransition\";\r\nimport {Subject} from \"rxjs\";\r\nimport \"../../css/hud/LoadingOverlay.css\";\r\nimport Controls from \"./Controls\";\r\n\r\nconst LoadingOverlay = props => {\r\n\r\n    const {\r\n        transitionObservable,\r\n        onUnmount\r\n    } = props;\r\n\r\n    return (\r\n        <FadeTransition\r\n            transitionRequestObservable={transitionObservable}\r\n            shouldMountIn={false}\r\n            zIndex={3}\r\n            onEndTransitionOut={onUnmount} >\r\n\r\n            <div className=\"loading-overlay-container\">\r\n                <div className=\"lds-roller\">\r\n                    <div></div>\r\n                    <div></div>\r\n                    <div></div>\r\n                    <div></div>\r\n                    <div></div>\r\n                    <div></div>\r\n                    <div></div>\r\n                    <div></div>\r\n                </div>\r\n                <h2 className=\"loading-text\">Generating mountain...</h2>\r\n                <Controls />\r\n            </div>\r\n\r\n        </FadeTransition>\r\n    );\r\n\r\n};\r\n\r\nLoadingOverlay.propTypes = {\r\n    \"transitionObservable\": PropTypes.instanceOf(Subject).isRequired,\r\n    \"onUnmount\": PropTypes.func\r\n};\r\n\r\nexport default LoadingOverlay;","/**\n * Service utility for client server communication;\n * Abstracts HTTP operations for more ease of repeated use.\n */\nimport dotProp from \"dot-prop\";\n\nclass APIService {\n\n    /**\n     * Determines if user exists in database; If exists,\n     * resolves promise to true. If not, resolves promise to false.\n     *\n     * If some error occurs, promise is rejected.\n     *\n     * @param {String} spotifyID the spotify ID of the user\n     * @param {String} displayName the display name of the user // todo: Field is updated if user exists in database.\n     * @param {String} imageUrl the profile picture of user // todo: Field is updated if user exists in database\n     * @returns {Promise<Boolean>} resolves to true if user exists, false if user is new. Rejects if there's an error.\n     */\n    static checkInUser(spotifyID, displayName, imageUrl) {\n\n        const addNewUser = () => {\n\n            const init = {\n                \"method\": \"POST\",\n                \"headers\": {\n                    \"Content-Type\": \"application/json\"\n                },\n                \"body\": JSON.stringify({\n                    spotifyID,\n                    displayName,\n                    imageUrl\n                })\n            };\n\n            return fetch(\"/api/users\", init);\n\n        };\n\n        const promiseHandler = (resolve, reject) => {\n\n            // get user if exists\n            fetch(`/api/user/${spotifyID}`)\n                .then(res => res.json())\n                .then(resJSON => {\n\n                    if (resJSON.status === \"success\") {\n\n                        // TODO: implement endpoint for updating fields\n                        resolve(true);\n\n                    } else if (resJSON.status === \"failure\" && resJSON.errorCode === 1) {\n\n                        return addNewUser();\n\n                    } else reject();\n\n                })\n                .then(res => res.json())\n                .then(resJSON => {\n                    if (resJSON.status === \"success\") {\n                        resolve(false);\n                    } else reject();\n                })\n                .catch(() => reject());\n\n\n        };\n\n        return new Promise(promiseHandler);\n\n    }\n\n    /**\n     * Stores a game session and game session inputs in the database.\n     *\n     * @param {Object} sessionObject object containing session information (score, songID, userID, gameVersion)\n     * @param {Array<Object>} inputArray contains input objects (sessionID, action, timestamp, type)\n     * @returns {Promise<null>} resolves if successful and rejects if there's an error\n     */\n    static saveGameSession(sessionObject, inputArray) {\n\n        const handler = (resolve, reject) => {\n\n            this.saveGameSessionOnly(sessionObject)\n                .then(id => this.saveInputArrayOnly(inputArray, id))\n                .then(res => resolve(res))\n                .catch(err => reject(err));\n\n        };\n\n        return new Promise(handler);\n\n    }\n\n    /**\n     * Stores only a game session object in the database.\n     *\n     * @param {Object} sessionObject contains (score, songID, userID, gameVersion)\n     * @returns {Promise<Number>} resolves to an integer representing the sessionID if successfully inserted, rejects if\n     * there's an error\n     */\n    static saveGameSessionOnly(sessionObject) {\n\n        const url = \"/api/sessions\";\n        const init = {\n            \"method\": \"POST\",\n            \"headers\": {\n                \"Content-Type\": \"application/json\"\n            },\n            \"body\": JSON.stringify(sessionObject)\n        };\n\n        const handler = (resolve, reject) => {\n\n            fetch(url, init)\n                .then(response => response.json())\n                .then(responseJSON => {\n                    const id = dotProp.get(responseJSON, \"lastSessionID\");\n\n                    return responseJSON.status === \"success\"\n                        ? resolve(id)\n                        : reject(responseJSON);\n                })\n                .catch(err => reject(err));\n\n        };\n\n        return new Promise(handler);\n\n    }\n\n    /**\n     * Stores only an array of inputs in the database.\n     *\n     * Note: inputs can only be stored after session is stored.\n     *\n     * @param {Array} inputArray array containing objects (sessionID, action, timestamp, type)\n     * @param {Number} sessionID an integer representing the id of the session\n     * @returns {Promise<Object>} resolves if successfully inserted, rejects if there's an error\n     */\n    static saveInputArrayOnly(inputArray, sessionID) {\n\n        const modifiedArray = inputArray.map(input => ({\n            \"timestamp\": String(input.timestamp),\n            \"action\": input.action,\n            \"type\": input.type,\n            sessionID\n        }));\n\n        const url = \"/api/inputs\";\n        const init = {\n            \"method\": \"POST\",\n            \"headers\": {\n                \"Content-Type\": \"application/json\"\n            },\n            \"body\": JSON.stringify({\n                \"inputs\": modifiedArray\n            })\n        };\n\n        const handler = (resolve, reject) => {\n\n            if (typeof sessionID !== \"number\") reject({\n                    \"status\": \"failure\",\n                    \"reason\": \"something is wrong\",\n                    \"thing\": {\n                        inputArray,\n                        sessionID\n                    }\n                });\n\n            fetch(url, init)\n                .then(response => response.json())\n                .then(responseJSON => responseJSON.status === \"success\"\n                    ? resolve()\n                    : reject(responseJSON))\n                .catch(err => reject(err));\n\n        };\n\n        return new Promise(handler);\n\n    }\n\n    /**\n     * Fetches top 10 sessions in database.\n     *\n     * @param {String} userID optional spotify ID to filter top 10 plays of given user\n     * @returns {Promise<Object>} promise that resolves in a response object containing all sessions or rejects in\n     * case of an error.\n     */\n    static fetchLeaderboard(userID = null) {\n\n        const headers = new Headers();\n        headers.append(\"Content-Type\", \"application/json\");\n        headers.append(\"X-Game-Version\", String(process.env.REACT_APP_VERSION));\n\n        const url = `/api/leaderboard${userID ? `/${userID}` : \"\"}`;\n        const init = {\n            \"method\": \"GET\",\n            \"mode\": \"cors\",\n            \"headers\": headers\n        };\n\n        const handler = (resolve, reject) => {\n\n            fetch(url, init)\n                .then(response => response.json())\n                .then(responseJSON => responseJSON.status === \"success\"\n                    ? resolve(responseJSON)\n                    : reject(responseJSON))\n                .catch(err => reject(err));\n\n        };\n\n        return new Promise(handler);\n\n    }\n\n\n    /**\n     * Fetches all inputs to a given session\n     *\n     * @param {Number} sessionID id of session to which inputs will be fetched.\n     * @returns {Promise<Object>} promise that resolves to object containing session info and inputs;\n     */\n    static fetchInputs(sessionID) {\n\n        const url = `/api/session/${sessionID}`;\n\n        const handler = (resolve, reject) => {\n\n            // TODO: un-stringify timestamp when returning inputs\n            fetch(url)\n                .then(response => response.json())\n                .then(responseJSON => responseJSON.status === \"success\"\n                    ? resolve(responseJSON)\n                    : reject(responseJSON))\n                .catch(err => reject(err));\n\n        };\n\n        return new Promise(handler);\n\n    }\n\n    /**\n     * POSTs answers to feedback form properly encoded for the SQLite database.\n     * @param {Object} responseObject state object in FormOverlay.js\n     * @returns {Promise} promise that resolves into response json\n     */\n    static submitFeedback(responseObject) {\n\n        const url = \"/api/submit-feedback\";\n        const init = {\n            \"method\": \"POST\",\n            \"headers\": {\n                \"Content-Type\": \"application/json\"\n            },\n            \"body\": JSON.stringify(responseObject)\n        };\n\n        return fetch(url, init)\n            .then(response => response.json());\n\n    }\n\n}\n\nexport default APIService;\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport \"../../css/hud/GameSession.css\";\n\nconst GameSession = props => {\n\n    const {\n        sessionObject,\n        songObject,\n        rank,\n        header,\n        onReplayRequest\n    } = props;\n\n    // prop check\n    if (!header && (!songObject || !sessionObject)) throw new Error(`Missing ${!songObject ? \"song object\" : \"session object\"}.`);\n\n    const color = rank % 2 ? \"tr-dark\" : \"tr-light\";\n\n    // position, score, userPic, userName, songAlbum, playedSong\n    if (header) return <tr className={color}>\n        <th className=\"header-rank\">Rank</th>\n        <th className=\"header-score\" colSpan={1}>Score</th>\n        <th className=\"header-display-name\" colSpan={2}>Player</th>\n        <th className=\"header-song-name\" colSpan={3}>Song</th>\n    </tr>;\n\n    return <tr className={color}>\n        <td className=\"session-rank\">{rank}</td>\n        <td className=\"session-score\">{sessionObject.score}</td>\n        <td className=\"session-profile-picture\"><img src={sessionObject.profilePicture} alt={`${sessionObject.displayName}'s profile picture`}/></td>\n        <td className=\"session-display-name\">{sessionObject.displayName}</td>\n        <td className=\"session-album-cover\"><img src={songObject.img} alt={`Album cover for song: ${songObject.name}`}/></td>\n        <td className=\"session-song-name\">{songObject.name}</td>\n        <td className=\"session-replay-button\"><button onClick={onReplayRequest}>View Replay</button></td>\n    </tr>;\n\n};\n\nGameSession.defaultProps = {\n    // eslint-disable-next-line multiline-comment-style\n    // \"sessionObject\": {\n    //     \"sessionID\": -1,\n    //     \"displayName\": \"Leo Gonsalves\",\n    //     \"profilePicture\": \"https://profile-images.scdn.co/images/userprofile/default/eb6e342aca9e0f0e82fc48fc5431e33ddc6f79b5\",\n    //     \"score\": 54003323124,\n    //     \"gameVersion\": \"0.1.0\"\n    // },\n    // \"songObject\": {\n    //     \"songID\": \"2mDYYGaGd9uXKkK2YhDA3i\",\n    //     \"name\": \"Brooklyn Bridge To Chorus\",\n    //     \"imgUrl\": \"https://i.scdn.co/image/ab67616d0000b273bfa99afb5ef0d26d5064b23b\"\n    // },\n    // \"rank\": 0,\n    \"header\": false\n};\n\nGameSession.propTypes = {\n    \"sessionObject\": PropTypes.shape({\n        \"sessionID\": PropTypes.number.isRequired,\n        \"displayName\": PropTypes.string.isRequired,\n        \"profilePicture\": PropTypes.string.isRequired,\n        \"score\": PropTypes.number.isRequired,\n        \"gameVersion\": PropTypes.string.isRequired\n    }),\n    \"songObject\": PropTypes.shape({\n        \"id\": PropTypes.string.isRequired,\n        \"name\": PropTypes.string.isRequired,\n        \"img\": PropTypes.string.isRequired\n    }),\n    \"rank\": PropTypes.number,\n    \"header\": PropTypes.bool,\n    \"onReplayRequest\": PropTypes.func\n};\n\nexport default GameSession;\n","import React, {Component} from \"react\";\nimport PropTypes from \"prop-types\";\nimport GameSession from \"../../components/hud/GameSession\";\nimport \"../../css/HUDLeaderboardsMenu.css\";\nimport SpotifyService from \"../../utils/SpotifyService\";\nimport APIService from \"../../utils/APIService\";\nimport HUDButton, {HUDButtonTypesEnum} from \"../../components/hud/HUDButton\";\n\nclass HUDLeaderboardsMenu extends Component {\n\n    constructor(props) {\n        super(props);\n\n        this.state = {\n            \"sessions\": []\n        };\n\n        // bind state-affecting functions\n        this.makeComplexSession = this.makeComplexSession.bind(this);\n    }\n\n    componentDidMount() {\n\n        APIService.fetchLeaderboard()\n            .then(({sessions}) => sessions.forEach((session, index) => {\n                this.makeComplexSession(session, index);\n            }));\n\n    }\n\n    /**\n     * Fetches additional song and user information and adds session to the state.\n     */\n    makeComplexSession(session, index) {\n\n        const {\n            spotifyService\n        } = this.props;\n\n        const {\n            sessionID,\n            userID,\n            score,\n            songID,\n            gameVersion\n        } = session;\n\n        // fetch display name + picture of user\n        const userInfoPromise = spotifyService.getUserInfo(userID);\n\n        // fetch song name and album cover\n        const songInfoPromise = spotifyService.getSongInfo(songID);\n\n        // promise.all it and resolve it into a song object, session object, and rank.\n        Promise.all([userInfoPromise, songInfoPromise])\n            .then(([userObject, songObject]) => {\n                const output = {\n                    \"rank\": index + 1,\n                    \"sessionObject\": {\n                        sessionID,\n                        \"displayName\": userObject.displayName,\n                        \"profilePicture\": userObject.imageUrl,\n                        score,\n                        gameVersion\n                    },\n                    songObject\n                };\n\n                this.setState(oldState => ({\n                    \"sessions\": [\n                        ...oldState.sessions,\n                        output\n                    ]\n                }));\n            });\n\n    }\n\n    /**\n     * Fetches input history and calls prop function for handling outside this scope.\n     */\n    handleReplayRequest(songObject, sessionID) {\n\n        APIService.fetchInputs(sessionID)\n            .then(({inputs}) => {\n\n                this.props.onReplayRequest(songObject, inputs);\n\n            });\n\n    }\n\n    render() {\n        return <div>\n            <div className=\"leaderboards-wrapper\">\n                <table>\n                    <tbody>\n                    <GameSession header={true} />\n                    {\n                        this.state.sessions\n                            .filter(session => session.rank)\n                            .map(session => <GameSession\n                                                key={session.rank}\n                                                rank={session.rank}\n                                                sessionObject={session.sessionObject}\n                                                songObject={session.songObject}\n                                                onReplayRequest={() => this.handleReplayRequest(session.songObject, session.sessionObject.sessionID)}\n                                            />)\n                    }\n                    </tbody>\n                </table>\n            </div>\n            <HUDButton type={HUDButtonTypesEnum.RETURN} text={\"<\"} onClick={this.props.onReturn} />\n        </div>;\n    }\n\n}\n\nHUDLeaderboardsMenu.propTypes = {\n    \"spotifyService\": PropTypes.instanceOf(SpotifyService).isRequired,\n    \"onReturn\": PropTypes.func.isRequired,\n    \"onReplayRequest\": PropTypes.func.isRequired\n};\n\nexport default HUDLeaderboardsMenu;\n","import React, {Component} from \"react\";\nimport PropTypes from \"prop-types\";\nimport {Subject} from \"rxjs\";\nimport {GameStateEnums, GameStateController} from \"tune-mountain-input-manager\";\n\nimport HUDSongSearchMenu from \"../pages/hud/HUDSongSearchMenu\";\nimport HUDMainMenu from \"../pages/hud/HUDMainMenu\";\nimport HUDSongProgress from \"../components/hud/HUDSongProgress\";\nimport HUDButton, {HUDButtonTypesEnum} from \"../components/hud/HUDButton\";\nimport FadeTransition from \"../components/transition/FadeTransition\";\nimport {Transition} from \"./TransitionUtils\";\nimport SlideTransition from \"../components/transition/SlideTransition\";\nimport HUDSongSelectMenu from \"../pages/hud/HUDSongSelectMenu\";\nimport dotProp from \"dot-prop\";\nimport FormOverlay from \"../components/FormOverlay\";\nimport PauseOverlay from \"../components/hud/PauseOverlay\";\nimport SpotifyService from \"./SpotifyService\";\nimport MessageOverlay from \"../components/MessageOverlay\";\nimport LoadingOverlay from \"../components/hud/LoadingOverlay\";\nimport APIService from \"./APIService\";\nimport HUDLeaderboardsMenu from \"../pages/hud/HUDLeaderboardsMenu\";\n\n/* eslint brace-style: 0 */\n/* eslint max-lines: 0 */\n\n/**\n * Utility responsible for unifying and managing all HUD menus and components properly.\n * Should be initialized with reference to the page that will be rendering the error and menu overlay.\n */\nclass HUDOverlayManager extends Component {\n\n    constructor(props) {\n        super(props);\n\n        // will initialize the menu stack with main menu assuming login has been performed\n        this.state = {\n            \"selectedSong\": null,\n            \"playing\": false,\n            \"playbackPosition\": 0,\n            \"score\": 0,\n            \"multiplier\": 1,\n            \"displayCompletionForm\": false,\n            \"displayPauseOverlay\": false,\n            \"displayLoadingOverlay\": false,\n            \"mountLoadingOverlay\": false,\n            \"displayWelcomeOverlay\": false,\n            \"displayNewPlayerOverlay\": false,\n            \"displayError\": false,\n            \"replayMode\": false,\n            \"menuStack\": []\n        };\n\n        this.mainMenuTransitionController = null;\n\n        // handle request for song to be played\n        props.gameStateController.onNotificationOf(GameStateEnums.PLAY, () => {\n            // only proceed if selected song exists\n            if (this.state.selectedSong) {\n\n                // begin taking inputs or sending stream of inputs\n                if (this.state.replayMode) {\n                    this.props.onReplayPlaybackStart();\n                } else {\n                    this.props.onGameStart();\n                }\n\n                // begin playback of song\n                this.props.spotifyService.play(this.state.selectedSong.id);\n\n                this.setState({\n                    \"playing\": true,\n                    \"displayLoadingOverlay\": false,\n                    \"displayPauseOverlay\": true\n                });\n            }\n        });\n\n        props.gameStateController.onNotificationOf(\n                GameStateEnums.SCORE_CHANGED,\n            ({body}) => this.setState({\n                \"score\": body.score,\n                \"multiplier\": body.multiplier\n            })\n        );\n\n        // handle spotify player change reactively\n        props.spotifyService.stateNotifier\n            .filter(stateLog => stateLog.state === \"PLAYER_STATE_CHANGED\")\n            .subscribe(stateLog => this.readAndUpdateState(stateLog.body));\n\n        // id for timer that checks player id\n        this.playerStateUpdaterIntervalID = null;\n\n        // binding functions\n        this.mountSongSearchMenu = this.mountSongSearchMenu.bind(this);\n        this.mountSongSelectMenu = this.mountSongSelectMenu.bind(this);\n        this.popMenu = this.popMenu.bind(this);\n        this.mainMenu = this.mainMenu.bind(this);\n        this.updatePlaybackState = this.updatePlaybackState.bind(this);\n        this.renderOverlay = this.renderOverlay.bind(this);\n    }\n\n    /**\n     * Callback for reading and updating the state of Spotify Web Player\n     * @param {Object} stateObj output of Spotify Web Playback SDK player\n     * @returns {void}\n     */\n    readAndUpdateState (stateObj) {\n\n            const givenId = dotProp.get(stateObj, \"track_window.current_track.id\");\n            const currentId = dotProp.get(this.state, \"selectedSong.id\");\n            const paused = dotProp.get(stateObj, \"paused\");\n            const position = dotProp.get(stateObj, \"position\");\n\n            /*\n             * case 1: selected song is different --\n             *      emit idle state to game\n             *      go back to Main menu\n             *      pause song ?\n             */\n            if (givenId !== currentId) {\n\n                // only handle mistaken change of state if completion form is not up\n                if (!this.state.displayCompletionForm) {\n\n                    this.props.gameStateController.request(\n                        GameStateEnums.IDLE,\n                        {\"reason\": \"Outside forces changed the song.\"}\n                    );\n\n                    this.mainMenu();\n\n                    // interrupt input collection or cancel replay\n                    if (this.state.replayMode) this.props.onReplayInterruptRequest();\n                    else this.props.onGameInterrupted();\n\n                    this.setState({\n                        \"playing\": false,\n                        \"displayPauseOverlay\": false,\n                        \"replayMode\": false\n                    });\n\n                    Transition.in(this.mainMenuTransitionController);\n\n                    // make sure user cannot force Spotify Player to play any tracks\n                    this.props.spotifyService.deactivate();\n\n                    // so no useless updates are made\n                    this.terminatePlaybackStateUpdater();\n\n                }\n\n            }\n\n            /*\n             * case 2: it's paused --\n             *      emit pause state to game\n             *      if the current context is *replay* terminate session\n             */\n            else if (paused) {\n\n                if (this.state.replayMode) {\n                    // interrupt IM\n                    this.props.onReplayInterruptRequest();\n\n                    // make sure user cannot force Spotify Player to play any tracks\n                    this.props.spotifyService.deactivate();\n\n                    this.setState({\n                        \"playing\": false,\n                        \"displayPauseOverlay\": false,\n                        \"displayCompletionForm\": false\n                    });\n\n                    this.mainMenu(true);\n\n                } else if (position === 0) {\n\n                    this.props.gameStateController.request(\n                        GameStateEnums.IDLE,\n                        {\"reason\": \"end\"}\n                    );\n\n                    this.setState({\n                        \"playing\": false,\n                        \"displayPauseOverlay\": false,\n                        \"displayCompletionForm\": true\n                    });\n\n                    // stop player so external inputs can't begin playback\n                    this.props.spotifyService.deactivate();\n\n                    // signal that game is over and inputs should stop being recorded, and then be stored\n                    this.props.onGameFinish(this.state.score, this.state.selectedSong.id);\n\n\n                } else {\n\n                    this.props.gameStateController.request(\n                        GameStateEnums.PAUSE,\n                        {\"reason\": \"paused\"}\n                    );\n\n                    this.setState({\n                        \"playing\": false,\n                        \"playbackPosition\": position\n                    });\n\n                    // pause input collection\n                    this.props.onGamePause();\n\n\n                }\n\n                // so no useless updates are made\n                this.terminatePlaybackStateUpdater();\n\n            }\n\n            /*\n             * case 3: it's all the same\n             *      update position\n             */\n            else {\n\n                // send play state if was previously paused\n                if (!this.state.playing) {\n                    this.props.gameStateController\n                        .request(GameStateEnums.PLAY, {\"reason\": \"unpaused\"});\n                }\n\n                // this means it's not paused too\n                this.initPlaybackStateUpdater();\n\n                this.setState({\n                    \"playing\": true,\n                    \"playbackPosition\": position\n                });\n\n                // resume inputs\n\n\n            }\n\n        }\n\n    componentDidMount() {\n\n        // initialize transition observable\n        const transitionObservable = new Subject();\n\n        const handleSongSelectRequest = () => {\n            // first transition main menu out\n            Transition.out(transitionObservable);\n\n            // transition song search menu in\n            this.mountSongSearchMenu(transitionObservable);\n        };\n        const handleLeaderboardsRequest = () => {\n            // first transition main menu out\n            Transition.out(transitionObservable);\n\n            // transition song search menu in\n            this.mountLeaderboardsPage(transitionObservable);\n        };\n\n        this.mainMenuTransitionController = transitionObservable;\n\n        // now that all is well and mounted, update menu stack with appropriate components\n        this.setState({\n            \"menuStack\": [\n                <FadeTransition\n                    transitionRequestObservable={transitionObservable}\n                    key={0}\n                >\n                    <HUDMainMenu\n                        hasLoggedIn={true}\n                        onSongSelectRequest={handleSongSelectRequest}\n                        onLeaderboardsPageRequest={handleLeaderboardsRequest}\n                    />\n                </FadeTransition>\n            ]\n        });\n\n        // show welcome in a couple seconds if appropriate\n        if (!localStorage.getItem(\"welcome\")) setTimeout(() => {\n            // set state if never accessed\n            this.setState({\n                \"displayWelcomeOverlay\": true\n            });\n\n            // set welcome to true\n            localStorage.setItem(\"welcome\", \"true\");\n\n        }, 1500);\n\n    }\n\n    /**\n     * Checks Spotify Web Player state to determine current playback\n     * position to update UI.\n     *\n     * WARNING: expensive operation.\n     * @returns {void}\n     */\n    updatePlaybackState() {\n        const spotifyPlayerState = this.props.spotifyService.playerState;\n\n        if (spotifyPlayerState) {\n            spotifyPlayerState.then(playerState => {\n                if (!playerState) {\n\n                    console.error(\"User is not playing music through the Web Playback SDK\");\n\n                    return;\n\n                }\n\n                const {\n                    position,\n                    paused\n                } = playerState;\n\n                this.setState({\n                    \"playbackPosition\": position,\n                    \"playing\": !paused\n                });\n\n            });\n        }\n    }\n\n    // to be run once player starts song. sets up a timer that checks playback state every second\n    initPlaybackStateUpdater() {\n\n        // clear just in case\n        this.terminatePlaybackStateUpdater();\n\n        this.playerStateUpdaterIntervalID = setInterval(this.updatePlaybackState, 3000);\n\n    }\n\n    // terminates timer for checking state (to be run if song is paused)\n    terminatePlaybackStateUpdater() {\n\n        clearInterval(this.playerStateUpdaterIntervalID);\n\n    }\n\n    // mounts leaderboards page and sets up hooks to change HUDOverlayManager state to replay\n    mountLeaderboardsPage(prevScreenTransitionObservable) {\n\n        // todo: mount leaderboards menu\n\n        // todo: hook function calls to fetch replays\n\n        // todo: hook state update to change state to replay\n\n        // initialize transition observable\n        const transitionObservable = new Subject();\n\n        const handleReturn = () => {\n            // Transition.out(transitionObservable);\n            this.popMenu();\n            Transition.in(prevScreenTransitionObservable);\n        };\n\n        const handleReplayRequest = (songObject, inputHistory) => {\n\n            this.initPlaybackStateUpdater();\n\n            // tells app to load input history\n            this.props.onReplayBeginRequest(inputHistory);\n\n            this.setState({\n                \"selectedSong\": songObject,\n                \"displayLoadingOverlay\": true,\n                \"mountLoadingOverlay\": true,\n                \"replayMode\": true\n            });\n\n            // Transition.out(transitionObservable);\n\n            // get audio features, emit them to game\n            this.props.spotifyService\n                .getAudioAnalysisAndFeatures(\n                    songObject.id,\n                    object => {\n                        // log\n                        console.log(\"Features and analysis: \", object);\n\n                        // emit data to game\n                        this.props.gameStateController.request(GameStateEnums.GENERATE, object);\n\n                    }\n                );\n\n            // connect to player\n            this.props.spotifyService.activate();\n\n            // remove all screens but main menu, but don't show it\n            this.mainMenu();\n        };\n\n        // initialize jsx object\n        const songSearchMenu =\n            <SlideTransition\n                transitionRequestObservable={transitionObservable}\n                key={1}\n            >\n                <HUDLeaderboardsMenu\n                    spotifyService={this.props.spotifyService}\n                    onReturn={handleReturn}\n                    onReplayRequest={handleReplayRequest}\n                />\n            </SlideTransition>;\n\n        // mount\n        this.setState(oldState => ({\n            \"menuStack\": [\n                ...oldState.menuStack,\n                songSearchMenu\n            ]\n        }));\n\n    }\n\n    // mounts menu off screen and transitions both menus appropriately\n    mountSongSearchMenu(prevScreenTransitionObservable) {\n\n        // initialize transition observable\n        const transitionObservable = new Subject();\n\n        const handleSongSelect = songObject => {\n            Transition.out(transitionObservable);\n            this.mountSongSelectMenu(songObject, transitionObservable);\n        };\n\n        const handleReturn = () => {\n            // Transition.out(transitionObservable);\n            this.popMenu();\n            Transition.in(prevScreenTransitionObservable);\n        };\n\n        // initialize jsx object\n        const songSearchMenu =\n            <SlideTransition\n                transitionRequestObservable={transitionObservable}\n                key={1}\n            >\n                <HUDSongSearchMenu\n                    spotifyService={this.props.spotifyService}\n                    selectSong={handleSongSelect}\n                    onReturn={handleReturn}\n                />\n            </SlideTransition>;\n\n        // mount\n        this.setState(oldState => ({\n            \"menuStack\": [\n                ...oldState.menuStack,\n                songSearchMenu\n            ]\n        }));\n\n    }\n\n    // mounts song select\n    mountSongSelectMenu(songObject, prevScreenTransitionObservable) {\n\n        // update state to contain selected song.\n        this.setState({\n            \"selectedSong\": songObject\n        });\n\n        // initialize transition observable\n        const transitionObservable = new Subject();\n\n        const handleConfirmation = () => {\n            this.initPlaybackStateUpdater();\n\n            this.setState({\n                \"displayLoadingOverlay\": true,\n                \"mountLoadingOverlay\": true,\n                \"replayMode\": false\n            });\n\n            Transition.out(transitionObservable);\n            // get audio features, emit them to game\n            this.props.spotifyService\n                .getAudioAnalysisAndFeatures(\n                    songObject.id,\n                        object => {\n                            // log\n                            console.log(\"Features and analysis: \", object);\n\n                            // emit data to game\n                            this.props.gameStateController.request(GameStateEnums.GENERATE, object);\n\n                        }\n                );\n\n            // connect to player\n            this.props.spotifyService.activate();\n\n            this.mainMenu();\n        };\n\n        const handleReturn = () => {\n            // Transition.out(transitionObservable);\n            this.popMenu();\n            Transition.in(prevScreenTransitionObservable);\n        };\n\n        // initialize jsx object\n        const songSearchMenu =\n            <SlideTransition\n                transitionRequestObservable={transitionObservable}\n                key={2}\n            >\n                <HUDSongSelectMenu\n                    songObject={songObject}\n                    onConfirmation={handleConfirmation}\n                    onReturn={handleReturn}\n                />\n            </SlideTransition>;\n\n        // mount\n        this.setState(oldState => ({\n            \"menuStack\": [\n                ...oldState.menuStack,\n                songSearchMenu\n            ]\n        }));\n\n    }\n\n    // unmounts top screen\n    popMenu() {\n        this.setState(oldState => {\n\n            const oldStack = oldState.menuStack;\n            oldStack.pop();\n\n            return {\"menuStack\": [...oldStack]};\n\n        });\n    }\n\n    // unmounts all menus except first\n    mainMenu(show = false) {\n        // todo: remove this once Game properly accounts for its pointers\n        // eslint-disable-next-line\n        if (show) location.reload();\n\n        // eslint-disable-next-line no-unused-vars\n        const showMenu = show ? Transition.in(this.mainMenuTransitionController) : null;\n\n        this.setState(oldState => ({\"menuStack\": [oldState.menuStack[0]]}));\n    }\n\n    // wraps overlay rendering logic\n    renderOverlay() {\n        const {\n            displayCompletionForm,\n            displayPauseOverlay,\n            displayError,\n            displayWelcomeOverlay,\n            replayMode\n        } = this.state;\n\n        const {spotifyService} = this.props;\n\n        // toggles playback twice because the SDK is hella glitchy\n        const handlePause = () => {\n            spotifyService.toggle()\n                .then(() => spotifyService.toggle());\n\n        };\n\n        // toggles playback\n        const handleResume = () => {\n            spotifyService.toggle();\n        };\n\n        /*\n         * todo: create replay overlay\n         * todo: account for replay state to avoid pauses as well as completion form\n         */\n\n        // prioritize error screen\n        if (displayError) return null;\n        else if (!replayMode && displayCompletionForm) return <FormOverlay\n            zIndex={this.state.menuStack.length}\n            onSubmit={respObj => {\n                APIService.submitFeedback({...respObj,\n                    \"songID\": dotProp.get(this.state, \"selectedSong.id\")})\n                    .then(() => {\n                        this.mainMenu(true);\n                        this.setState({\n                            \"displayCompletionForm\": false\n                        });\n                    })\n                    .catch(err => console.error(err));\n            }}\n            onCancel={() => {\n                this.mainMenu(true);\n                this.setState({\n                    \"displayCompletionForm\": false\n                });\n            }}\n        />;\n        // callbacks\n        else if (!replayMode && displayPauseOverlay) return <PauseOverlay\n            isPlaying={this.state.playing}\n            onPause={handlePause}\n            onResume={handleResume}\n        />;\n        else if (replayMode && displayPauseOverlay) return <HUDButton\n            onClick={handleResume}\n            className={\"play-pause-btn\"}\n            text=\"Cancel\"\n            style={{\n                \"zIndex\": 10,\n                \"top\": \"1vh\",\n                \"right\": \"2vh\"\n            }}\n        />;\n        else if (displayWelcomeOverlay) return <MessageOverlay\n            buttonText=\"Let's Go!\"\n            onButtonClick={() => this.setState({\"displayWelcomeOverlay\": false})}\n            title=\"Welcome to Tune Mountain!\"\n            subtitle=\"An audio-visualizer by Léo, Cem, Jarod, and Peter\"\n        >\n            <p>Welcome to Tune Mountain. To play this game <strong>you need</strong> a Spotify premium account, so we could play the song of your choosing. After you log in click <strong>Select Song</strong> to choose any song from Spotify*, and the game will generate a unique mountain experience for you to snowboard down on. </p>\n            <p>Game controls can be viewed on the pause menu.</p>\n            <p>*The song has to go through the spotify audio feature analysis, so not every song might be available.</p>\n        </MessageOverlay>;\n        // callbacks for fading it out\n\n        return null;\n    }\n\n    // logic for rendering loading overlay\n    renderLoadingOverlay() {\n\n        const {\n            displayLoadingOverlay,\n            mountLoadingOverlay\n        } = this.state;\n\n        const observable = new Subject();\n\n        if (displayLoadingOverlay && mountLoadingOverlay) {\n\n            return <LoadingOverlay\n                transitionObservable={observable}\n                onUnmount={() => this.setState({\n                    \"mountLoadingOverlay\": false\n                })}\n            />;\n\n        }\n\n        return null;\n\n\n    }\n\n    render() {\n\n        // if user has not logged in yet, display incomplete main menu as the only object on screen\n        const mainComponent = () => {\n            if (!this.props.hasLoggedIn) {\n\n                // initialize transition observable\n                const transitionObservable = new Subject();\n\n                /*\n                 * TODO: assign appropriate fadeout handlers according to button press\n                 * let fadeOutHandler = () => console.log(\"Fade out handler not set for main menu.\");\n                 */\n                const onMount = () => Transition.in(transitionObservable);\n\n                return (\n                    <div>\n                        <FadeTransition\n                            transitionRequestObservable={transitionObservable}\n                            // onEndTransitionOut={fadeOutHandler}\n                            onMount={onMount}\n                        >\n                            <HUDMainMenu\n                                onLoginRequest={this.props.spotifyService.login}\n                                hasLoggedIn={false}\n                            />\n                        </FadeTransition>\n                    </div>\n                );\n\n            }\n\n        return this.state.menuStack;\n\n        };\n\n        // render song progress component\n        const progBar = <HUDSongProgress\n            songObject={this.state.selectedSong}\n            positionInMilliseconds={this.state.playbackPosition}\n            shouldDisplay={this.state.playing}\n            score={this.state.score}\n            multiplier={this.state.multiplier}\n            replayMode={this.state.replayMode}\n        />;\n\n        return(\n            <div>\n                {progBar}\n                {this.state.errorComponent}\n                {this.renderLoadingOverlay()}\n                {this.renderOverlay()}\n                {mainComponent()}\n            </div>\n        );\n    }\n\n}\n\n// make both spotify and state controller required\nHUDOverlayManager.propTypes = {\n    \"gameStateController\": PropTypes.instanceOf(GameStateController).isRequired,\n    \"spotifyService\": PropTypes.instanceOf(SpotifyService).isRequired,\n    \"user\": PropTypes.shape({\n        \"imageUrl\": PropTypes.string.isRequired,\n        \"displayName\": PropTypes.string.isRequired,\n        \"spotifyID\": PropTypes.string.isRequired\n    }).isRequired,\n    \"hasLoggedIn\": PropTypes.bool,\n    \"onGamePause\": PropTypes.func.isRequired,\n    \"onGameResume\": PropTypes.func.isRequired,\n    \"onGameStart\": PropTypes.func.isRequired,\n    \"onGameFinish\": PropTypes.func.isRequired,\n    \"onGameInterrupted\": PropTypes.func.isRequired,\n    \"onReplayBeginRequest\": PropTypes.func.isRequired,\n    \"onReplayPlaybackStart\": PropTypes.func.isRequired,\n    \"onReplayInterruptRequest\": PropTypes.func.isRequired\n};\n\n// do not run game if hasLoggedIn is not passed in\nHUDOverlayManager.defaultProps = {\n    \"hasLoggedIn\": false,\n    \"user\": {\n        \"displayName\": null,\n        \"imageUrl\": null,\n        \"spotifyID\": null\n    }\n};\n\nexport default HUDOverlayManager;\n","import React, {Component} from \"react\";\nimport SpotifyService from \"../utils/SpotifyService\";\nimport HUDOverlayManager from \"../utils/HUDOverlayManager\";\nimport APIService from \"../utils/APIService\";\nimport Game from \"tune-mountain-game\";\nimport {GameStateController, InputManager} from \"tune-mountain-input-manager\";\nimport \"../css/App.css\";\n\nconst APP_NAME = \"Tune Mountain\";\n\nclass App extends Component {\n\n\tconstructor(props) {\n\n\t\tsuper(props);\n\n\t\tconst spotifyService = new SpotifyService(`${APP_NAME} Web Player`);\n\t\tconst hasLoggedIn = false;\n\n\t\tspotifyService.stateNotifier.subscribe(state => console.log(state));\n\t\tspotifyService.stateNotifier\n\t\t\t.filter(notification => notification.state === \"LOGGED_IN\")\n\t\t\t.subscribe(() => {\n\t\t\t\tspotifyService.getUserInfo()\n\t\t\t\t\t.then(userObj => {\n\t\t\t\t\t\t// add user to database if doesn't exist\n\t\t\t\t\t\tAPIService.checkInUser(userObj.spotifyID, userObj.displayName, userObj.imageUrl);\n\n\t\t\t\t\t\t// update state\n\t\t\t\t\t\tthis.setState({\n\t\t\t\t\t\t\t\"hasLoggedIn\": true,\n\t\t\t\t\t\t\t\"user\": userObj\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t});\n\n\t\t// init player when sdk is ready\n\t\tthis.spotifyService = spotifyService;\n\n\t\t// api service\n\t\tthis.apiService = new APIService();\n\n\t\t// game components\n\t\tthis.canvasReference = React.createRef();\n\n\t\t// will be initialized once component mounts\n\t\tthis.game = null;\n\t\tthis.gameStateController = new GameStateController();\n\t\tthis.inputManager = null;\n\n\t\tthis.state = {\n\t\t\thasLoggedIn,\n\t\t\t\"gameVersion\": process.env.REACT_APP_VERSION\n\t\t};\n\n\t\tthis.handleGameFinish = this.handleGameFinish.bind(this);\n\t\tthis.handleGameInterrupt = this.handleGameInterrupt.bind(this);\n\t\tthis.handleGamePause = this.handleGamePause.bind(this);\n\t\tthis.handleGameResume = this.handleGameResume.bind(this);\n\t\tthis.handleGameStart = this.handleGameStart.bind(this);\n\t\tthis.handleReplayBeginRequest = this.handleReplayBeginRequest.bind(this);\n\t\tthis.handleReplayInterruptRequest = this.handleReplayInterruptRequest.bind(this);\n\t\tthis.handleReplayPlaybackStart = this.handleReplayPlaybackStart.bind(this);\n\n\t}\n\n\tcomponentDidMount() {\n\n\t\tthis.inputManager = new InputManager();\n\n\t\t// initialize game once component is mounted\n\t\tthis.game = new Game(this.gameStateController, this.canvasReference.current, this.inputManager);\n\n\t}\n\n\t/**\n\t * Begins recording inputs in input manager.\n\t */\n\thandleGameStart() {\n\n\t\t// begins recording\n\t\tthis.inputManager.startSession();\n\n\t}\n\n\t/**\n\t *  Pauses recording of inputs.\n\t */\n\thandleGamePause() {\n\n\t\t// pauses recording\n\t\tthis.inputManager.pauseSession();\n\n\t}\n\n\t/**\n\t * Resumes input gathering.\n\t */\n\thandleGameResume() {\n\n\t\t// resumes\n\t\tthis.inputManager.resumeSession();\n\n\t}\n\n\t/**\n\t * Stops recording inputs, extracts them, stores inputs and session, resets input manager history.\n\t */\n\thandleGameFinish(score, songID) {\n\n\t\t// stops recording and returns input history\n\t\tconst inputHistory = this.inputManager.terminateSession();\n\n\t\t// input history will be null if it's been terminated already (sometimes the Spotify SDK duplicates the event that triggers this)\n\t\tif (inputHistory) {\n\n\t\t\tconst session = {\n\t\t\t\tsongID,\n\t\t\t\tscore,\n\t\t\t\t\"userID\": this.state.user.spotifyID,\n\t\t\t\t\"gameVersion\": this.state.gameVersion\n\t\t\t};\n\n\t\t\tconsole.log(session, inputHistory);\n\n\t\t\tAPIService.saveGameSession(session, inputHistory)\n\t\t\t\t.then(console.log);\n\n\t\t}\n\n\t}\n\n\t/**\n\t *  Stops recording inputs, resets history. Does not save session or inputs.\n\t */\n\thandleGameInterrupt() {\n\n\t\t// stops recording\n\t\tconsole.log(\"Wrong termination\", this.inputManager.terminateSession());\n\n\t}\n\n\t/**\n\t * Receives input history and loads it in the input manager\n\t */\n\thandleReplayBeginRequest(inputHistory) {\n\n\t\tthis.inputManager.loadInputsForReplay(inputHistory);\n\n\t}\n\n\t/**\n\t * Terminates replay session in input manager and restores it to regular emission state.\n\t */\n\thandleReplayInterruptRequest() {\n\n\t\tthis.inputManager.terminateReplaySession();\n\n\t}\n\n\t/**\n\t * Notifies input manager to begin replay.\n\t */\n\thandleReplayPlaybackStart() {\n\n\t\tthis.inputManager.beginReplaySession();\n\n\t}\n\n\trender() {\n\n\t\treturn(\n\t\t\t<div>\n\t\t\t\t<canvas\n\t\t\t\t\tref={this.canvasReference}\n\t\t\t\t\tclassName={\"game-viewport\"}\n\t\t\t\t\twidth={window.innerWidth}\n\t\t\t\t\theight={window.innerHeight}\n\t\t\t\t/>\n\t\t\t\t<HUDOverlayManager\n\t\t\t\t\tspotifyService={this.spotifyService}\n\t\t\t\t\thasLoggedIn={this.state.hasLoggedIn}\n\t\t\t\t\tgameStateController={this.gameStateController}\n\t\t\t\t\tuser={this.state.user}\n\t\t\t\t\tonGameFinish={this.handleGameFinish}\n\t\t\t\t\tonGameInterrupted={this.handleGameInterrupt}\n\t\t\t\t\tonGamePause={this.handleGamePause}\n\t\t\t\t\tonGameStart={this.handleGameStart}\n\t\t\t\t\tonGameResume={this.handleGameResume}\n\t\t\t\t \tonReplayBeginRequest={this.handleReplayBeginRequest}\n\t\t\t\t \tonReplayInterruptRequest={this.handleReplayInterruptRequest}\n\t\t\t\t \tonReplayPlaybackStart={this.handleReplayPlaybackStart}\n\t\t\t\t/>\n\t\t\t\t<p id=\"version\">Ver {this.state.gameVersion}</p>\n\t\t\t</div>\n\t\t);\n\n\t}\n\n}\n\nexport default App;\n","import React from \"react\";\r\nimport App from \"./pages/App\";\r\nimport ReactDOM from \"react-dom\";\r\nimport \"./index.css\";\r\n\r\nReactDOM.render(<App />, document.getElementById(\"root\"));\r\n"],"sourceRoot":""}