{"version":3,"sources":["img/pause.png","img/play.png","utils/SpotifyServiceTools.js","utils/SpotifyService.js","components/hud/HUDButton.js","utils/StringTools.js","components/hud/HUDSearchBar.js","components/hud/SpotifySong.js","pages/hud/HUDSongSearchMenu.js","pages/hud/HUDMainMenu.js","components/hud/HUDSongProgress.js","utils/TransitionUtils.js","components/transition/GenericTransitionWrapper.js","components/transition/FadeTransition.js","components/transition/SlideTransition.js","pages/hud/HUDSongSelectMenu.js","components/FormOverlay.js","components/hud/PauseOverlay.js","utils/HUDOverlayManager.js","utils/APIService.js","pages/App.js","index.js"],"names":["module","exports","log","state","body","message","notifier","notification","next","console","getTokensFromQuery","urlParams","URLSearchParams","window","location","search","accessToken","get","refreshToken","SpotifyService","spotifyPlayerName","$cdn","Rx","BehaviorSubject","$sdk","$token","$spotifyServiceStateNotifier","ReplaySubject","combineLatest","cdnLoaded","sdkLoaded","tokenLoaded","filter","isAllLoaded","subscribe","player","Player","Spotify","callback","connect","addListener","device_id","webPlaybackStateObject","initPlayer","refreshTokenFunction","stateNotifier","queryTokens","localStorage","setItem","localStorageRefreshToken","getItem","then","json","processTokens","this","getNewAccessToken","notif","newState","name","spotifyStateNotifier","fromCDN","onSpotifyWebPlaybackSDKReady","pause","bind","resume","toggle","disconnect","tokenToBeUsed","fetch","response","catch","error","togglePlay","songID","uri","Error","play","spotifyURI","getOAuthToken","id","access_token","details","JSON","stringify","searchQueryString","index","type","limit","url","header","err","analysisURL","featuresURL","analysis","features","analysisObject","featuresObject","Promise","resolve","reject","res","resJSON","display_name","images","getCurrentState","HUDButtonTypesEnum","Object","freeze","TypeToClassMap","TypeToStyleMap","HUDButton","props","btnRef","React","createRef","text","onClick","style","children","className","isHovering","filteredType","Boolean","SMALL","onMouseEnter","setState","onMouseLeave","ref","event","current","blur","buttonType","Component","defaultProps","trimEnd","string","length","substring","HUDSearchBar","lastSubmittedValue","autoSearchTimer","handleChange","handleSubmit","clearTimeout","setTimeout","submissionTimeoutDelay","target","value","searchSongsWithQuery","letters","trim","match","words","curWord","forEach","letter","push","wordsToArray","onKeyUp","keyEvent","keyCode","placeholder","onChange","ENTER","query","SongContainerClassMap","SpotifySong","imgURL","artist","duration","handleClick","size","src","alt","arr","str","artistInArray","renderArtistArray","HUDSongSearchMenu","spotifyService","filterReceivedJSON","items","dotProp","newTrackArray","map","item","img","createTrackObject","songList","hasSearched","song","key","selectSong","input","renderSongList","RETURN","onReturn","HUDMainMenu","hasLoggedIn","onSongSelectRequest","onLoginRequest","onAboutPageRequest","onLeaderboardsPageRequest","spotifyLoginButton","selectSongButton","aboutButton","leaderboardsButton","mainButton","HUDSongProgress","songObject","positionInMilliseconds","shouldDisplay","barProperties","componentStyle","TransitionEnums","Transition","subject","GenericTransitionWrapper","IN","OUT","transitionRequestObservable","shouldMountIn","delay","msg","position","handleTransitionStart","handleTransitionEnd","onMount","onStartTransitionIn","onStartTransitionOut","onEndTransitionIn","onEndTransitionOut","currentStyle","onTransitionEnd","FadeTransition","mountHandler","SlideTransition","HUDSongSelectMenu","onConfirmation","rangeLowToHigh","FormOverlay","question","inputComponent","currentValueDisplay","transitionObservable","Subject","questions","renderQuestionContainer","step","q1","evt","parseInt","min","max","q2","q3","q4","q5","q6","q7","q8","q9","checked","q11","q12","q13","q14","q15","PauseOverlay","isPlaying","onPause","onResume","pauseIcon","playIcon","HUDOverlayManager","mainMenuTransitionController","gameStateController","onNotificationOf","GameStateEnums","PLAY","selectedSong","stateLog","readAndUpdateState","playerStateUpdaterIntervalID","mountSongSearchMenu","mountSongSelectMenu","popMenu","mainMenu","updatePlaybackState","renderOverlay","stateObj","givenId","currentId","paused","displayCompletionForm","request","IDLE","deactivate","PAUSE","terminatePlaybackStateUpdater","playing","initPlaybackStateUpdater","spotifyPlayerState","playerState","setInterval","clearInterval","prevScreenTransitionObservable","songSearchMenu","oldState","menuStack","getAudioAnalysisAndFeatures","object","GENERATE","notify","activate","oldStack","pop","displayPauseOverlay","displayError","login","progBar","playbackPosition","errorComponent","APIService","spotifyID","displayName","imageUrl","status","errorCode","init","addNewUser","sessionObject","inputArray","saveGameSessionOnly","saveInputArrayOnly","responseJSON","sessions","sessionID","modifiedArray","userID","handler","App","apiService","canvasReference","game","GameStateController","Game","width","innerWidth","height","innerHeight","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.94c33b55.chunk.js","sourcesContent":["module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAQAAABpN6lAAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QAAKqNIzIAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAAHdElNRQfkAgYVAzrpZhRiAAACH0lEQVR42u2dOU7DYBgFX5yC0LMVHIfAKUBwC8RFAFGwiDIsB4jSQEBCwBWIWJQAUY5gU1gI0WHH/obijWvrzT9ylPKXctZ0oZFSZRU+E/W0qaamoakt9TSp1CvVSOda/Rlp6bTSgd9PX4ulj7+k2xrNTjSTz9R5/EyZ7tUqdfxZPdZsdpx//PWOZMq0XSrAToBZW7oMmBmoUfj4DT0HmJ019K6F0r/Rv7Ost8JvvAR4jRLNBcyoROT5GK9ESchQ8ZUgr5iZf4wD0AI0DkAL0DgALUDjALQAjQPQAjQOQAvQOAAtQOMAtACNA9ACNA5AC9A4AC1A4wC0AI0D0AI0DkAL0DgALUDjALQAjQPQAjQOQAvQOAAtQOMAtACNA9ACNA5AC9A4AC1A4wC0AI0D0AI0DkAL0DgALUDjALQAjQPQAjQOQAvQOAAtQOMAtACNA9ACNA5AC9A4AC1A4wC0AI0D0AI0DkAL0DgALUDjALQAjQPQAjQOQAvQOAAtQOMAtACNA9ACNA5AC9A4AC1A4wC0AI0D0AI0DkAL0DgALUDjALQAjQPQAjQOQAvQOAAtQOMAtABNojRkp/hKkFeiz5Chj8JvBHklugmYGRS+c1Z61VOA2XWivYCZ3VJvHQSY7UvSSc2XG9+Vvnr7oWazw3xoptYEV1Nc7Lyofo1mR9+Xr0tSWx0NlVY6MFZX61P+0Ta1oa7GlXqlGqqjlXzgC6j1AcnsGbLmAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIwLTAyLTA2VDIxOjAzOjU4KzAwOjAwh3nvzwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMC0wMi0wNlQyMTowMzo1OCswMDowMPYkV3MAAAAZdEVYdFNvZnR3YXJlAHd3dy5pbmtzY2FwZS5vcmeb7jwaAAAAAElFTkSuQmCC\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAQAAABpN6lAAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QAAKqNIzIAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAAHdElNRQfkAgYVAyFjA92OAAAERElEQVR42uWdT4hWVRjGfzVZmA4zpQsZ3UQGgqCFLSKiVFQU+kctLOkPLpJ0kYsINxFBGLUIdDkuJ3QxLhRBrURF0bTZiKHTJv+MWKNCTo7lODZ+b4u7iDK95/u+e8/z3nuesz13eJ/fvBfu893LeyBUnaxjPxcZ51cG+IqlTAq+tgZaxgXsP+sCH9GtLiyOlnLzDvvZusp6OtTlla0ert3FfraOM1ddYrnqu6d9wxjjQ+5Xl1mWpjGeC8AwvucJdanlaF2QfcMY5T3uU5dbvLYGAzCMb5ipLrhoDTYFwPiNN9QlF6vrTQIwjH6mq8suSh00WgBgXOJldenFqKsl+9naQqe6/PbV3QYA4zyL1Aa0AIwGvTysNqEEYBiDPK22oQVg/MUXPKi2ogRgGCeZrzajBWCMsaF60blIAIZxlNlqS1oAxihrqhSZigdgVCoylQPAGOFttTUtAMPoZ5ranhaAcYmX1Aa1AAyjz3dkKh+AcY6FaptaAK4jUxwAhnGaBWqzWgBZZHL3vjEmAMMYYI7ashZAFpkcvWWKD8AwjviJTBoAxjXWqK1rARjGXnrU9rUAjBHeShuAIY9MegDGsDIyeQBgGH1MTRuAcY4X0gZgNNjMQykDMIxTsSOTNwDRI5M/AIbxQ7zI5BNAxMjkFYBhHOHxtAFEiUy+ARjGnnIjk38AxhVeSxuAYfTzaNoAjGFebMWgo1/f2tQMdtFbfGSqTgdk6yzPN2ewPh2Q6TEO8EmRrqrWAdnaG34r1K0DMi1nH10pA4Bn2Bn2ZWJdAcBCPgvZlve9Vjcjaict6zbPMpC3qb4dAB1szN9UZwCwhHlpA4A3UweQ+1xYdwDJ3wJT894k1B0AWNoARrmVNoCTeRvqDuBw6gC2pQ1gD4MpA5jg4/xNdQbwOSfa/yPV/EnMMHbzQIjBunbAIVYykS6AHazgj7Ct9QMwwQZeZyx0e9B9UiGd4V2ONnNBnTrA2ML85uzXqQOGWM3B5i+rSwds56lW7OerCs8Bl3mlPLL+AWwvd2aRbwC/p/2R1LfMKtu+XwB/sj7OGAafACLOLvQHIPIoFm8AfuTJeOa9AZCMY/ID4Geei23eD4AGvUxR2PcB4DyLNeZ9AOjnEZ19NYBSY45/ACXHHN8AIsQczwCixByvAG7Eijk+Abgb0R4TwE2PEyfjAYgeczwBcDx1NgYAUczxAUAYczwAkMYcPQBxzNECuMyramtKAC5ijgqAm5ijAfCdn5gTH4CzmBMbgLuYExPALT71F3PiAXAac+IAcBxzYgA44znmhKmrZfMNNjFZXX77avWorSH/MSdUrR22VoGYE6qfmjQvHYBZhpo7cLFCMSdU4UduXmWVutgyFHroauViTri+zjV/nferF3PC1cPoPe0fjDHXT6u7H709zDt1/t//oyUM/c+D7geqcccKdbKWfVxknF84xpcsqmrA/bf+BrbynChoRDjLAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIwLTAyLTA2VDIxOjAzOjMzKzAwOjAwQxGysgAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMC0wMi0wNlQyMTowMzozMyswMDowMDJMCg4AAAAZdEVYdFNvZnR3YXJlAHd3dy5pbmtzY2FwZS5vcmeb7jwaAAAAAElFTkSuQmCC\"","// key for accessing local storage data\nconst LOCAL_STORAGE_KEY = \"spotify-refresh-token\";\n\n/**\n * Either console logs or broadcasts a state message.\n *\n * @param {String} state current spotify service state\n * @param {*} body the body of the notification. Could be anything depending on the state.\n * @param {String} message optional message to be notified\n * @param {Rx.Subject} notifier the observable to emit the message from\n *\n * @returns {void}\n */\nconst log = (state, body, message = \"\", notifier = null) => {\n\n    const notification = {\n        \"source\": \"SpotifyService\",\n        state,\n        body,\n        message\n    };\n\n    // broadcast state\n    if (notifier) notifier.next(notification);\n    else console.log(notification);\n\n};\n\n/**\n * Fetches tokens from URL query and returns them in an object.\n * @returns {{accessToken: *, refreshToken: *}} object containing both tokens\n */\nconst getTokensFromQuery = () => {\n    const urlParams = new URLSearchParams(window.location.search);\n    const accessToken = urlParams.get(\"accessToken\");\n    const refreshToken = urlParams.get(\"refreshToken\");\n\n    return {\n        accessToken,\n        refreshToken\n    };\n};\n\n/**\n * Returns refresh and access tokens if a valid refresh token is found either in the query or local storage.\n * If no valid refresh token exists, returned tokens will be \"null\".\n * @param {Function} refreshTokenFunction function that fetches refresh tokens from server.\n * @param {Rx.Subject} stateNotifier an optional Subject that will be used to broadcast state of the utility\n * @returns {{accessToken: *, refreshToken: *}} object containing both tokens\n */\nconst processTokens = (refreshTokenFunction, stateNotifier = null) => {\n\n    // Handle state of SDK and user token\n    const queryTokens = getTokensFromQuery();\n\n    let accessToken = null;\n    let refreshToken = null;\n\n    // check if refresh token exists in local storage, or else check query\n    if (queryTokens.accessToken && queryTokens.refreshToken) {\n\n        // set state tokens\n        accessToken = queryTokens.accessToken;\n        refreshToken = queryTokens.refreshToken;\n\n        // update state\n        log(\"ACCESS_TOKEN_ACQUIRED\", {\n            accessToken,\n            refreshToken\n        }, \"Using tokens from query returned from server!\", stateNotifier);\n\n        // save token locally if it was found\n        localStorage.setItem(LOCAL_STORAGE_KEY, queryTokens.refreshToken);\n\n    } else {\n\n        // this is the case when query tokens don't exist\n        log(\"LOADING_TOKEN_FROM_LOCAL_STORAGE\", null, \"Spotify tokens not found in query. Looking in local storage...\", stateNotifier);\n\n        const localStorageRefreshToken = localStorage.getItem(LOCAL_STORAGE_KEY);\n\n        // if found, attempt to refresh\n        if (localStorageRefreshToken) {\n\n            log(\n            \"REFRESHING_TOKEN\",\n                null,\n                \"Spotify refresh token found in localStorage. Fetching new accessToken from server...\",\n                stateNotifier\n            );\n\n            refreshTokenFunction(localStorageRefreshToken)\n                .then(json => {\n\n                    log(\n                        \"ACCESS_TOKEN_ACQUIRED\",\n                        {\n                            \"accessToken\": json.accessToken,\n                            \"refreshToken\": localStorageRefreshToken\n                        },\n                        \"Spotify access token fetched.\",\n                        stateNotifier\n                    );\n\n                });\n\n        } else {\n\n            log(\n                \"NO_ACCESS_TOKEN\",\n                null,\n                \"No tokens found or refreshed. User must log in.\",\n                stateNotifier\n            );\n\n        }\n    }\n};\n\nexport {\n    getTokensFromQuery,\n    processTokens,\n    log\n};","import fromCDN from \"from-cdn\";\nimport Rx from \"rxjs\";\nimport {processTokens, log} from \"./SpotifyServiceTools\";\n\n/*\n * url for react debugging on node server (comment out for building in production)\n */\nconst DEBUG_URL = \"\"; // \"http://localhost:8080\";\n\n/**\n * Service that handles client-side handling of Spotify communications.\n */\nclass SpotifyService {\n\n\t// Must have a reference to SDK so playback functions can be called.\n\tconstructor (spotifyPlayerName) {\n\n\t\t// keep track of all three initializations\n\t\tconst $cdn = new Rx.BehaviorSubject(false);\n\t\tconst $sdk = new Rx.BehaviorSubject(false);\n\t\tconst $token = new Rx.BehaviorSubject(false);\n\n\t\t/*\n\t\t * spotify service observable\n\t\t * subject that notifies of all state changes within this module.\n\t\t */\n\t\tconst $spotifyServiceStateNotifier = new Rx.ReplaySubject();\n\n\t\t// does all necessary initialization\n\t\tconst initPlayer = () => {\n\n\t\t\t// if this is running again after initialization, quit.\n\t\t\tif (this.player) return;\n\n\t\t\tconst {Player} = window.Spotify;\n\n\t\t\t/*\n\t\t\t * todo: may extract this to a separate func\n\t\t\t * Initialize player\n\t\t\t */\n\t\t\tthis.player = new Player({\n\t\t\t\t\"name\": \"tune mountain\",\n\t\t\t\t\"getOAuthToken\": callback => callback(this.accessToken),\n\t\t\t\t\"volume\": 0.5\n\t\t\t});\n\n\t\t\tthis.player.connect();\n\n\t\t\t// noinspection JSDeprecatedSymbols\n\t\t\tthis.player.addListener(\"ready\", ({device_id}) => {\n\t\t\t\tlog(\"PLAYER_READY\", `Spotify player ready to stream songs on ${device_id}`, $spotifyServiceStateNotifier);\n\t\t\t});\n\n\t\t\t// check for player state updates and notify them\n\t\t\tthis.player.addListener(\"player_state_changed\", webPlaybackStateObject => log(\n\t\t\t\t\"PLAYER_STATE_CHANGED\",\n\t\t\t\twebPlaybackStateObject,\n\t\t\t\t\"Spotify player state changed!\",\n\t\t\t\t$spotifyServiceStateNotifier\n\t\t\t));\n\n\t\t\t// TODO: add listener for error and automatically refresh token\n\n\t\t};\n\n\t\t// only init spotify player/service once all three parts are done with their processes\n\t\t$cdn.combineLatest(\n\t\t\t$sdk,\n\t\t\t$token,\n\t\t\t(cdnLoaded, sdkLoaded, tokenLoaded) => cdnLoaded && sdkLoaded && tokenLoaded\n\t\t)\n\t\t\t.filter(isAllLoaded => isAllLoaded)\n\t\t\t.subscribe(() => {\n\t\t\t\tlog(\"LOGGED_IN\", null, \"User has logged in.\", $spotifyServiceStateNotifier);\n\t\t\t\tinitPlayer();\n\t\t\t});\n\n\t\t// process tokens and collect notifications from it\n\t\tprocessTokens(this.getNewAccessToken, $spotifyServiceStateNotifier);\n\n\t\t// save tokens when they're acquired\n        $spotifyServiceStateNotifier\n            .filter(notif => notif.state === \"ACCESS_TOKEN_ACQUIRED\")\n            .subscribe(newState => {\n\n                // get tokens from update\n                const {\n                    accessToken,\n                    refreshToken\n                } = newState.body;\n\n                this.accessToken = accessToken;\n                this.refreshToken = refreshToken;\n\n                if (accessToken && refreshToken) $token.next(true);\n                else $token.next(false);\n\n            });\n\n\t\tthis.name = spotifyPlayerName;\n\t\tthis.player = null;\n\t\tthis.spotifyStateNotifier = $spotifyServiceStateNotifier;\n\n\t\t// Load sdk, update state\n\t\tfromCDN([\"https://sdk.scdn.co/spotify-player.js\"])\n\t\t\t.then(() => {\n\t\t\t\t$cdn.next(true);\n\t\t\t});\n\n\t\twindow.onSpotifyWebPlaybackSDKReady = () => $sdk.next(true);\n\n\t\tthis.spotifyStateNotifier = $spotifyServiceStateNotifier;\n\n\t\t// bind functions?\n\t\tthis.pause = this.pause.bind(this);\n\t\tthis.resume = this.resume.bind(this);\n\t\tthis.toggle = this.toggle.bind(this);\n\t}\n\n\t/**\n\t * Getter for Rx.Subject that notifies state of this module to rest of the app.\n\t * @returns {Subject} Rx Observable that emits state updates.\n\t */\n\tget stateNotifier() {\n\t\treturn this.spotifyStateNotifier;\n\t}\n\n\t/**\n\t * Getter for current state of spotify player.\n\t * @returns {Promise} contains the player state object\n\t */\n\tget playerState() {\n\t\tif (this.player) return this.player.getCurrentState();\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * Connects spotify player to Spotify Connct\n\t */\n\tactivate() {\n\t\tif (this.player) return this.player.connect();\n\n\t\treturn null;\n\t}\n\n\tdeactivate() {\n\t\tif (this.player) this.player.disconnect();\n\t}\n\n\t/**\n\t * Refreshes the user token.\n\t * @param {String} refreshToken refresh token received from Spotify\n\t * @returns {JSON} JSON returned from query.\n\t */\n\tgetNewAccessToken(refreshToken = null) {\n\n\t\tconst tokenToBeUsed = refreshToken ? refreshToken : this.refreshToken;\n\n\t\treturn fetch(`${DEBUG_URL ? DEBUG_URL : \"\"}/spotify-service/refresh-token/${tokenToBeUsed}`)\n\t\t\t.then(response => response.json())\n\t\t\t.catch(error => {\n\t\t\t\tconsole.error(error);\n\t\t\t});\n\n\t}\n\n\t/**\n\t * Pauses playback on local spotify player.\n\t * @returns {Promise}\n\t */\n\tpause() {\n\t\tif (this.player) return this.player.pause();\n\n\t\treturn null;\n\n\t}\n\n\t/**\n\t * Pauses playback on local spotify player.\n\t * @returns {Promise}\n\t */\n\ttoggle() {\n\t\tif (this.player) return this.player.togglePlay();\n\n\t\treturn null;\n\n\t}\n\n\t/**\n\t * Resumes playback on local spotify player\n\t * @returns {Promise}\n\t */\n\tresume() {\n\t\tif (this.player) return this.player.resume();\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * Plays a song on the current active player with a given spotify URI.\n\t * @param {String} songID the Spotify track ID of the song. Can be acquired through search params.\n\t * @returns {void}\n\t */\n\tplay(songID) {\n\n\t\tconst uri = `spotify:track:${songID}`;\n\n\t\tif (!this.player) throw new Error(\"Player not initialized.\");\n\n\t\tconst play = ({\n\t\t\tspotifyURI,\n\t\t\t\"playerInstance\": {\n\t\t\t\t\"_options\": {\n\t\t\t\t\tgetOAuthToken,\n\t\t\t\t\tid\n\t\t\t\t}\n\t\t\t}\n\t\t}) => {\n\t\t\tgetOAuthToken(access_token => {\n\t\t\t\tconst details = {\n\t\t\t\t\t\"method\": \"PUT\",\n\t\t\t\t\t\"headers\": {\n\t\t\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t\t\t\"Authorization\": `Bearer ${access_token}`\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tif (spotifyURI) {\n\t\t\t\t\tdetails.body = JSON.stringify({\"uris\": [spotifyURI]});\n\t\t\t\t}\n\n\t\t\t\tfetch(\n\t\t\t\t`https://api.spotify.com/v1/me/player/play?device_id=${id}`,\n\t\t\t\t\tdetails\n\t\t\t\t).then(() => console.log(`Success: Playing uri: ${spotifyURI}`));\n\t\t\t});\n\t\t};\n\n\t\t// run the function\n\t\tplay({\n\t\t\t\"playerInstance\": this.player,\n\t\t\t\"spotifyURI\": uri\n\t\t});\n\n\t}\n\n\t/**\n\t * Redirects application to accounts.spotify.com web page for login.\n\t * @returns {void}\n\t */\n\tlogin() {\n\n\t\tconsole.log(\"Redirecting to Spotify for authorization...\");\n\t\twindow.location = `${DEBUG_URL ? DEBUG_URL : \"\"}/spotify-service/login`;\n\n\t}\n\n\t/**\n\t * Searches spotify servers using the passed keywords in any order (without quotations on query).\n\t * Returns tracks on the State updater using the state keyword TRACKS_FETCHED; if a callback function is\n\t * passed, the returned JSON object is passed as the only argument in the callback function.\n\t *\n\t * @param {Function} callback an optional callback function whose argument will be the JSON object containing the songs\n\t * @param {...String} keywords one or more strings to be used in the query parameter.\n\t * @returns {void} return values are emitted on Subject or passed to callback\n\t */\n\tsearch(callback = null, ...keywords) {\n\n\t\t// 1: filter keywords into a query string\n\t\tlet searchQueryString = \"q=\";\n\t\tfor (let index = 0; index < keywords.length; index++) {\n\n\t\t\t// append keyword\n\t\t\tsearchQueryString += keywords[index];\n\n\t\t\t// add &20 between keywords if not last item\n\t\t\tsearchQueryString += index + 1 === keywords.length ? \"\" : \"&20\";\n\n\t\t}\n\n\t\t// other filtering parameters\n\t\tconst type = \"type=track\";\n\t\tconst limit = \"limit=8\";\n\n\t\t// 2: define GET parameters and headers\n\t\tconst url = `https://api.spotify.com/v1/search?${searchQueryString}&${type}&${limit}`;\n\t\tconst header = {\n\t\t\t\"method\": \"GET\",\n\t\t\t\"headers\": {\n\t\t\t\t\"Accept\": \"application/json\",\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t\"Authorization\": `Bearer ${this.accessToken}`\n\t\t\t}\n\t\t};\n\n\t\t// 3: emit result in callback and subject\n\t\tfetch(url, header)\n\t\t\t.then(response => response.json())\n\t\t\t.then(json => {\n\n\t\t\t\t// emit\n\t\t\t\tlog(\n\t\t\t\t\t\"TRACKS_FETCHED\",\n\t\t\t\t\tjson,\n\t\t\t\t\t\"Choose any of these songs...\",\n\t\t\t\t\tthis.spotifyStateNotifier\n\t\t\t\t);\n\n\t\t\t\t// callback\n\t\t\t\t// eslint-disable-next-line callback-return\n\t\t\t\tif (callback) callback(json);\n\n\t\t\t})\n\t\t\t.catch(err => {\n\t\t\t\tthrow new Error(err);\n\t\t\t});\n\n\t}\n\n\t/**\n\t * Returns through callback an object containing \"audioFeatures\" and \"audioAnalysis\" for a given\n\t * track ID.\n\t * @param {String} id a spotify track id\n\t * @param {Function} callback callback function for handling features and analysis\n\t * @returns {void} return values are passed to callback\n\t */\n\tgetAudioAnalysisAndFeatures(id, callback) {\n\n\t\tconst analysisURL = `https://api.spotify.com/v1/audio-analysis/${id}`;\n\t\tconst featuresURL = `https://api.spotify.com/v1/audio-features/${id}`;\n\n\t\tconst header = {\n\t\t\t\"method\": \"GET\",\n\t\t\t\"headers\": {\n\t\t\t\t\"Accept\": \"application/json\",\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t\"Authorization\": `Bearer ${this.accessToken}`\n\t\t\t}\n\t\t};\n\n\t\tlet analysis = null;\n\t\tlet features = null;\n\n\t\tfetch(analysisURL, header)\n\t\t\t.then(response => response.json())\n\t\t\t.then(analysisObject => {\n\t\t\t\tanalysis = analysisObject;\n\n\t\t\t\treturn fetch(featuresURL, header);\n\t\t\t})\n\t\t\t.then(response => response.json())\n\t\t\t.then(featuresObject => {\n\t\t\t\tfeatures = featuresObject;\n\n\t\t\t\tif (callback) {\n\n\t\t\t\t\t// eslint-disable-next-line callback-return\n\t\t\t\t\tcallback({\n\t\t\t\t\t\tfeatures,\n\t\t\t\t\t\tanalysis\n\t\t\t\t\t});\n\n\t\t\t\t}\n\n\t\t\t\t// emit\n\t\t\t\tlog(\n\t\t\t\t\t\"METADATA_FECHED\",\n\t\t\t\t\t{\n\t\t\t\t\t\t\"audioFeatures\": features,\n\t\t\t\t\t\t\"audioAnalysis\": analysis\n\t\t\t\t\t},\n\t\t\t\t\t\"Metadata available.\",\n\t\t\t\t\tthis.spotifyStateNotifier\n\t\t\t\t);\n\n\t\t\t})\n\t\t\t.catch(error => console.error(error));\n\t}\n\n\t/**\n\t *  Fetches user info\n\t *\n\t *  @returns {Promise} promise that evaluates in the response.\n\t */\n\tgetUserInfo() {\n\n\t\tconst handler = (resolve, reject) => {\n\n\t\t\tconst url = \"https://api.spotify.com/v1/me\";\n\t\t\tconst header = {\n\t\t\t\t\"method\": \"GET\",\n\t\t\t\t\"headers\": {\n\t\t\t\t\t\"Accept\": \"application/json\",\n\t\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t\t\"Authorization\": `Bearer ${this.accessToken}`\n\t\t\t\t}\n\t\t\t};\n\n\t\t\treturn fetch(url, header)\n\t\t\t\t.then(res => res.json())\n\t\t\t\t.then(resJSON => resolve({\n\t\t\t\t\t\"spotifyID\": resJSON.id,\n\t\t\t\t\t\"displayName\": resJSON.display_name,\n\t\t\t\t\t\"imageUrl\": resJSON.images[0].url\n\t\t\t\t}))\n\t\t\t\t.catch(err => reject(err));\n\n\t\t};\n\n\t\treturn new Promise(handler);\n\n\t}\n\n}\n\nexport default SpotifyService;","import React, {Component} from \"react\";\nimport PropTypes from \"prop-types\";\nimport \"../../css/hud/HUDButton.css\";\n\n/**\n * Enumeration that defines types of button CSS layouts supported. Buttons instantiated without\n * a type will default to SMALL.\n * This value is emitted along with the original click event.\n * @type {Readonly<{RETURN: string, SMALL: string, LARGE: string, ENTER: string}>}\n */\nexport const HUDButtonTypesEnum = Object.freeze({\n    \"SMALL\": \"SMALL\",\n    \"LARGE\": \"LARGE\",\n    \"RETURN\": \"RETURN\",\n    \"ENTER\": \"ENTER\"\n});\n\nconst TypeToClassMap = Object.freeze({\n    \"SMALL\": \"hud-button-small\",\n    \"LARGE\": \"hud-button-large\",\n    \"RETURN\": \"hud-button-return\",\n    \"ENTER\": \"hud-button-enter\"\n});\n\nconst TypeToStyleMap = Object.freeze({\n    \"SMALL\": {\n        \"borderBottom\": \"solid 4px\",\n        \"borderLeft\": \"solid 4px\",\n        \"marginTop\": \"1.5vw\",\n        \"height\": \"5vw\"\n    },\n    \"RETURN\": {\n        \"width\": \"7.8vh\",\n        \"height\": \"7vh\",\n        \"borderBottom\": \"solid 4px\",\n        \"borderLeft\": \"solid 4px\"\n    },\n    \"ENTER\": {\n        \"height\": \"3vw\",\n        \"borderBottom\": \"solid 4px\",\n        \"borderLeft\": \"solid 4px\"\n    }\n});\n\n/**\n * Wrapper for HTML Button element. Sanitizes button text and has preset styles.\n * Emits button type on click.\n *\n * @param {Object} props React properties\n * @returns {React.Component} JSX element\n * @constructor\n */\nclass HUDButton extends Component {\n\n    constructor(props) {\n        super(props);\n\n        this.state = {\n            \"isHovering\": false\n        };\n\n        this.btnRef = React.createRef();\n    }\n\n\n    render() {\n\n        // props\n        const {\n            type,\n            text,\n            onClick,\n            style,\n            children,\n            className\n        } = this.props;\n\n        const {\n            isHovering\n        } = this.state;\n\n        // check if passed type exists\n        const isValidType = Boolean(HUDButtonTypesEnum[type]);\n        const filteredType = isValidType ? TypeToClassMap[type] : TypeToClassMap.SMALL;\n\n        const onHover = () => this.setState({\"isHovering\": true});\n        const onHoverEnd = () => this.setState({\"isHovering\": false});\n\n        // return jsx\n        return (\n            <div onMouseEnter={onHover}\n                 onMouseLeave={onHoverEnd}\n                 className={`button-wrapper ${className}`}\n                 style={style}\n            >\n                <button\n                    ref={this.btnRef}\n                    style={isHovering ? TypeToStyleMap[type] : null}\n                    className={`${filteredType} hud-button`}\n                    onClick={(event => {\n                        this.btnRef.current.blur();\n                        event.buttonType = filteredType;\n                        onClick(event);\n                    })}\n                >\n                    {text || children}\n                </button>\n            </div>\n        );\n\n    }\n\n}\n\n// prop types for development\nHUDButton.propTypes = {\n    \"type\": PropTypes.string,\n    \"text\": PropTypes.string,\n    \"onClick\": PropTypes.func,\n    \"onHover\": PropTypes.func,\n    \"onHoverEnd\": PropTypes.func,\n    \"isHovering\": PropTypes.bool,\n    \"style\": PropTypes.object,\n    \"children\": PropTypes.array,\n    \"className\": PropTypes.string\n};\n\n// default props\nHUDButton.defaultProps = {\n    \"type\": HUDButtonTypesEnum.SMALL,\n    \"text\": \"Button Text Not Set\",\n    \"onClick\": () => console.error(\"Click handler not set for this button.\"),\n    \"onHover\": () => console.error(\"Hover handler not set for this button.\"),\n    \"onHoverEnd\": () => console.error(\"End Hover handler not set for this button.\"),\n    \"children\": null,\n    \"className\": \"\",\n    \"isHovering\": false\n};\n\nexport default HUDButton;","// constants\nconst DEFAULT_MAX_STRING_LENGTH = 26;\n\n/**\n * Converts a paragraph to an array of words, removing any symbols so that\n * no wacky HTTP GET requests are done to Spotify.\n *\n * @param {String} string the input string.\n * @returns {Array<String>} an array of the words passed to the function.\n */\nconst wordsToArray = string => {\n\n    // trim whitespace before and after\n    const paragraph = string.trim();\n\n    // eslint-disable-next-line require-unicode-regexp\n    const regex = /[A-Za-z0-1 ]/g;\n\n    // filter symbols\n    const letters = paragraph.match(regex);\n\n    const words = [];\n    let curWord = \"\";\n\n    // join letters and remove whitespace\n    letters.forEach((letter, index) => {\n        if (letter === \" \") {\n            if (curWord.length > 0) words.push(curWord);\n            curWord = \"\";\n        } else {\n            curWord += letter;\n            if (index + 1 === letters.length) words.push(curWord);\n        }\n    });\n\n    return words;\n\n};\n\n/**\n * Trims end of a string and adds ellipses at end of string\n *\n * @param {String} string input\n * @param {Number} length integer determining max length of string\n * @returns {String} modified string with ellipses or normal string if length is less than the one provided.\n */\nconst trimEnd = (string, length = DEFAULT_MAX_STRING_LENGTH) => {\n\n    if (string.length <= length) return string;\n\n    const substring = string.substring(0, length);\n\n    return `${substring}...`;\n\n};\n\nexport {\n    wordsToArray,\n    trimEnd\n};","import React, {Component} from \"react\";\nimport PropTypes from \"prop-types\";\nimport HUDButton, {HUDButtonTypesEnum} from \"./HUDButton\";\nimport {wordsToArray} from \"../../utils/StringTools\";\nimport \"../../css/hud/HUDSongSearch.css\";\n\nclass HUDSearchBar extends Component {\n\n    constructor(props) {\n        super(props);\n\n        this.state = {\n            \"value\": \"\"\n        };\n        this.lastSubmittedValue = null;\n\n        this.autoSearchTimer = null;\n\n        // function bindings\n        this.handleChange = this.handleChange.bind(this);\n        this.handleSubmit = this.handleSubmit.bind(this);\n    }\n\n    /**\n     * Updates the text in the text box and resets the auto-search timer.\n     * @param {Event} event event of a key being pressed\n     * @returns {void}\n     */\n    handleChange(event) {\n\n        // if timer has been set, clear it and reset it.\n        if (this.autoSearchTimer) clearTimeout(this.autoSearchTimer);\n        this.autoSearchTimer = setTimeout(this.handleSubmit, this.props.submissionTimeoutDelay);\n\n        this.setState({\"value\": event.target.value});\n\n    }\n\n    /**\n     * Filters text in box into an array of words (also getting rid of illegal symbols)\n     * and runs handler function passing it such array.\n     * @returns {void}\n     */\n    handleSubmit() {\n\n        // do not search if nothing is in text box\n        if (this.state.value === \"\") return;\n\n        // only submit if the value has changed\n        if (this.state.value !== this.lastSubmittedValue) {\n\n            this.props.searchSongsWithQuery(wordsToArray(this.state.value));\n            this.lastSubmittedValue = this.state.value;\n\n        }\n\n    }\n\n    render() {\n        return(\n            <div\n                className=\"search-bar-container\"\n                onKeyUp={keyEvent => {\n                    if (keyEvent.keyCode === 13) this.handleSubmit();\n                }}\n            >\n                <input\n                    className=\"text-box\"\n                    placeholder={this.props.placeholder}\n                    type=\"text\" value={this.state.value}\n                    onChange={this.handleChange}\n                />\n                <HUDButton type={HUDButtonTypesEnum.ENTER}\n                           text=\"Search\"\n                           onClick={this.handleSubmit}\n                />\n            </div>\n        );\n    }\n\n}\n\n// default props\nHUDSearchBar.defaultProps = {\n    \"searchSongsWithQuery\": query => {\n        throw new Error(`Unable to search song with query ${query}. No handler passed.`);\n    },\n    \"placeholder\": \"Type the name of a song...\",\n    \"submissionTimeoutDelay\": 2000\n};\n\n// prop type constraints\nHUDSearchBar.propTypes = {\n    \"searchSongsWithQuery\": PropTypes.func,\n    \"placeholder\": PropTypes.string,\n    \"submissionTimeoutDelay\": PropTypes.number\n};\n\nexport default HUDSearchBar;","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport \"../../css/hud/SpotifySong.css\";\nimport {trimEnd} from \"../../utils/StringTools\";\n\nconst SongContainerClassMap = Object.freeze({\n    \"small\": \"song-container-small\",\n    \"large\": \"song-container-large\",\n    \"mini\": \"song-container-mini\"\n});\n\n/**\n * React element for rendering a song and handling clicks on that element to select a song.\n *\n * Two styles are supported. Props.size can be either \"small\", \"large\", or \"mini\"\n * @param {Object} props react properties\n * @constructor\n */\nconst SpotifySong = props => {\n\n    const {\n        name,\n        id,\n        imgURL,\n        artist,\n        duration,\n        handleClick,\n        size\n    } = props;\n\n    const renderArtistArray = arr => {\n\n        let str = \"\";\n\n        arr.forEach((artistInArray, index) => {\n           str += artistInArray;\n           str += index + 1 === arr.length ? \"\" : \", \";\n        });\n\n        return str;\n    };\n\n    return (\n        <div className={`${SongContainerClassMap[size]} song-container`} onClick={() => handleClick({\n            name,\n            id,\n            imgURL,\n            artist,\n            duration\n        })}>\n            <img className=\"song-image\" src={imgURL} alt={`Album cover for song ${name} by artist ${artist}`}/>\n            <div className=\"song-data-container\">\n                <h1 className=\"song-name\">{trimEnd(name)}</h1>\n                <h2 className=\"song-artist\">{trimEnd(renderArtistArray(artist))}</h2>\n            </div>\n        </div>\n    );\n\n};\n\nSpotifySong.defaultProps = {\n    \"name\": \"No Song Name Assigned\",\n    \"id\": \"No ID Passed\",\n    \"imgURL\": \"No image URL passed\",\n    \"artist\": \"No Artist\",\n    \"duration\": -1,\n    \"handleClick\": () => {\n        console.log(\"Song clicked!\");\n    },\n    \"size\": \"small\"\n};\n\nSpotifySong.propTypes = {\n    \"name\": PropTypes.string,\n    \"id\": PropTypes.string,\n    \"imgURL\": PropTypes.string,\n    \"artist\": PropTypes.array,\n    \"duration\": PropTypes.number,\n    \"handleClick\": PropTypes.func,\n    \"size\": PropTypes.string\n};\n\nexport default SpotifySong;","import React, {Component} from \"react\";\nimport PropTypes from \"prop-types\";\nimport dotProp from \"dot-prop\";\nimport HUDSearchBar from \"../../components/hud/HUDSearchBar\";\nimport SpotifySong from \"../../components/hud/SpotifySong\";\nimport \"../../css/hud/HUDSongSearch.css\";\nimport HUDButton, {HUDButtonTypesEnum} from \"../../components/hud/HUDButton\";\n\nconst MSG_IDENTIFIER = \"message\";\n\n/**\n * Component responsible for rendering a search bar, and requesting\n * the Spotify service to search for songs.\n */\nclass HUDSongSearchMenu extends Component {\n\n    constructor(props) {\n        super(props);\n\n        if (!props.spotifyService) throw new Error(\"HUDSearchMenu requires a reference to an instance of SpotifyService!\");\n\n        // save a reference to spotify service & state notifier\n        this.spotifyService = props.spotifyService;\n\n        // contains list of songs to be rendered\n        this.state = {\n            \"songList\": [],\n            \"hasSearched\": false\n        };\n\n        // bind functions\n        this.filterReceivedJSON = this.filterReceivedJSON.bind(this);\n    }\n\n    /**\n     * To be used as a callback (or subscription handler) for when a user searches\n     * for a set of keywords. This function filters the received object and strips it of\n     * unnecessary parameters.\n     *\n     * @param {Object} json the Spotify server response.\n     * @returns {void} new array of songs is updated to the state\n     */\n    filterReceivedJSON(json) {\n\n        // destructure tracks into array of items\n        const items = dotProp.get(json, \"tracks.items\");\n        if (!items) throw new Error(\"No items found in search response!\");\n\n        // for each item, collect URI, song name, artist name, album image\n        // eslint-disable-next-line max-params\n        const createTrackObject = (id, name, artist, img, duration) => ({\n            name,\n            artist,\n            img,\n            id,\n            duration\n        });\n\n        const newTrackArray = items.map(item => {\n\n            const id = item.id;\n            const songName = item.name;\n            const artistNames = dotProp.get(item, \"artists\").map(artist => artist.name);\n            const imgURL = dotProp.get(item, \"album.images\")[0].url;\n            const duration = dotProp.get(item, \"duration_ms\");\n\n            return createTrackObject(id, songName, artistNames, imgURL, duration);\n\n        });\n\n        // update state with new array\n        this.setState({\n            \"songList\": newTrackArray\n        });\n\n    }\n\n    /**\n     * Parses array of songs in state and converts them into JSX elements.\n     * @returns {Array} array of SpotifySong Components\n     */\n    renderSongList() {\n\n        const {songList, hasSearched} = this.state;\n\n        if (songList.length === 0 && hasSearched) {\n\n            return <h3 className={MSG_IDENTIFIER}>No songs found. Try something else.</h3>;\n\n        }\n\n        return songList.map(song => <SpotifySong\n                name={song.name}\n                artist={song.artist}\n                imgURL={song.img}\n                duration={song.duration}\n                id={song.id}\n                key={song.id}\n                handleClick={() => this.props.selectSong(song)}\n            />);\n\n    }\n\n    // renders a HUDSearchBar and a list of songs\n    render() {\n\n        return(\n            <div className=\"hud-song-search-outer-container\">\n                <div className=\"hud-song-search-inner-container\">\n                    <HUDSearchBar\n                        searchSongsWithQuery={input => this.spotifyService.search(this.filterReceivedJSON, input)}\n                    />\n                    <div className={\"song-list-container\"}>\n                        {this.renderSongList()}\n                    </div>\n                    <HUDButton\n                        text={\"<\"}\n                        type={HUDButtonTypesEnum.RETURN}\n                        onClick={this.props.onReturn}\n                    />\n                </div>\n            </div>\n        );\n    }\n\n}\n\n// default props\nHUDSongSearchMenu.defaultProps = {\n    \"spotifyService\": null,\n    \"selectSong\": song => {\n        console.error(\"Couldn't select song. No handler passed\", song);\n    },\n    \"onReturn\": () => {\n        console.error(\"No return button handler passed.\");\n    }\n};\n\n// prop type constraints\nHUDSongSearchMenu.propTypes = {\n    \"spotifyService\": PropTypes.object,\n    \"selectSong\": PropTypes.func,\n    \"onReturn\": PropTypes.func\n};\n\nexport default HUDSongSearchMenu;","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport HUDButton from \"../../components/hud/HUDButton\";\nimport \"../../css/hud/HUDMainMenu.css\";\n\n/**\n * HUD element that wraps all objects in main menu. Two types of main menu can exist:\n * pre and post login.\n * @param {Object} props react props\n * @constructor\n */\nconst HUDMainMenu = props => {\n\n    const {\n        hasLoggedIn,\n        onSongSelectRequest,\n        onLoginRequest,\n        onAboutPageRequest,\n        onLeaderboardsPageRequest\n    } = props;\n\n    // // // BUTTONS // // //\n    const spotifyLoginButton = <HUDButton\n        text=\"Spotify Login\"\n        onClick={onLoginRequest}\n    />;\n\n    const selectSongButton = <HUDButton\n        text=\"Select Song\"\n        onClick={onSongSelectRequest}\n    />;\n\n    const aboutButton = <HUDButton\n        text=\"About\"\n        onClick={onAboutPageRequest}\n    />;\n\n    const leaderboardsButton = <HUDButton\n        text=\"Leaderboards\"\n        onClick={onLeaderboardsPageRequest}\n    />;\n\n    // determines which top button will be rendered\n    const mainButton = hasLoggedIn ? selectSongButton : spotifyLoginButton;\n\n    return (\n\n        <div className=\"hud-main-menu-outer-container\">\n            <div className=\"hud-main-menu-button-container\">\n                {mainButton}\n                {aboutButton}\n                {leaderboardsButton}\n            </div>\n        </div>\n\n    );\n\n};\n\n// prop type constraints\nHUDMainMenu.propTypes = {\n    \"hasLoggedIn\": PropTypes.bool,\n    \"onSongSelectRequest\": PropTypes.func,\n    \"onLoginRequest\": PropTypes.func,\n    \"onAboutPageRequest\": PropTypes.func,\n    \"onLeaderboardsPageRequest\": PropTypes.func\n};\n\n// default properties\nHUDMainMenu.defaultProps = {\n    \"hasLoggedIn\": false,\n    \"onSongSelectRequest\": () => {\n        throw new Error(\"No handler passed.\");\n    },\n    \"onLoginRequest\": () => {\n        throw new Error(\"No handler passed.\");\n    },\n    \"onAboutPageRequest\": () => {\n        throw new Error(\"No handler passed.\");\n    },\n    \"onLeaderboardsPageRequest\": () => {\n        throw new Error(\"No handler passed.\");\n    }\n};\n\nexport default HUDMainMenu;","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport SpotifySong from \"./SpotifySong\";\nimport \"../../css/hud/HUDSongProgress.css\";\n\nconst HUDSongProgress = props => {\n\n    const {\n        songObject,\n        positionInMilliseconds,\n        shouldDisplay\n    } = props;\n\n    if (!songObject) return null;\n\n    const {\n        name,\n        id,\n        img,\n        artist,\n        duration\n    } = songObject;\n\n    const percentage = positionInMilliseconds / duration * 100;\n\n    const barProperties = {\n        \"width\": `${percentage}%`\n    };\n\n    const componentStyle = {\n        \"display\": shouldDisplay ? \"block\" : \"none\"\n    };\n\n    return (\n        <div\n            className={\"song-progress-bar-container\"}\n            style={componentStyle}\n        >\n            <div id={\"bar-wrapper\"}>\n                <div\n                    id={\"progress-bar\"}\n                    style={barProperties}\n                />\n            </div>\n            <div className={\"progress-bar-song-icon\"}>\n                {\n                    <SpotifySong\n                        name={name}\n                        artist={artist}\n                        imgURL={img}\n                        id={id}\n                        size={\"mini\"}\n                    />\n                }\n            </div>\n        </div>\n    );\n\n};\n\nHUDSongProgress.propTypes = {\n    \"songObject\": PropTypes.shape({\n        \"name\": PropTypes.string,\n        \"id\": PropTypes.string,\n        \"img\": PropTypes.string,\n        \"artist\": PropTypes.array,\n        \"duration\": PropTypes.number\n    }),\n    \"positionInMilliseconds\": PropTypes.number.isRequired,\n    \"shouldDisplay\": PropTypes.bool.isRequired\n};\n\nexport default HUDSongProgress;","\n/**\n * Defines handled transitions.\n * @type {{}}\n */\nconst TransitionEnums = {\n    \"IN\": \"IN\",\n    \"OUT\": \"OUT\"\n};\n\n/**\n * Defines default emissions for a transition subject.\n * @type {{in: Transition.in, out: Transition.out}}\n */\nconst Transition = {\n    \"in\": subject => {\n        if (subject) {\n            subject.next({\n                \"position\": TransitionEnums.IN\n            });\n        } else console.error(\"Invalid subject!\");\n    },\n    \"out\": subject => {\n        if (subject) {\n            subject.next({\n                \"position\": TransitionEnums.OUT\n            });\n        } else console.error(\"Invalid subject!\");\n    }\n};\n\nexport {\n    TransitionEnums,\n    Transition\n};","import React, {Component} from \"react\";\nimport PropTypes from \"prop-types\";\nimport {TransitionEnums} from \"../../utils/TransitionUtils\";\nimport \"../../css/GenericTransitionWrapper.css\";\n\n/**\n * Component responsible for generating a wrapper DIV with properties that allow\n * for controllable transition in and out of screen, with the ability to track\n * the beginning and end of each transition independently.\n *\n * Transition types are not specified, and are expected to be passed as an object\n * containing all CSS properties that represent either IN or OUT.\n *\n * @param {Object} props should contain functions for handling end of transitions, and definitions for changes that\n * entail IN or OUT states.\n * @constructor\n */\nclass GenericTransitionWrapper extends Component {\n\n    constructor(props) {\n        super(props);\n\n        // define IN and OUT attributes.\n        const {\n            IN,\n            OUT,\n            transitionRequestObservable\n        } = props;\n\n        // determines whether wrapped element starts in or out of the viewport\n        this.state = {\n            \"position\": props.shouldMountIn ? TransitionEnums.IN : TransitionEnums.OUT,\n            \"currentStyle\": props.shouldMountIn ? IN : OUT\n        };\n\n        // handle transition requests\n        transitionRequestObservable.delay(250).subscribe(msg => {\n\n            const {\n                position\n            } = msg;\n\n            if (position === TransitionEnums.IN) {\n\n                this.handleTransitionStart(position);\n                this.setState({\n                    position,\n                    \"currentStyle\": props.IN\n                });\n\n            } else if (position === TransitionEnums.OUT) {\n\n                this.handleTransitionStart(position);\n                this.setState({\n                    position,\n                    \"currentStyle\": props.OUT\n                });\n\n            } else console.error(\"Invalid position request. Position passed: \", position);\n\n        });\n\n        // bind functions\n        this.handleTransitionStart = this.handleTransitionStart.bind(this);\n        this.handleTransitionEnd = this.handleTransitionEnd.bind(this);\n\n    }\n\n    componentDidMount() {\n\n        const {\n            onMount\n        } = this.props;\n\n        if (onMount) onMount();\n\n    }\n\n    /**\n     * Handles start of transition, and calls appropriate handler prop.\n     * @param {TransitionEnums} position Enumeration designating desired change\n     * @returns {void}\n     */\n    handleTransitionStart(position) {\n\n        switch(position) {\n\n            case TransitionEnums.IN:\n                // break if no assigned functions\n                if (!this.props.onStartTransitionIn) break;\n                this.props.onStartTransitionIn();\n                break;\n            case TransitionEnums.OUT:\n                // break if no assigned functions\n                if (!this.props.onStartTransitionOut) break;\n                this.props.onStartTransitionOut();\n                break;\n            default:\n                console.error(\"'Position' state not appropriate: \", position);\n                break;\n        }\n\n    }\n\n    /**\n     * Handles end of transition, and calls appropriate handler prop.\n     * @returns {void}\n     */\n    handleTransitionEnd() {\n\n        switch(this.state.position) {\n\n            case TransitionEnums.IN:\n                if (!this.props.onEndTransitionIn) break;\n                this.props.onEndTransitionIn();\n                break;\n            case TransitionEnums.OUT:\n                if (!this.props.onEndTransitionOut) break;\n                this.props.onEndTransitionOut();\n                break;\n            default:\n                console.error(\"'Position' state not appropriate: \", this.state.position);\n                break;\n        }\n\n    }\n\n    render() {\n        return (\n            <div\n                className={\"transition-wrapper\"}\n                style={this.state.currentStyle}\n                onTransitionEnd={this.handleTransitionEnd}\n            >\n                {this.props.children}\n            </div>\n        );\n    }\n\n\n}\n\nGenericTransitionWrapper.propTypes = {\n    \"IN\": PropTypes.object.isRequired,\n    \"OUT\": PropTypes.object.isRequired,\n    \"shouldMountIn\": PropTypes.bool,\n    \"children\": PropTypes.any,\n    \"onStartTransitionIn\": PropTypes.func,\n    \"onStartTransitionOut\": PropTypes.func,\n    \"onEndTransitionIn\": PropTypes.func,\n    \"onEndTransitionOut\": PropTypes.func,\n    \"transitionRequestObservable\": PropTypes.any.isRequired,\n    \"onMount\": PropTypes.func\n};\n\nGenericTransitionWrapper.defaultProps = {\n    \"onMount\": () => console.log(\"Component mounted.\"),\n    \"onStartTransitionIn\": null,\n    \"onStartTransitionOut\": null,\n    \"onEndTransitionIn\": null,\n    \"onEndTransitionOut\": null,\n    \"shouldMountIn\": false\n};\n\nexport default GenericTransitionWrapper;","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport GenericTransitionWrapper from \"./GenericTransitionWrapper\";\nimport {Transition} from \"../../utils/TransitionUtils\";\n\nconst FadeTransition = props => {\n\n    const {\n        shouldMountIn,\n        onStartTransitionIn,\n        onStartTransitionOut,\n        onEndTransitionIn,\n        onEndTransitionOut,\n        transitionRequestObservable,\n        onMount\n    } = props;\n\n    // default to transitioning in on mount\n    const mountHandler = onMount ? onMount : () => Transition.in(transitionRequestObservable);\n\n    return (\n        <GenericTransitionWrapper\n            OUT={{\"opacity\": 0}}\n            IN={{\"opacity\": 1}}\n            shouldMountIn={shouldMountIn}\n            transitionRequestObservable={transitionRequestObservable}\n            onMount={mountHandler}\n            onEndTransitionIn={onEndTransitionIn}\n            onEndTransitionOut={onEndTransitionOut}\n            onStartTransitionIn={onStartTransitionIn}\n            onStartTransitionOut={onStartTransitionOut}\n        >{props.children}</GenericTransitionWrapper>\n\n    );\n\n};\n\nFadeTransition.propTypes = {\n    \"onStartTransitionIn\": PropTypes.func,\n    \"onStartTransitionOut\": PropTypes.func,\n    \"onEndTransitionIn\": PropTypes.func,\n    \"onEndTransitionOut\": PropTypes.func,\n    \"onMount\": PropTypes.func,\n    \"transitionRequestObservable\": PropTypes.any.isRequired,\n    \"shouldMountIn\": PropTypes.bool,\n    \"children\": PropTypes.any\n};\n\nFadeTransition.defaultProps = {\n    \"shouldMountIn\": false\n};\n\nexport default FadeTransition;","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport GenericTransitionWrapper from \"./GenericTransitionWrapper\";\nimport {Transition} from \"../../utils/TransitionUtils\";\n\nconst SlideTransition = props => {\n\n    const {\n        shouldMountIn,\n        onStartTransitionIn,\n        onStartTransitionOut,\n        onEndTransitionIn,\n        onEndTransitionOut,\n        transitionRequestObservable,\n        onMount\n    } = props;\n\n    // default to transitioning in on mount\n    const mountHandler = onMount ? onMount : () => Transition.in(transitionRequestObservable);\n\n    return (\n        <GenericTransitionWrapper\n            OUT={{\"left\": \"100%\"}}\n            IN={{\"left\": \"0\"}}\n            shouldMountIn={shouldMountIn}\n            transitionRequestObservable={transitionRequestObservable}\n            onMount={mountHandler}\n            onEndTransitionIn={onEndTransitionIn}\n            onEndTransitionOut={onEndTransitionOut}\n            onStartTransitionIn={onStartTransitionIn}\n            onStartTransitionOut={onStartTransitionOut}\n        >{props.children}</GenericTransitionWrapper>\n\n    );\n\n};\n\nSlideTransition.propTypes = {\n    \"onStartTransitionIn\": PropTypes.func,\n    \"onStartTransitionOut\": PropTypes.func,\n    \"onEndTransitionIn\": PropTypes.func,\n    \"onEndTransitionOut\": PropTypes.func,\n    \"onMount\": PropTypes.func,\n    \"transitionRequestObservable\": PropTypes.any.isRequired,\n    \"shouldMountIn\": PropTypes.bool,\n    \"children\": PropTypes.any\n};\n\nSlideTransition.defaultProps = {\n    \"shouldMountIn\": false\n};\n\nexport default SlideTransition;","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport SpotifySong from \"../../components/hud/SpotifySong\";\nimport HUDButton, {HUDButtonTypesEnum} from \"../../components/hud/HUDButton\";\nimport \"../../css/hud/HUDSongSelect.css\";\n\n/**\n * Component that displays selected song in the center of the screen, and that\n * progresses the flow of the application towards fetching data from a specific\n * track necessary for level generation, as well as updating game state.\n * @param {Object} props react props\n * @returns {*}\n * @constructor\n */\nconst HUDSongSelectMenu = props => {\n\n    const {\n        songObject,\n        onConfirmation\n    } = props;\n\n    const {\n        name,\n        id,\n        img,\n        artist\n    } = songObject;\n\n    const genBtnStyle = {\n        \"width\": \"auto\"\n    };\n\n    return (\n        <div className=\"hud-song-select-outer-container\">\n                <SpotifySong\n                    size=\"large\"\n                    name={name}\n                    id={id}\n                    imgURL={img}\n                    artist={artist}\n                />\n                <HUDButton text=\"Generate Level\" onClick={onConfirmation} style={genBtnStyle}/>\n                <HUDButton text={\"<\"} type={HUDButtonTypesEnum.RETURN} onClick={props.onReturn}/>\n        </div>\n    );\n\n};\n\nHUDSongSelectMenu.propTypes = {\n    \"songObject\": PropTypes.shape({\n        \"name\": PropTypes.string.isRequired,\n        \"id\": PropTypes.string.isRequired,\n        \"img\": PropTypes.string,\n        \"artist\": PropTypes.array.isRequired\n    }),\n    \"onConfirmation\": PropTypes.func.isRequired,\n    \"onReturn\": PropTypes.func.isRequired\n};\n\nexport default HUDSongSelectMenu;","import React, {Component} from \"react\";\nimport SlideTransition from \"./transition/SlideTransition\";\nimport {Subject} from \"rxjs\";\nimport {Transition} from \"../utils/TransitionUtils\";\nimport \"../css/Form.css\";\nimport HUDButton, {HUDButtonTypesEnum} from \"./hud/HUDButton\";\n\n/* eslint no-inline-comments: 0 */\n/* eslint line-comment-position: 0 */\n/* eslint max-params: 0 */\n\nconst rangeLowToHigh = [\"Very Low\", \"Low\", \"Somewhat Low\", \"Somewhat High\", \"High\", \"Very High\"];\n\n\n/**\n * Component that contains the end-of-game feedback\n * form.\n */\nclass FormOverlay extends Component {\n\n    constructor(props) {\n        super(props);\n\n        // question values\n        this.state = {\n            \"q1\": 1, // Q1: Range from 1-6\n            \"q2\": \"\", // Q2: Textbox\n            \"q3\": \"\", // Q3: Textbox\n            \"q4\": \"\", // Q4: Textbox\n            \"q5\": 1, // Q5: Range from 1-6\n            \"q6\": 1, // Q6: Range from 1-6\n            \"q7\": 1, // Q7: Range from 1-6\n            \"q8\": \"\", // Q8: Textbox\n            \"q9\": 1, // Q9: Textbox\n            \"q10\": 1, // Q10: Range from 1-6\n            \"q11\": false, // Q11: Yes/No\n            \"q12\": false, // Q12: Long/Short\n            \"q13\": false, // Q13: Yes/No\n            \"q14\": false, // Q14: Yes/No\n            \"q15\": false // Q15: Yes/No\n        };\n\n        this.handleChange = this.handleChange.bind(this);\n\n    }\n\n    handleChange (question, value) {\n        const newState = {};\n        newState[question] = value;\n\n        this.setState(newState);\n    }\n\n    renderQuestionContainer (text, inputComponent, key, currentValueDisplay = null) {\n\n        return (\n            <div className=\"question-container\" key={key}>\n                <p>{text}</p>\n                {inputComponent}\n                {currentValueDisplay ? <p>{currentValueDisplay}</p> : null}\n            </div>\n        );\n    }\n\n    render() {\n\n        const transitionObservable = new Subject();\n        const onMount = () => Transition.in(transitionObservable);\n        const questions = [];\n\n        const appendQuestions = () => {\n            // 1 range\n            questions.push(this.renderQuestionContainer(\n                \"How would you rate your overall enjoyment of the game?\",\n                <input\n                    type=\"range\"\n                    step=\"1\"\n                    value={this.state.q1}\n                    onChange={evt => this.handleChange(\"q1\", parseInt(evt.target.value, 10))}\n                    min=\"1\"\n                    max=\"6\"\n                    name=\"q1\"\n                    id=\"q1\" />,\n                questions.length,\n                rangeLowToHigh[this.state.q1 - 1]\n            ));\n\n            // 2 text\n            questions.push(this.renderQuestionContainer(\n                \"What elements did you particularly enjoy?\",\n                <input\n                    type=\"text\"\n                    value={this.state.q2}\n                    onChange={evt => this.handleChange(\"q2\", evt.target.value)}\n                    name=\"q2\"\n                    id=\"q2\" />,\n                questions.length,\n                this.state.q2 ? \"\" : \"Field required\"\n            ));\n\n            // 3 text\n            questions.push(this.renderQuestionContainer(\n                \"What elements did you dislike/have problems with?\",\n                <input\n                    type=\"text\"\n                    value={this.state.q3}\n                    onChange={evt => this.handleChange(\"q3\", evt.target.value)}\n                    name=\"q3\"\n                    id=\"q3\" />,\n                questions.length,\n                this.state.q3 ? \"\" : \"Field required\"\n            ));\n\n            // 4 text\n            questions.push(this.renderQuestionContainer(\n                \"How did playing this game enhance your listening experience?\",\n                <input\n                    type=\"text\"\n                    value={this.state.q4}\n                    onChange={evt => this.handleChange(\"q4\", evt.target.value)}\n                    name=\"q4\"\n                    id=\"q4\" />,\n                questions.length,\n                this.state.q4 ? \"\" : \"Field required\"\n            ));\n\n            // 5 range\n            questions.push(this.renderQuestionContainer(\n                \"How would you rate the synchronicity between the mountain props and jumps and the music you were listening to?\",\n                <input\n                    type=\"range\"\n                    step=\"1\"\n                    value={this.state.q5}\n                    onChange={evt => this.handleChange(\"q5\", parseInt(evt.target.value, 10))}\n                    min=\"1\"\n                    max=\"6\"\n                    name=\"q5\"\n                    id=\"q5\" />,\n                questions.length,\n                rangeLowToHigh[this.state.q5]\n            ));\n\n            // 6 range\n            questions.push(this.renderQuestionContainer(\n                \"How much did the moving background help create the feeling of going down a mountain?\",\n                <input\n                    type=\"range\"\n                    step=\"1\"\n                    value={this.state.q6}\n                    onChange={evt => this.handleChange(\"q6\", parseInt(evt.target.value, 10))}\n                    min=\"1\"\n                    max=\"6\"\n                    name=\"q6\"\n                    id=\"q6\" />,\n                questions.length,\n                this.state.q6\n            ));\n\n            // 7 range\n            questions.push(this.renderQuestionContainer(\n                \"To what degree did the moving background help give you a sense of speed as you went down the mountain?\",\n                <input\n                    type=\"range\"\n                    step=\"1\"\n                    value={this.state.q7}\n                    onChange={evt => this.handleChange(\"q7\", parseInt(evt.target.value, 10))}\n                    min=\"1\"\n                    max=\"6\"\n                    name=\"q7\"\n                    id=\"q7\" />,\n                questions.length,\n                this.state.q7\n            ));\n\n            // 8 text\n            questions.push(this.renderQuestionContainer(\n                \"How appropriate was the downhill speed for the type of song you chose?\",\n                <input\n                    type=\"text\"\n                    value={this.state.q8}\n                    onChange={evt => this.handleChange(\"q8\", evt.target.value)}\n                    name=\"q8\"\n                    id=\"q8\" />,\n                questions.length,\n                this.state.q8 ? \"\" : \"Field required\"\n            ));\n\n            // 9 range\n            questions.push(this.renderQuestionContainer(\n                \"To what extent did the background elements positively complement your experience?\",\n                <input\n                    type=\"range\"\n                    step=\"1\"\n                    value={this.state.q9}\n                    onChange={evt => this.handleChange(\"q9\", parseInt(evt.target.value, 10))}\n                    min=\"1\"\n                    max=\"6\"\n                    name=\"q9\"\n                    id=\"q9\" />,\n                questions.length,\n                `(1 - not at all, 6 - very much) Your answer: ${this.state.q9}`\n            ));\n\n            // 11 (checkbox)\n            questions.push(this.renderQuestionContainer(\n                \"Were you able to find the song you were looking for easily?\",\n                <label className=\"switch\">\n                    <input type=\"checkbox\"\n                           onChange={evt => this.handleChange(\"q11\", evt.target.checked)}\n                           checked={this.state.q11} />\n                    <span className=\"slider\"/>\n                </label>,\n                questions.length,\n                this.state.q11 ? \"Yes\" : \"No\"\n            ));\n\n            // 12 (checkbox)\n            questions.push(this.renderQuestionContainer(\n                \"Did it take a short or long time to start playing the game after you picked a song?\",\n                <label className=\"switch\">\n                    <input type=\"checkbox\"\n                           onChange={evt => this.handleChange(\"q12\", evt.target.checked)}\n                           checked={this.state.q12} />\n                    <span className=\"slider\"/>\n                </label>,\n                questions.length,\n                this.state.q12 ? \"Long\" : \"Short\"\n            ));\n\n            // 13 (checkbox)\n            questions.push(this.renderQuestionContainer(\n                \"Would you like to see song recommendations based on what you listened to previously?\",\n                <label className=\"switch\">\n                    <input type=\"checkbox\"\n                           onChange={evt => this.handleChange(\"q13\", evt.target.checked)}\n                           checked={this.state.q13} />\n                    <span className=\"slider\"/>\n                </label>,\n                questions.length,\n                this.state.q13 ? \"Yes\" : \"No\"\n            ));\n\n            // 14 (checkbox)\n            questions.push(this.renderQuestionContainer(\n                \"Are you a musician?\",\n                <label className=\"switch\">\n                    <input type=\"checkbox\"\n                           onChange={evt => this.handleChange(\"q14\", evt.target.checked)}\n                           checked={this.state.q14} />\n                    <span className=\"slider\"/>\n                </label>,\n                questions.length,\n                this.state.q14 ? \"Yes\" : \"No\"\n            ));\n\n            // 15 (checkbox)\n            questions.push(this.renderQuestionContainer(\n                \"Did you play using spotify premium?\",\n                <label className=\"switch\">\n                    <input type=\"checkbox\"\n                           onChange={evt => this.handleChange(\"q15\", evt.target.checked)}\n                           checked={this.state.q15} />\n                    <span className=\"slider\"/>\n                </label>,\n                questions.length,\n                this.state.q15 ? \"Yes\" : \"No\"\n            ));\n        };\n\n        appendQuestions();\n\n        return (\n            <SlideTransition\n                transitionRequestObservable={transitionObservable}\n                onMount={onMount} >\n                <div className={\"form-container\"}>\n                    <form>\n                        {questions}\n                        <HUDButton\n                            type={HUDButtonTypesEnum.SMALL}\n                            text={\"Submit!\"} />\n                    </form>\n                </div>\n            </SlideTransition>\n        );\n    }\n\n}\n\nexport default FormOverlay;","import React from \"react\";\nimport HUDButton from \"./HUDButton\";\nimport pauseIcon from \"../../img/pause.png\";\nimport playIcon from \"../../img/play.png\";\nimport \"../../css/hud/PauseOverlay.css\";\n\nconst PauseOverlay = props => {\n\n    const {\n        isPlaying,\n        onPause,\n        onResume\n    } = props;\n\n    const handleClick = () => {\n        if (isPlaying) onPause();\n        onResume();\n    };\n\n    return (\n        <div className={`pause-overlay-container ${isPlaying ? \"\" : \"cover-screen\"}`}>\n            <HUDButton\n                className={`play-pause-btn ${isPlaying ? \"playing\" : \"paused\"}`}\n                onClick={handleClick}\n                text=\"\" >\n                <img src={isPlaying ? pauseIcon : playIcon} alt=\"Play/Pause Icon\"/>\n            </HUDButton>\n        </div>\n    );\n\n};\n\nexport default PauseOverlay;","import React, {Component} from \"react\";\nimport PropTypes from \"prop-types\";\nimport {Subject} from \"rxjs\";\nimport {GameStateEnums} from \"tune-mountain-input-manager\";\n\nimport HUDSongSearchMenu from \"../pages/hud/HUDSongSearchMenu\";\nimport HUDMainMenu from \"../pages/hud/HUDMainMenu\";\nimport HUDSongProgress from \"../components/hud/HUDSongProgress\";\nimport FadeTransition from \"../components/transition/FadeTransition\";\nimport {Transition} from \"./TransitionUtils\";\nimport SlideTransition from \"../components/transition/SlideTransition\";\nimport HUDSongSelectMenu from \"../pages/hud/HUDSongSelectMenu\";\nimport dotProp from \"dot-prop\";\nimport FormOverlay from \"../components/FormOverlay\";\nimport PauseOverlay from \"../components/hud/PauseOverlay\";\n\n/* eslint brace-style: 0 */\n/* eslint max-lines: 0 */\n\n/**\n * Utility responsible for unifying and managing all HUD menus and components properly.\n * Should be initialized with reference to the page that will be rendering the error and menu overlay.\n */\nclass HUDOverlayManager extends Component {\n\n    constructor(props) {\n        super(props);\n\n        // will initialize the menu stack with main menu assuming login has been performed\n        this.state = {\n            \"selectedSong\": null,\n            \"playing\": false,\n            \"playbackPosition\": 0,\n            \"displayCompletionForm\": false,\n            \"displayPauseOverlay\": false,\n            \"displayError\": false,\n            \"menuStack\": []\n        };\n\n        this.mainMenuTransitionController = null;\n\n        // handle request for song to be played\n        props.gameStateController.onNotificationOf(GameStateEnums.PLAY, () => {\n            // only proceed if selected song exists\n            if (this.state.selectedSong) {\n                this.props.spotifyService.play(this.state.selectedSong.id);\n\n                this.setState({\n                    \"playing\": true,\n                    \"displayPauseOverlay\": true\n                });\n            }\n        });\n\n        // handle spotify player change reactively\n        props.spotifyService.stateNotifier\n            .filter(stateLog => stateLog.state === \"PLAYER_STATE_CHANGED\")\n            .subscribe(stateLog => this.readAndUpdateState(stateLog.body));\n\n        // id for timer that checks player id\n        this.playerStateUpdaterIntervalID = null;\n\n        // binding functions\n        this.mountSongSearchMenu = this.mountSongSearchMenu.bind(this);\n        this.mountSongSelectMenu = this.mountSongSelectMenu.bind(this);\n        this.popMenu = this.popMenu.bind(this);\n        this.mainMenu = this.mainMenu.bind(this);\n        this.updatePlaybackState = this.updatePlaybackState.bind(this);\n        this.renderOverlay = this.renderOverlay.bind(this);\n    }\n\n    readAndUpdateState (stateObj) {\n\n            /*\n             * case 1: selected song is different --\n             *      emit idle state to game\n             *      go back to Main menu\n             *      pause song ?\n             */\n            const givenId = dotProp.get(stateObj, \"track_window.current_track.id\");\n            const currentId = dotProp.get(this.state, \"selectedSong.id\");\n            const paused = dotProp.get(stateObj, \"paused\");\n            const position = dotProp.get(stateObj, \"position\");\n\n            if (givenId !== currentId) {\n\n                // only handle mistaken change of state if completion form is not up\n                if (!this.state.displayCompletionForm) {\n\n                    this.props.gameStateController.request(\n                        GameStateEnums.IDLE,\n                        {\"reason\": \"Outside forces changed the song.\"}\n                    );\n                    this.mainMenu();\n\n                    this.setState({\n                        \"playing\": false,\n                        \"displayPauseOverlay\": false\n                    });\n\n                    Transition.in(this.mainMenuTransitionController);\n\n                    // make sure user cannot force Spotify Player to play any tracks\n                    this.props.spotifyService.deactivate();\n\n                }\n\n            }\n\n            /*\n             * case 2: it's paused --\n             *      emit pause state to game\n             */\n            else if (paused) {\n\n                // check if at the end of the song\n                if (position === 0) {\n\n                    this.props.gameStateController.request(\n                        GameStateEnums.IDLE,\n                        {\"reason\": \"end\"}\n                    );\n\n\n                    this.setState({\n                        \"playing\": false,\n                        \"displayPauseOverlay\": false,\n                        \"displayCompletionForm\": true\n                    });\n\n                    this.props.spotifyService.deactivate();\n\n\n                } else {\n\n                    this.props.gameStateController.request(\n                        GameStateEnums.PAUSE,\n                        {\"reason\": \"paused\"}\n                    );\n\n                    this.setState({\n                        \"playing\": false,\n                        \"playbackPosition\": position\n                    });\n\n\n                }\n                // so no useless updates are made\n                this.terminatePlaybackStateUpdater();\n\n            }\n\n            /*\n             * case 3: it's all the same\n             *      update position\n             */\n            else {\n\n                // send play state if was previously paused\n                if (!this.state.playing) {\n                    this.props.gameStateController\n                        .request(GameStateEnums.PLAY, {\"reason\": \"unpaused\"});\n                }\n\n                // this means it's not paused too\n                this.initPlaybackStateUpdater();\n\n                this.setState({\n                    \"playing\": true,\n                    \"playbackPosition\": position\n                });\n            }\n\n        }\n\n    componentDidMount() {\n\n        // initialize transition observable\n        const transitionObservable = new Subject();\n\n        const handleSongSelectRequest = () => {\n            // first transition main menu out\n            Transition.out(transitionObservable);\n\n            // transition song search menu in\n            this.mountSongSearchMenu(transitionObservable);\n        };\n\n        this.mainMenuTransitionController = transitionObservable;\n\n        // now that all is well and mounted, update menu stack with appropriate components\n        this.setState({\n            \"menuStack\": [\n                <FadeTransition\n                    transitionRequestObservable={transitionObservable}\n                    key={0}\n                >\n                    <HUDMainMenu\n                        hasLoggedIn={true}\n                        onSongSelectRequest={handleSongSelectRequest}\n                    />\n                </FadeTransition>\n            ]\n        });\n\n\n    }\n\n    /**\n     * Checks Spotify Web Player state to determine current playback\n     * position to update UI.\n     *\n     * WARNING: expensive operation.\n     * @returns {void}\n     */\n    updatePlaybackState() {\n        const spotifyPlayerState = this.props.spotifyService.playerState;\n\n        if (spotifyPlayerState) {\n            spotifyPlayerState.then(playerState => {\n                if (!playerState) {\n\n                    console.error(\"User is not playing music through the Web Playback SDK\");\n\n                    return;\n\n                }\n\n                const {\n                    position,\n                    paused\n                } = playerState;\n\n                this.setState({\n                    \"playbackPosition\": position,\n                    \"playing\": !paused\n                });\n\n            });\n        }\n    }\n\n    // to be run once player starts song. sets up a timer that checks playback state every second\n    initPlaybackStateUpdater() {\n\n        // clear just in case\n        this.terminatePlaybackStateUpdater();\n\n        this.playerStateUpdaterIntervalID = setInterval(this.updatePlaybackState, 3000);\n\n    }\n\n    // terminates timer for checking state (to be run if song is paused)\n    terminatePlaybackStateUpdater() {\n\n        clearInterval(this.playerStateUpdaterIntervalID);\n\n    }\n\n    // mounts menu off screen and transitions both menus appropriately\n    mountSongSearchMenu(prevScreenTransitionObservable) {\n\n        // initialize transition observable\n        const transitionObservable = new Subject();\n\n        const handleSongSelect = songObject => {\n            Transition.out(transitionObservable);\n            this.mountSongSelectMenu(songObject, transitionObservable);\n        };\n\n        const handleReturn = () => {\n            Transition.out(transitionObservable);\n            this.popMenu();\n            Transition.in(prevScreenTransitionObservable);\n        };\n\n        // initialize jsx object\n        const songSearchMenu =\n            <SlideTransition\n                transitionRequestObservable={transitionObservable}\n                key={1}\n            >\n                <HUDSongSearchMenu\n                    spotifyService={this.props.spotifyService}\n                    selectSong={handleSongSelect}\n                    onReturn={handleReturn}\n                />\n            </SlideTransition>;\n\n        // mount\n        this.setState(oldState => ({\n            \"menuStack\": [\n                ...oldState.menuStack,\n                songSearchMenu\n            ]\n        }));\n\n    }\n\n    // mounts song select\n    mountSongSelectMenu(songObject, prevScreenTransitionObservable) {\n\n        // update state to contain selected song.\n        this.setState({\n            \"selectedSong\": songObject\n        });\n\n        // initialize transition observable\n        const transitionObservable = new Subject();\n\n        const handleConfirmation = () => {\n            this.initPlaybackStateUpdater();\n\n            Transition.out(transitionObservable);\n            // get audio features, emit them to game\n            this.props.spotifyService\n                .getAudioAnalysisAndFeatures(\n                    songObject.id,\n                        object => {\n                            // log\n                            console.log(\"Features and analysis: \", object);\n\n                            // emit data to game\n                            this.props.gameStateController.request(GameStateEnums.GENERATE, object);\n\n                            // TODO: remove forcing song to start playing\n                            this.props.gameStateController.notify(GameStateEnums.PLAY);\n                        }\n                );\n\n            // connect to player\n            this.props.spotifyService.activate();\n\n            this.mainMenu();\n        };\n\n        const handleReturn = () => {\n            Transition.out(transitionObservable);\n            this.popMenu();\n            Transition.in(prevScreenTransitionObservable);\n        };\n\n        // initialize jsx object\n        const songSearchMenu =\n            <SlideTransition\n                transitionRequestObservable={transitionObservable}\n                key={2}\n            >\n                <HUDSongSelectMenu\n                    songObject={songObject}\n                    onConfirmation={handleConfirmation}\n                    onReturn={handleReturn}\n                />\n            </SlideTransition>;\n\n        // mount\n        this.setState(oldState => ({\n            \"menuStack\": [\n                ...oldState.menuStack,\n                songSearchMenu\n            ]\n        }));\n\n    }\n\n    // unmounts top screen\n    popMenu() {\n        this.setState(oldState => {\n\n            const oldStack = oldState.menuStack;\n            oldStack.pop();\n\n            return {\"menuStack\": [...oldStack]};\n\n        });\n    }\n\n    // unmounts all menus except first\n    mainMenu() {\n        this.setState(oldState => ({\"menuStack\": [oldState.menuStack[0]]}));\n    }\n\n    // wraps overlay rendering logic\n    renderOverlay() {\n        const {\n            displayCompletionForm,\n            displayPauseOverlay,\n            displayError\n        } = this.state;\n\n        const {spotifyService} = this.props;\n\n        // toggles playback twice because the SDK is hella glitchy\n        const handlePause = () => {\n            spotifyService.toggle()\n                .then(() => spotifyService.toggle());\n\n        };\n\n        // toggles playback\n        const handleResume = () => {\n            spotifyService.toggle();\n        };\n\n        // prioritize error screen\n        if (displayError) return null;\n        else if (displayCompletionForm) return <FormOverlay />; // todo: setup on submit callbacks\n        else if (displayPauseOverlay) return <PauseOverlay\n            isPlaying={this.state.playing}\n            onPause={handlePause}\n            onResume={handleResume}\n        />;\n        // callbacks for fading it out\n\n        return null;\n    }\n\n    render() {\n\n        // if user has not logged in yet, display incomplete main menu as the only object on screen\n        if (!this.props.hasLoggedIn) {\n\n            // initialize transition observable\n            const transitionObservable = new Subject();\n\n            /*\n             * TODO: assign appropriate fadeout handlers according to button press\n             * let fadeOutHandler = () => console.log(\"Fade out handler not set for main menu.\");\n             */\n            const onMount = () => Transition.in(transitionObservable);\n\n            return (\n                <div>\n                    <FadeTransition\n                        transitionRequestObservable={transitionObservable}\n                        // onEndTransitionOut={fadeOutHandler}\n                        onMount={onMount}\n                    >\n                        <HUDMainMenu\n                            onLoginRequest={this.props.spotifyService.login}\n                            hasLoggedIn={false}\n                        />\n                    </FadeTransition>\n                </div>\n            );\n\n        }\n\n        // render song progress component\n        const progBar = <HUDSongProgress\n            songObject={this.state.selectedSong}\n            positionInMilliseconds={this.state.playbackPosition}\n            shouldDisplay={this.state.playing}\n        />;\n\n        return(\n            <div>\n                {progBar}\n                {this.state.errorComponent}\n                {this.renderOverlay()}\n                {this.state.menuStack}\n            </div>\n        );\n    }\n\n}\n\n// make both spotify and state controller required\nHUDOverlayManager.propTypes = {\n  \"gameStateController\": PropTypes.object.isRequired,\n  \"spotifyService\": PropTypes.object.isRequired,\n  \"hasLoggedIn\": PropTypes.bool\n};\n\n// do not run game if hasLoggedIn is not passed in\nHUDOverlayManager.defaultProps = {\n    \"hasLoggedIn\": false\n};\n\nexport default HUDOverlayManager;","/**\n * Service utility for client server communication;\n * Abstracts HTTP operations for more ease of repeated use.\n */\nimport dotProp from \"dot-prop\";\n\nclass APIService {\n\n    /**\n     * Determines if user exists in database; If exists,\n     * resolves promise to true. If not, resolves promise to false.\n     *\n     * If some error occurs, promise is rejected.\n     *\n     * @param {String} spotifyID the spotify ID of the user\n     * @param {String} displayName the display name of the user // todo: Field is updated if user exists in database.\n     * @param {String} imageUrl the profile picture of user // todo: Field is updated if user exists in database\n     * @returns {Promise<Boolean>} resolves to true if user exists, false if user is new. Rejects if there's an error.\n     */\n    checkInUser(spotifyID, displayName, imageUrl) {\n\n        const addNewUser = () => {\n\n            const init = {\n                \"method\": \"POST\",\n                \"headers\": {\n                    \"Content-Type\": \"application/json\"\n                },\n                \"body\": JSON.stringify({\n                    spotifyID,\n                    displayName,\n                    imageUrl\n                })\n            };\n\n            return fetch(\"/api/users\", init);\n\n        };\n\n        const promiseHandler = (resolve, reject) => {\n\n            // get user if exists\n            fetch(`/api/user/${spotifyID}`)\n                .then(res => res.json())\n                .then(resJSON => {\n\n                    if (resJSON.status === \"success\") {\n\n                        // TODO: implement endpoint for updating fields\n                        resolve(true);\n\n                    } else if (resJSON.status === \"failure\" && resJSON.errorCode === 1) {\n\n                        return addNewUser();\n\n                    } else reject();\n\n                })\n                .then(res => res.json())\n                .then(resJSON => {\n                    if (resJSON.status === \"success\") {\n                        resolve(false);\n                    } else reject();\n                })\n                .catch(() => reject());\n\n\n        };\n\n        return new Promise(promiseHandler);\n\n    }\n\n    /**\n     * Stores a game session and game session inputs in the database.\n     *\n     * @param {Object} sessionObject object containing session information (score, songID, userID, gameVersion)\n     * @param {Array<Object>} inputArray contains input objects (sessionID, action, timestamp, type)\n     * @returns {Promise<null>} resolves if successful and rejects if there's an error\n     */\n    saveGameSession(sessionObject, inputArray) {\n\n        const handler = (resolve, reject) => {\n\n            this.saveGameSessionOnly(sessionObject)\n                .then(id => this.saveInputArrayOnly(inputArray, id))\n                .then(res => resolve(res))\n                .catch(err => reject(err));\n\n        };\n\n        return new Promise(handler);\n\n    }\n\n    /**\n     * Stores only a game session object in the database.\n     *\n     * @param {Object} sessionObject contains (score, songID, userID, gameVersion)\n     * @returns {Promise<Number>} resolves to an integer representing the sessionID if successfully inserted, rejects if\n     * there's an error\n     */\n    saveGameSessionOnly(sessionObject) {\n\n        const url = \"/api/sessions\";\n        const init = {\n            \"method\": \"POST\",\n            \"headers\": {\n                \"Content-Type\": \"application/json\"\n            },\n            \"body\": JSON.stringify(sessionObject)\n        };\n\n        const handler = (resolve, reject) => {\n\n            fetch(url, init)\n                .then(response => response.json())\n                .then(responseJSON => {\n                    const sessions = dotProp.get(responseJSON, \"sessions\");\n\n                    return responseJSON.status === \"success\"\n                        ? resolve(sessions[sessions.length - 1].sessionID)\n                        : reject(responseJSON);\n                })\n                .catch(err => reject(err));\n\n        };\n\n        return new Promise(handler);\n\n    }\n\n    /**\n     * Stores only an array of inputs in the database.\n     *\n     * Note: inputs can only be stored after session is stored.\n     *\n     * @param {Array} inputArray array containing objects (sessionID, action, timestamp, type)\n     * @param {Number} sessionID an integer representing the id of the session\n     * @returns {Promise<Object>} resolves if successfully inserted, rejects if there's an error\n     */\n    saveInputArrayOnly(inputArray, sessionID) {\n\n        const modifiedArray = inputArray.map(input => ({\n            ...input,\n            sessionID\n        }));\n\n        const url = \"/api/inputs\";\n        const init = {\n            \"method\": \"POST\",\n            \"headers\": {\n                \"Content-Type\": \"application/json\"\n            },\n            \"body\": JSON.stringify({\n                \"inputs\": modifiedArray\n            })\n        };\n\n        const handler = (resolve, reject) => {\n\n            if (typeof sessionID !== \"number\") reject({\n                    \"status\": \"failure\",\n                    \"reason\": \"something is wrong\",\n                    \"thing\": {\n                        inputArray,\n                        sessionID\n                    }\n                });\n\n            fetch(url, init)\n                .then(response => response.json())\n                .then(responseJSON => responseJSON.status === \"success\"\n                    ? resolve()\n                    : reject(responseJSON))\n                .catch(err => reject(err));\n\n        };\n\n        return new Promise(handler);\n\n    }\n\n    /**\n     * Fetches top 10 sessions in database.\n     *\n     * @param {String} userID optional spotify ID to filter top 10 plays of given user\n     * @returns {Promise<Object>} promise that resolves in a response object containing all sessions or rejects in\n     * case of an error.\n     */\n    fetchLeaderboard(userID = null) {\n\n        const url = `/api/leaderboard${userID ? `/${userID}` : \"\"}`;\n\n        const handler = (resolve, reject) => {\n\n            fetch(url)\n                .then(response => response.json())\n                .then(responseJSON => responseJSON.status === \"success\"\n                    ? resolve(responseJSON)\n                    : reject(responseJSON))\n                .catch(err => reject(err));\n\n        };\n\n        return new Promise(handler);\n\n    }\n\n\n    /**\n     * Fetches all inputs to a given session\n     *\n     * @param {Number} sessionID id of session to which inputs will be fetched.\n     * @returns {Promise<Object>} promise that resolves to object containing session info and inputs;\n     */\n    fetchInputs(sessionID) {\n\n        const url = `/api/session/${sessionID}`;\n\n        const handler = (resolve, reject) => {\n\n            fetch(url)\n                .then(response => response.json())\n                .then(responseJSON => responseJSON.status === \"success\"\n                    ? resolve(responseJSON)\n                    : reject(responseJSON))\n                .catch(err => reject(err));\n\n        };\n\n        return new Promise(handler);\n\n    }\n\n    // todo: make API call to send feedback\n\n}\n\nexport default APIService;","import React, {Component} from \"react\";\nimport SpotifyService from \"../utils/SpotifyService\";\nimport HUDOverlayManager from \"../utils/HUDOverlayManager\";\nimport APIService from \"../utils/APIService\";\nimport Game from \"tune-mountain-game\";\nimport {GameStateController} from \"tune-mountain-input-manager\";\nimport \"../css/App.css\";\n\nconst APP_NAME = \"Tune Mountain\";\n\nclass App extends Component {\n\n\tconstructor(props) {\n\n\t\tsuper(props);\n\n\t\tconst spotifyService = new SpotifyService(`${APP_NAME} Web Player`);\n\t\tconst hasLoggedIn = false;\n\n\t\tspotifyService.stateNotifier.subscribe(state => console.log(state));\n\t\tspotifyService.stateNotifier\n\t\t\t.filter(notification => notification.state === \"LOGGED_IN\")\n\t\t\t.subscribe(() => this.setState({\"hasLoggedIn\": true}));\n\n\t\t// init player when sdk is ready\n\t\tthis.spotifyService = spotifyService;\n\n\t\t// api service\n\t\tthis.apiService = new APIService();\n\n\t\t// game components\n\t\tthis.canvasReference = React.createRef();\n\n\t\t// will be initialized once component mounts\n\t\tthis.game = null;\n\t\tthis.gameStateController = new GameStateController();\n\n\t\tthis.state = {\n\t\t\thasLoggedIn,\n\t\t\t\"currentMenu\": null\n\t\t};\n\n\t}\n\n\tcomponentDidMount() {\n\n\t\t// initialize game once component is mounted\n\t\tthis.game = new Game(this.gameStateController, this.canvasReference.current);\n\n\t}\n\n\trender() {\n\n\t\treturn(\n\t\t\t<div>\n\t\t\t\t<canvas\n\t\t\t\t\tref={this.canvasReference}\n\t\t\t\t\tclassName={\"game-viewport\"}\n\t\t\t\t\twidth={window.innerWidth}\n\t\t\t\t\theight={window.innerHeight}\n\t\t\t\t/>\n\t\t\t\t<HUDOverlayManager\n\t\t\t\t\tspotifyService={this.spotifyService}\n\t\t\t\t\thasLoggedIn={this.state.hasLoggedIn}\n\t\t\t\t\tgameStateController={this.gameStateController}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t);\n\n\t}\n\n}\n\nexport default App;","import React from \"react\";\nimport App from \"./pages/App\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));"],"sourceRoot":""}