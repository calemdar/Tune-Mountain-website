(window["webpackJsonptune-mountain-client"]=window["webpackJsonptune-mountain-client"]||[]).push([[0],{168:function(e,t,n){},172:function(e,t,n){e.exports=n(478)},469:function(e,t,n){},470:function(e,t,n){},471:function(e,t,n){},472:function(e,t,n){},473:function(e,t,n){},477:function(e,t,n){},478:function(e,t,n){"use strict";n.r(t);var o=n(1),a=n.n(o),r=n(12),i=n(13),s=n(17),c=n(16),u=n(18),l=n(171),h=n(169),f=n.n(h),d=n(19),p=n.n(d),m=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a={source:"SpotifyService",state:e,body:t,message:n};o?o.next(a):console.log(a)},g=function(){var e=new URLSearchParams(window.location.search);return{accessToken:e.get("accessToken"),refreshToken:e.get("refreshToken")}},S=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=g(),o=null,a=null;if(n.accessToken&&n.refreshToken)o=n.accessToken,a=n.refreshToken,m("ACCESS_TOKEN_ACQUIRED",{accessToken:o,refreshToken:a},"Using tokens from query returned from server!",t),localStorage.setItem("spotify-refresh-token",n.refreshToken);else{m("LOADING_TOKEN_FROM_LOCAL_STORAGE",null,"Spotify tokens not found in query. Looking in local storage...",t);var r=localStorage.getItem("spotify-refresh-token");r?(m("REFRESHING_TOKEN",null,"Spotify refresh token found in localStorage. Fetching new accessToken from server...",t),e(r).then((function(e){m("ACCESS_TOKEN_ACQUIRED",{accessToken:e.accessToken,refreshToken:r},"Spotify access token fetched.",t)}))):m("NO_ACCESS_TOKEN",null,"No tokens found or refreshed. User must log in.",t)}},v="http://localhost:8080",y=function(){function e(t){var n=this;Object(r.a)(this,e);var o=new p.a.BehaviorSubject(!1),a=new p.a.BehaviorSubject(!1),i=new p.a.BehaviorSubject(!1),s=new p.a.ReplaySubject;o.combineLatest(a,i,(function(e,t,n){return e&&t&&n})).filter((function(e){return e})).subscribe((function(){m("LOGGED_IN",null,"User has logged in.",s),function(){if(!n.player){var e=window.Spotify.Player;n.player=new e({name:"tune mountain",getOAuthToken:function(e){return e(n.accessToken)},volume:.5}),n.player.connect(),n.player.addListener("ready",(function(e){var t=e.device_id;m("PLAYER_READY","Spotify player ready to stream songs on ".concat(t),s)}))}}()})),S(this.getNewAccessToken,s),s.filter((function(e){return"ACCESS_TOKEN_ACQUIRED"===e.state})).subscribe((function(e){var t=e.body,o=t.accessToken,a=t.refreshToken;n.accessToken=o,n.refreshToken=a,o&&a?i.next(!0):i.next(!1)})),this.name=t,this.player=null,this.spotifyStateNotifier=s,f()(["https://sdk.scdn.co/spotify-player.js"]).then((function(){o.next(!0)})),window.onSpotifyWebPlaybackSDKReady=function(){return a.next(!0)},this.spotifyStateNotifier=s}return Object(i.a)(e,[{key:"getNewAccessToken",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=e||this.refreshToken;return fetch("".concat(v,"/spotify-service/refresh-token/").concat(t)).then((function(e){return e.json()})).catch((function(e){console.error(e)}))}},{key:"togglePlayback",value:function(){var e=this;this.player.getCurrentState().then((function(t){if(!t)return console.error("User is not playing music through the Web Playback SDK"),void e.play();var n=t.track_window,o=n.current_track,a=Object(l.a)(n.next_tracks,1)[0];console.log("Currently Playing",o),console.log("Playing Next",a)})),this.player.togglePlay()}},{key:"play",value:function(e){if(!this.player)throw new Error("Player not initialized.");var t=function(e){var t=e.spotifyURI,n=e.playerInstance._options,o=n.getOAuthToken,a=n.id;o((function(e){var n={method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}};t&&(n.body=JSON.stringify({uris:[t]})),fetch("https://api.spotify.com/v1/me/player/play?device_id=".concat(a),n).then((function(){return console.log("Success: Playing uri: ".concat(t))}))}))};t({playerInstance:this.player,spotifyURI:e})}},{key:"login",value:function(){console.log("Redirecting to Spotify for authorization..."),window.location="".concat(v,"/spotify-service/login")}},{key:"search",value:function(){for(var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n="q=",o=0;o<(arguments.length<=1?0:arguments.length-1);o++)n+=o+1<1||arguments.length<=o+1?void 0:arguments[o+1],n+=o+1===(arguments.length<=1?0:arguments.length-1)?"":"&20";var a="type=track",r="limit=8",i="https://api.spotify.com/v1/search?".concat(n,"&").concat(a,"&").concat(r),s={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(this.accessToken)}};fetch(i,s).then((function(e){return e.json()})).then((function(n){m("TRACKS_FETCHED",n,"Choose any of these songs...",e.spotifyStateNotifier),t&&t(n)})).catch((function(e){throw new Error(e)}))}},{key:"getAudioAnalysisAndFeatures",value:function(e,t){var n=this,o="https://api.spotify.com/v1/audio-analysis/".concat(e),a="https://api.spotify.com/v1/audio-features/".concat(e),r={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(this.accessToken)}},i=null,s=null;fetch(o,r).then((function(e){return e.json()})).then((function(e){return i=e,fetch(a,r)})).then((function(e){return e.json()})).then((function(e){s=e,t&&t({audioFeatures:s,audioAnalysis:i}),m("METADATA_FECHED",{audioFeatures:s,audioAnalysis:i},"Metadata available.",n.spotifyStateNotifier)})).catch((function(e){return console.error(e)}))}},{key:"stateNotifier",get:function(){return this.spotifyStateNotifier}}]),e}(),b=n(48),T=n(11),k=n(47),E=n.n(k),O=(n(469),Object.freeze({SMALL:"hud-button-small",LARGE:"hud-button-large",RETURN:"hud-button-return",ENTER:"hud-button-enter"})),N=function(e){var t=e.type,n=e.text,o=e.onClick,r=-1!==Object.values(O).findIndex((function(e){return e===t}))?t:O.SMALL;return a.a.createElement("button",{className:"".concat(r," hud-button"),onClick:function(e){e.buttonType=r,o(e)}},n)};N.defaultProps={type:O.SMALL,text:"Button Text Not Set",onClick:function(){return console.error("Click handler not set for this button.")}};var j=N,I=(n(168),function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(s.a)(this,Object(c.a)(t).call(this,e))).state={value:""},n.lastSubmittedValue=null,n.autoSearchTimer=null,n.handleChange=n.handleChange.bind(Object(T.a)(n)),n.handleSubmit=n.handleSubmit.bind(Object(T.a)(n)),n}return Object(u.a)(t,e),Object(i.a)(t,[{key:"handleChange",value:function(e){this.autoSearchTimer&&clearTimeout(this.autoSearchTimer),this.autoSearchTimer=setTimeout(this.handleSubmit,this.props.submissionTimeoutDelay),this.setState({value:e.target.value})}},{key:"handleSubmit",value:function(){""!==this.state.value&&this.state.value!==this.lastSubmittedValue&&(this.props.searchSongsWithQuery(function(e){var t=e.trim().match(/[A-Za-z0-1 ]/g),n=[],o="";return t.forEach((function(e,a){" "===e?(o.length>0&&n.push(o),o=""):(o+=e,a+1===t.length&&n.push(o))})),n}(this.state.value)),this.lastSubmittedValue=this.state.value)}},{key:"render",value:function(){var e=this;return a.a.createElement("div",{className:"search-bar-container",onKeyUp:function(t){13===t.keyCode&&e.handleSubmit()}},a.a.createElement("input",{className:"text-box",placeholder:this.props.placeholder,type:"text",value:this.state.value,onChange:this.handleChange}),a.a.createElement(j,{type:O.ENTER,text:"Search",onClick:this.handleSubmit}))}}]),t}(o.Component));I.defaultProps={searchSongsWithQuery:function(e){throw new Error("Unable to search song with query ".concat(e,". No handler passed."))},placeholder:"Type the name of a song...",submissionTimeoutDelay:2e3};var R=I,w=(n(470),function(e){var t=e.name,n=e.id,o=e.imgURL,r=e.artist,i=e.handleClick,s="small"===e.size?"song-container-small":"song-container-large";return a.a.createElement("div",{className:"".concat(s," song-container"),onClick:function(){return i({name:t,id:n,imgURL:o,artist:r})}},a.a.createElement("img",{className:"song-image",src:o,alt:"Album cover for song ".concat(t," by artist ").concat(r)}),a.a.createElement("div",{className:"song-data-container"},a.a.createElement("h1",{className:"song-name"},t),a.a.createElement("h2",{className:"song-artist"},function(e){var t="";return e.forEach((function(n,o){t+=n,t+=o+1===e.length?"":", "})),t}(r))))});w.defaultProps={name:"No Song Name Assigned",id:"No ID Passed",imgURL:"No image URL passed",artist:"No Artist",handleClick:function(){throw new Error("No click handler passed")},size:"small"};var C=w,L=function(e){function t(e){var n;if(Object(r.a)(this,t),n=Object(s.a)(this,Object(c.a)(t).call(this,e)),!e.spotifyService)throw new Error("HUDSearchMenu requires a reference to an instance of SpotifyService!");return n.spotifyService=e.spotifyService,n.state={songList:[],hasSearched:!1},n.filterReceivedJSON=n.filterReceivedJSON.bind(Object(T.a)(n)),n}return Object(u.a)(t,e),Object(i.a)(t,[{key:"filterReceivedJSON",value:function(e){var t=E.a.get(e,"tracks.items");if(!t)throw new Error("No items found in search response!");var n=t.map((function(e){return function(e,t,n,o){return{name:t,artist:n,img:o,id:e}}(e.id,e.name,E.a.get(e,"artists").map((function(e){return e.name})),E.a.get(e,"album.images")[0].url)}));this.setState({songList:n})}},{key:"renderSongList",value:function(){var e=this,t=this.state,n=t.songList,o=t.hasSearched;return 0===n.length&&o?a.a.createElement("h3",{className:"message"},"No songs found. Try something else."):n.map((function(t){return a.a.createElement(C,{name:t.name,artist:t.artist,imgURL:t.img,id:t.id,key:t.id,handleClick:function(){return e.props.selectSong(t)}})}))}},{key:"render",value:function(){var e=this;return a.a.createElement("div",{className:"hud-song-search-outer-container"},a.a.createElement("div",{className:"hud-song-search-inner-container"},a.a.createElement(R,{searchSongsWithQuery:function(t){return e.spotifyService.search(e.filterReceivedJSON,t)}}),this.renderSongList(),a.a.createElement(j,{text:"<",type:O.RETURN,onClick:this.props.onReturn})))}}]),t}(o.Component);L.defaultProps={spotifyService:null,selectSong:function(e){console.error("Couldn't select song. No handler passed",e)},onReturn:function(){console.error("No return button handler passed.")}};var A=L,M=(n(471),function(e){var t=e.hasLoggedIn,n=e.onSongSelectRequest,o=e.onLoginRequest,r=e.onAboutPageRequest,i=e.onLeaderboardsPageRequest,s=a.a.createElement(j,{text:"Spotify Login",onClick:o}),c=a.a.createElement(j,{text:"Select Song",onClick:n}),u=a.a.createElement(j,{text:"About",onClick:r}),l=a.a.createElement(j,{text:"Leaderboards",onClick:i}),h=t?c:s;return a.a.createElement("div",{className:"hud-main-menu-outer-container"},a.a.createElement("div",{className:"hud-main-menu-button-container"},h,u,l))});M.defaultProps={hasLoggedIn:!1,onSongSelectRequest:function(){throw new Error("No handler passed.")},onLoginRequest:function(){throw new Error("No handler passed.")},onAboutPageRequest:function(){throw new Error("No handler passed.")},onLeaderboardsPageRequest:function(){throw new Error("No handler passed.")}};var U=M,P={IN:"IN",OUT:"OUT"},q=function(e){e.next({position:P.IN})},x=function(e){e.next({position:P.OUT})},_=(n(472),function(e){function t(e){var n;Object(r.a)(this,t),n=Object(s.a)(this,Object(c.a)(t).call(this,e));var o=e.IN,a=e.OUT,i=e.transitionRequestObservable;return n.state={position:e.shouldMountIn?P.IN:P.OUT,currentStyle:e.shouldMountIn?o:a},i.delay(250).subscribe((function(t){var o=t.position;o===P.IN?(n.handleTransitionStart(o),n.setState({position:o,currentStyle:e.IN})):o===P.OUT?(n.handleTransitionStart(o),n.setState({position:o,currentStyle:e.OUT})):console.error("Invalid position request. Position passed: ",o)})),n.handleTransitionStart=n.handleTransitionStart.bind(Object(T.a)(n)),n.handleTransitionEnd=n.handleTransitionEnd.bind(Object(T.a)(n)),n}return Object(u.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.onMount;e&&e()}},{key:"handleTransitionStart",value:function(e){switch(e){case P.IN:if(!this.props.onStartTransitionIn)break;this.props.onStartTransitionIn();break;case P.OUT:if(!this.props.onStartTransitionOut)break;this.props.onStartTransitionOut();break;default:console.error("'Position' state not appropriate: ",e)}}},{key:"handleTransitionEnd",value:function(){switch(this.state.position){case P.IN:if(!this.props.onEndTransitionIn)break;this.props.onEndTransitionIn();break;case P.OUT:if(!this.props.onEndTransitionOut)break;this.props.onEndTransitionOut();break;default:console.error("'Position' state not appropriate: ",this.state.position)}}},{key:"render",value:function(){return a.a.createElement("div",{className:"transition-wrapper",style:this.state.currentStyle,onTransitionEnd:this.handleTransitionEnd},this.props.children)}}]),t}(o.Component));_.defaultProps={onMount:function(){return console.log("Component mounted.")},onStartTransitionIn:null,onStartTransitionOut:null,onEndTransitionIn:null,onEndTransitionOut:null,shouldMountIn:!1};var D=_,G=function(e){var t=e.shouldMountIn,n=e.onStartTransitionIn,o=e.onStartTransitionOut,r=e.onEndTransitionIn,i=e.onEndTransitionOut,s=e.transitionRequestObservable,c=e.onMount,u=c||function(){return q(s)};return a.a.createElement(D,{OUT:{opacity:0},IN:{opacity:1},shouldMountIn:t,transitionRequestObservable:s,onMount:u,onEndTransitionIn:r,onEndTransitionOut:i,onStartTransitionIn:n,onStartTransitionOut:o},e.children)};G.defaultProps={shouldMountIn:!1};var z=G,K=function(e){var t=e.shouldMountIn,n=e.onStartTransitionIn,o=e.onStartTransitionOut,r=e.onEndTransitionIn,i=e.onEndTransitionOut,s=e.transitionRequestObservable,c=e.onMount,u=c||function(){return q(s)};return a.a.createElement(D,{OUT:{left:"100%"},IN:{left:"0"},shouldMountIn:t,transitionRequestObservable:s,onMount:u,onEndTransitionIn:r,onEndTransitionOut:i,onStartTransitionIn:n,onStartTransitionOut:o},e.children)};K.defaultProps={shouldMountIn:!1};var F=K,B=(n(473),function(e){var t=e.songObject,n=e.onConfirmation,o=t.name,r=t.id,i=t.img,s=t.artist;return a.a.createElement("div",{className:"hud-song-select-outer-container"},a.a.createElement(C,{size:"large",name:o,id:r,imgURL:i,artist:s}),a.a.createElement(j,{text:"Generate Level",onClick:n}),a.a.createElement(j,{text:"<",type:O.RETURN,onClick:e.onReturn}))}),J=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(s.a)(this,Object(c.a)(t).call(this,e))).gameStateManager=e.gameStateManager,n.state={errorComponent:null,menuStack:[]},n.mountSongSearchMenu=n.mountSongSearchMenu.bind(Object(T.a)(n)),n.mountSongSelectMenu=n.mountSongSelectMenu.bind(Object(T.a)(n)),n.popMenu=n.popMenu.bind(Object(T.a)(n)),n}return Object(u.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=new d.Subject;this.setState({menuStack:[a.a.createElement(z,{transitionRequestObservable:t,key:0},a.a.createElement(U,{hasLoggedIn:!0,onSongSelectRequest:function(){x(t),e.mountSongSearchMenu(t)}}))]})}},{key:"mountSongSearchMenu",value:function(e){var t=this,n=new d.Subject,o=a.a.createElement(F,{transitionRequestObservable:n,key:1},a.a.createElement(A,{spotifyService:this.props.spotifyService,selectSong:function(e){x(n),t.mountSongSelectMenu(e,n)},onReturn:function(){x(n),t.popMenu(),q(e)}}));this.setState((function(e){return{menuStack:[].concat(Object(b.a)(e.menuStack),[o])}}))}},{key:"mountSongSelectMenu",value:function(e,t){var n=this,o=new d.Subject,r=a.a.createElement(F,{transitionRequestObservable:o,key:2},a.a.createElement(B,{songObject:e,onConfirmation:function(){x(o),n.props.spotifyService.getAudioAnalysisAndFeatures(e.id,(function(e){return console.log(e)}))},onReturn:function(){x(o),n.popMenu(),q(t)}}));this.setState((function(e){return{menuStack:[].concat(Object(b.a)(e.menuStack),[r])}}))}},{key:"popMenu",value:function(){this.setState((function(e){var t=e.menuStack;return t.pop(),{menuStack:Object(b.a)(t)}}),(function(){return console.log("Screen popped.")}))}},{key:"render",value:function(){if(!this.props.hasLoggedIn){var e=new d.Subject;return a.a.createElement("div",null,a.a.createElement(z,{transitionRequestObservable:e,onMount:function(){return q(e)}},a.a.createElement(U,{onLoginRequest:this.props.spotifyService.login,hasLoggedIn:!1})))}return a.a.createElement("div",null,this.state.errorComponent,this.state.menuStack)}}]),t}(o.Component),Q="Tune Mountain",W=function(e){function t(e){var n;Object(r.a)(this,t),n=Object(s.a)(this,Object(c.a)(t).call(this,e));var o=new y("".concat(Q," Web Player"));return o.stateNotifier.subscribe((function(e){return console.log(e)})),o.stateNotifier.filter((function(e){return"LOGGED_IN"===e.state})).subscribe((function(){return n.setState({hasLoggedIn:!0})})),n.spotifyService=o,n.state={hasLoggedIn:!1,currentMenu:null},n}return Object(u.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return a.a.createElement(J,{spotifyService:this.spotifyService,hasLoggedIn:this.state.hasLoggedIn})}}]),t}(o.Component),H=n(170),V=n.n(H);n(477);V.a.render(a.a.createElement(W,null),document.getElementById("root"))}},[[172,1,2]]]);
//# sourceMappingURL=main.2070d948.chunk.js.map